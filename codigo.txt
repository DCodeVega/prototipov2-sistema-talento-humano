Basándome en el PDF, los roles tienen estas funcionalidades:

1. ADMINISTRADOR (ya tenemos bastante)
✅ Registrar información básica del funcionario

✅ Generar usuario/clave automático

✅ Revisar formulario TALENTO

✅ Revisión de documentos

✅ Baja de funcionarios

❌ FALTAN: Migración de datos, Pantallas web para datos migrados

2. FUNCIONARIO (fase 1 - según página 6)
✅ Ingreso a oficina virtual (login)

❌ Registrar información personal (completar ficha)

❌ Registrar formación y conocimiento

❌ Registrar seguro social

❌ Registrar experiencia laboral y capacitación

❌ Desplegar formulario y documentos de soporte

❌ Imprimir formulario

❌ Visualizar número trámite

❌ Imprimir número trámite

3. JEFE DE DEPARTAMENTO
❌ Visualizar formulario por el Jefe

❌ Revisar documentos por el jefe

❌ Aprobar documento por el Jefe

Usuario Aplicación:	hernan.sanchez
Clave Temporal:	12345678
(CI del funcionario)
Correo Institucional:	hernan.sanchez@gobierno.talento.bo
Estado Usuario:	Usuario Activo

talento_humano/static/css/style.css:
/* Estilos generales */
body {
    background-color: #f8f9fa;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1;
}

/* Cards */
.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: none;
    margin-bottom: 1.5rem;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    font-weight: 600;
}

/* Formularios */
.form-label {
    font-weight: 500;
    color: #495057;
}

.form-control:focus, .form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* Tablas */
.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
}

/* Login */
.login-container {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

/* Dashboard cards */
.dashboard-card {
    transition: transform 0.3s;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

talento_humano/static/js/script.js:
// Scripts generales del sistema

document.addEventListener('DOMContentLoaded', function() {
    // Validación de formularios
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let valid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    valid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!valid) {
                e.preventDefault();
                alert('Por favor complete todos los campos obligatorios.');
            }
        });
    });
    
    // Auto-uppercase para nombres y apellidos
    const textFields = document.querySelectorAll('input[type="text"]');
    textFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (this.name.includes('nombre') || this.name.includes('apellido')) {
                this.value = this.value.toUpperCase();
            }
        });
    });
});

talento_humano/templates/funcionario/completar_ficha.html:
{% extends "base.html" %}

{% block title %}Completar Ficha TALENTO{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-id-card me-2"></i> Completar Ficha TALENTO
        </h1>
        <p class="text-muted">Complete todas las secciones requeridas de su ficha</p>
    </div>
</div>

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" 
                         style="width: {{ progreso }}%;" aria-valuenow="{{ progreso }}" 
                         aria-valuemin="0" aria-valuemax="100">
                        {{ progreso }}% Completado
                    </div>
                </div>
                <p class="mb-0 text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Complete todas las secciones marcadas como obligatorias. Puede guardar y continuar después.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Tarjetas de secciones -->
<div class="row">
    <!-- Sección 1: Datos Personales -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.datos_personales else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.datos_personales else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-user fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">1. Datos Personales</h5>
                        <p class="text-muted mb-0">Información personal y de contacto</p>
                    </div>
                </div>
                <p>Complete sus datos personales, información adicional y parientes.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.datos_personales else 'warning' }}">
                        {% if secciones.datos_personales %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_datos_personales') }}" 
                       class="btn btn-{{ 'success' if secciones.datos_personales else 'primary' }} btn-sm">
                        {% if secciones.datos_personales %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 2: Formación Académica -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.formacion else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.formacion else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-graduation-cap fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">2. Formación Académica</h5>
                        <p class="text-muted mb-0">Estudios, cursos, idiomas</p>
                    </div>
                </div>
                <p>Registre su formación: bachillerato, estudios superiores, cursos e idiomas.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.formacion else 'warning' }}">
                        {% if secciones.formacion %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_formacion_academica') }}" 
                       class="btn btn-{{ 'success' if secciones.formacion else 'primary' }} btn-sm">
                        {% if secciones.formacion %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 3: Seguro Social -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.seguro_social else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.seguro_social else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-heartbeat fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">3. Seguro Social</h5>
                        <p class="text-muted mb-0">Afiliación a caja de salud</p>
                    </div>
                </div>
                <p>Registre su información de afiliación al seguro médico.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.seguro_social else 'warning' }}">
                        {% if secciones.seguro_social %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_seguro_social') }}" 
                       class="btn btn-{{ 'success' if secciones.seguro_social else 'primary' }} btn-sm">
                        {% if secciones.seguro_social %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 4: Experiencia Laboral -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.experiencia else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.experiencia else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-briefcase fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">4. Experiencia Laboral</h5>
                        <p class="text-muted mb-0">Historial laboral y capacitaciones</p>
                    </div>
                </div>
                <p>Registre su experiencia laboral previa y capacitaciones impartidas.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.experiencia else 'warning' }}">
                        {% if secciones.experiencia %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_experiencia_laboral') }}" 
                       class="btn btn-{{ 'success' if secciones.experiencia else 'primary' }} btn-sm">
                        {% if secciones.experiencia %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-forward me-2"></i> Próximos Pasos</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                                <h6>Revisar Formulario</h6>
                                <p class="small text-muted">Revise todos los datos antes de enviar</p>
                                <a href="{{ url_for('funcionario_revisar_formulario') }}" 
                                   class="btn btn-outline-primary btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-print fa-2x text-success mb-2"></i>
                                <h6>Imprimir Formulario</h6>
                                <p class="small text-muted">Genere PDF para presentación</p>
                                <a href="{{ url_for('funcionario_imprimir_formulario') }}" 
                                   class="btn btn-outline-success btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-file-contract fa-2x text-info mb-2"></i>
                                <h6>Ver N° Trámite</h6>
                                <p class="small text-muted">Obtenga su número de trámite</p>
                                <a href="{{ url_for('funcionario_tramite') }}" 
                                   class="btn btn-outline-info btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6><i class="fas fa-clock me-2"></i> Plazo de Completado</h6>
            <p class="mb-0">
                Recuerde que tiene <strong>5 días hábiles</strong> para completar toda su ficha TALENTO.
                Puede guardar su progreso en cualquier momento y continuar después.
            </p>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/funcionario/datos_personales.html:


talento_humano/{% extends "base.html" %}

{% block title %}Datos Personales - Completar Ficha TALENTO{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        border-left: 4px solid #0d6efd;
    }
    
    .form-section h5 {
        color: #0d6efd;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .campo-obligatorio::after {
        content: " *";
        color: #dc3545;
    }
    
    .pariente-item {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
    }
    
    .pariente-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user me-2"></i> Datos Personales
                </h1>
                <p class="text-muted">
                    Sección 1: Complete sus datos personales, adicionales y de parientes
                    {% if funcionario %}
                    <span class="badge bg-primary ms-2">CI: {{ funcionario['ci'] }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <div class="bg-primary text-white rounded-circle p-3">
                            <i class="fas fa-user fa-2x"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Datos Personales (Actividad 5)</h5>
                        <p class="text-muted mb-0">
                            Complete todos los campos obligatorios marcados con (*). 
                            Esta información es esencial para su registro en el sistema.
                        </p>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary fs-6">Paso 1/4</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="POST" action="{{ url_for('funcionario_datos_personales') }}" id="formDatosPersonales">
    <!-- SECCIÓN A: Datos Personales (no editables - vienen del admin) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-id-card me-2"></i> A. Datos Personales (Información Administrativa)</h5>
                <p class="text-muted mb-3"><em>Estos datos fueron registrados por el administrador y no son editables.</em></p>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Primer Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['primer_apellido'] }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Segundo Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['segundo_apellido'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tercer Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tercer_apellido'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Primer Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['primer_nombre'] }}" readonly>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Segundo Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['segundo_nombre'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tercer Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tercer_nombre'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tipo Identificación</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tipo_identificacion'] }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Número Identificación</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['ci'] }}" readonly>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN B: Datos Personales a Completar -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-user-edit me-2"></i> B. Datos Personales a Completar</h5>
                <p class="text-muted mb-3">Complete los siguientes campos según su tipo de identificación.</p>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="genero" class="form-label campo-obligatorio">Género</label>
                        <select class="form-select" id="genero" name="genero" required>
                            <option value="">Seleccionar...</option>
                            {% for genero in parametros.genero %}
                            <option value="{{ genero.codigo }}" {% if datos_adicionales and datos_adicionales.genero == genero.codigo %}selected{% endif %}>
                                {{ genero.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="expedido_en" class="form-label campo-obligatorio">Expedido en</label>
                        <select class="form-select" id="expedido_en" name="expedido_en" required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.expedido_en == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="fecha_nacimiento" class="form-label campo-obligatorio">Fecha de Nacimiento</label>
                        <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" 
                               value="{{ datos_adicionales.fecha_nacimiento if datos_adicionales else '' }}" 
                               max="{{ fecha_max_nacimiento }}" required>
                        <small class="text-muted">Debe ser mayor a 18 años</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="pais_nacimiento" class="form-label campo-obligatorio">País de Nacimiento</label>
                        <select class="form-select" id="pais_nacimiento" name="pais_nacimiento" required>
                            <option value="">Seleccionar...</option>
                            {% for pais in parametros.paises %}
                            <option value="{{ pais.codigo }}" {% if datos_adicionales and datos_adicionales.pais_nacimiento == pais.codigo %}selected{% endif %}>
                                {{ pais.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="depto_nacimiento" class="form-label campo-obligatorio">Departamento de Nacimiento</label>
                        <select class="form-select" id="depto_nacimiento" name="depto_nacimiento" 
                                {% if datos_adicionales and datos_adicionales.pais_nacimiento != 'BOL' %}disabled{% endif %} required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.depto_nacimiento == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="provincia_nacimiento" class="form-label">Provincia de Nacimiento</label>
                        <input type="text" class="form-control" id="provincia_nacimiento" name="provincia_nacimiento" 
                               value="{{ datos_adicionales.provincia_nacimiento if datos_adicionales else '' }}"
                               {% if datos_adicionales and datos_adicionales.pais_nacimiento != 'BOL' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="lugar_nacimiento" class="form-label">Lugar de Nacimiento</label>
                        <input type="text" class="form-control" id="lugar_nacimiento" name="lugar_nacimiento" 
                               value="{{ datos_adicionales.lugar_nacimiento if datos_adicionales else '' }}" 
                               maxlength="100">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_libreta_militar" class="form-label">N° Libreta Servicio Militar</label>
                        <input type="text" class="form-control" id="nro_libreta_militar" name="nro_libreta_militar" 
                               value="{{ datos_adicionales.nro_libreta_militar if datos_adicionales else '' }}" 
                               maxlength="15">
                        <small class="text-muted">Obligatorio para varones</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="gestora" class="form-label">Gestora (AFP)</label>
                        <select class="form-select" id="gestora" name="gestora">
                            <option value="">Seleccionar...</option>
                            {% for gestora in parametros.gestora %}
                            <option value="{{ gestora.codigo }}" {% if datos_adicionales and datos_adicionales.gestora == gestora.codigo %}selected{% endif %}>
                                {{ gestora.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_nua" class="form-label">N° NUA</label>
                        <input type="number" class="form-control" id="nro_nua" name="nro_nua" 
                               value="{{ datos_adicionales.nro_nua if datos_adicionales else '' }}"
                               {% if not datos_adicionales or not datos_adicionales.gestora %}disabled{% endif %}>
                        <small class="text-muted">Obligatorio si selecciona Gestora</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="tipo_sangre" class="form-label campo-obligatorio">Tipo de Sangre</label>
                        <select class="form-select" id="tipo_sangre" name="tipo_sangre" required>
                            <option value="">Seleccionar...</option>
                            {% for sangre in parametros.tipo_sangre %}
                            <option value="{{ sangre.codigo }}" {% if datos_adicionales and datos_adicionales.tipo_sangre == sangre.codigo %}selected{% endif %}>
                                {{ sangre.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN C: Datos Adicionales -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-home me-2"></i> C. Datos Adicionales</h5>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="fecha_caducidad_ci" class="form-label campo-obligatorio">Fecha Caducidad CI</label>
                        <input type="date" class="form-control" id="fecha_caducidad_ci" name="fecha_caducidad_ci" 
                               value="{{ datos_adicionales.fecha_caducidad_ci if datos_adicionales else '' }}" required>
                        <small class="text-muted">Debe ser mayor a hoy</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="estado_civil" class="form-label campo-obligatorio">Estado Civil</label>
                        <select class="form-select" id="estado_civil" name="estado_civil" required>
                            <option value="">Seleccionar...</option>
                            {% for ec in parametros.estado_civil %}
                            <option value="{{ ec.codigo }}" {% if datos_adicionales and datos_adicionales.estado_civil == ec.codigo %}selected{% endif %}>
                                {{ ec.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_hijos" class="form-label">N° de Hijos</label>
                        <input type="number" class="form-control" id="nro_hijos" name="nro_hijos" 
                               value="{{ datos_adicionales.nro_hijos if datos_adicionales else 0 }}" min="0" max="99">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_dependientes" class="form-label">N° Dependientes</label>
                        <input type="number" class="form-control" id="nro_dependientes" name="nro_dependientes" 
                               value="{{ datos_adicionales.nro_dependientes if datos_adicionales else 0 }}" min="0" max="99">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="direccion_domicilio" class="form-label campo-obligatorio">Dirección Domicilio</label>
                        <input type="text" class="form-control" id="direccion_domicilio" name="direccion_domicilio" 
                               value="{{ datos_adicionales.direccion_domicilio if datos_adicionales else '' }}" 
                               maxlength="300" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_domicilio" class="form-label campo-obligatorio">N° Domicilio</label>
                        <input type="text" class="form-control" id="nro_domicilio" name="nro_domicilio" 
                               value="{{ datos_adicionales.nro_domicilio if datos_adicionales else '' }}" 
                               maxlength="10" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="zona_domicilio" class="form-label campo-obligatorio">Zona Domicilio</label>
                        <input type="text" class="form-control" id="zona_domicilio" name="zona_domicilio" 
                               value="{{ datos_adicionales.zona_domicilio if datos_adicionales else '' }}" 
                               maxlength="50" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="ciudad_localidad" class="form-label campo-obligatorio">Ciudad / Localidad</label>
                        <select class="form-select" id="ciudad_localidad" name="ciudad_localidad" required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.ciudad_localidad == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="tipo_vivienda" class="form-label">Tipo Vivienda</label>
                        <select class="form-select" id="tipo_vivienda" name="tipo_vivienda">
                            <option value="">Seleccionar...</option>
                            <option value="CASA" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'CASA' %}selected{% endif %}>Casa</option>
                            <option value="DEPARTAMENTO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'DEPARTAMENTO' %}selected{% endif %}>Departamento</option>
                            <option value="EDIFICIO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'EDIFICIO' %}selected{% endif %}>Edificio</option>
                            <option value="OTRO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'OTRO' %}selected{% endif %}>Otro</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nombre_tipo_vivienda" class="form-label">Nombre Tipo Vivienda</label>
                        <input type="text" class="form-control" id="nombre_tipo_vivienda" name="nombre_tipo_vivienda" 
                               value="{{ datos_adicionales.nombre_tipo_vivienda if datos_adicionales else '' }}" 
                               maxlength="75" 
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                        <small class="text-muted">Obligatorio si tipo es EDIFICIO</small>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="piso" class="form-label">Piso</label>
                        <input type="text" class="form-control" id="piso" name="piso" 
                               value="{{ datos_adicionales.piso if datos_adicionales else '' }}" 
                               maxlength="15"
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="depto" class="form-label">Depto</label>
                        <input type="text" class="form-control" id="depto" name="depto" 
                               value="{{ datos_adicionales.depto if datos_adicionales else '' }}" 
                               maxlength="10"
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="casilla" class="form-label">Casilla</label>
                        <input type="text" class="form-control" id="casilla" name="casilla" 
                               value="{{ datos_adicionales.casilla if datos_adicionales else '' }}" 
                               maxlength="8">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="correo_electronico1" class="form-label campo-obligatorio">Correo Electrónico 1</label>
                        <input type="email" class="form-control" id="correo_electronico1" name="correo_electronico1" 
                               value="{{ datos_adicionales.correo_electronico1 if datos_adicionales else '' }}" 
                               maxlength="50" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="correo_electronico2" class="form-label">Correo Electrónico 2</label>
                        <input type="email" class="form-control" id="correo_electronico2" name="correo_electronico2" 
                               value="{{ datos_adicionales.correo_electronico2 if datos_adicionales else '' }}" 
                               maxlength="50">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_fijo1" class="form-label">Teléfono Fijo 1</label>
                        <input type="text" class="form-control" id="telefono_fijo1" name="telefono_fijo1" 
                               value="{{ datos_adicionales.telefono_fijo1 if datos_adicionales else '' }}" 
                               maxlength="35">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_fijo2" class="form-label">Teléfono Fijo 2</label>
                        <input type="text" class="form-control" id="telefono_fijo2" name="telefono_fijo2" 
                               value="{{ datos_adicionales.telefono_fijo2 if datos_adicionales else '' }}" 
                               maxlength="35">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="telefono_celular1" class="form-label campo-obligatorio">Teléfono Celular 1</label>
                        <input type="text" class="form-control" id="telefono_celular1" name="telefono_celular1" 
                               value="{{ datos_adicionales.telefono_celular1 if datos_adicionales else '' }}" 
                               maxlength="10" required>
                        <small class="text-muted">10 dígitos máximo</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_celular2" class="form-label">Teléfono Celular 2</label>
                        <input type="text" class="form-control" id="telefono_celular2" name="telefono_celular2" 
                               value="{{ datos_adicionales.telefono_celular2 if datos_adicionales else '' }}" 
                               maxlength="10">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_carrera_administrativa" class="form-label">N° Carrera Administrativa</label>
                        <input type="text" class="form-control" id="nro_carrera_administrativa" name="nro_carrera_administrativa" 
                               value="{{ datos_adicionales.nro_carrera_administrativa if datos_adicionales else '' }}" 
                               maxlength="12">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="licencia_conducir" class="form-label">Licencia Conducir</label>
                        <select class="form-select" id="licencia_conducir" name="licencia_conducir">
                            <option value="">Seleccionar...</option>
                            <option value="SI" {% if datos_adicionales and datos_adicionales.licencia_conducir == 'SI' %}selected{% endif %}>Sí</option>
                            <option value="NO" {% if datos_adicionales and datos_adicionales.licencia_conducir == 'NO' %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="categoria_licencia" class="form-label">Categoría Licencia</label>
                        <select class="form-select" id="categoria_licencia" name="categoria_licencia" 
                                {% if not datos_adicionales or datos_adicionales.licencia_conducir != 'SI' %}disabled{% endif %}>
                            <option value="">Seleccionar...</option>
                            <option value="A">A - Motocicletas</option>
                            <option value="B">B - Vehículos Livianos</option>
                            <option value="C">C - Vehículos Pesados</option>
                            <option value="D">D - Transporte Público</option>
                            <option value="E">E - Maquinaria Pesada</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="emergencia_contacto" class="form-label campo-obligatorio">En caso de emergencia comunicarse con</label>
                        <input type="text" class="form-control" id="emergencia_contacto" name="emergencia_contacto" 
                               value="{{ datos_adicionales.emergencia_contacto if datos_adicionales else '' }}" 
                               maxlength="150" required>
                        <small class="text-muted">Nombre - Teléfono</small>
                    </div>
                </div>
                
                <!-- Declaración Jurada de Bienes -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-white">
                                <h6 class="mb-0"><i class="fas fa-file-contract me-2"></i> Declaración Jurada de Bienes</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="nro_declaracion_jurada" class="form-label campo-obligatorio">N° Declaración Jurada</label>
                                        <input type="text" class="form-control" id="nro_declaracion_jurada" name="nro_declaracion_jurada" 
                                               value="{{ datos_adicionales.nro_declaracion_jurada if datos_adicionales else '' }}" 
                                               maxlength="20" required>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label for="fecha_declaracion_jurada" class="form-label campo-obligatorio">Fecha Declaración Jurada</label>
                                        <input type="date" class="form-control" id="fecha_declaracion_jurada" name="fecha_declaracion_jurada" 
                                               value="{{ datos_adicionales.fecha_declaracion_jurada if datos_adicionales else '' }}" 
                                               max="{{ hoy }}" required>
                                        <small class="text-muted">Debe ser menor o igual a hoy</small>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <small>
                                        <i class="fas fa-info-circle me-1"></i>
                                        La declaración jurada de bienes debe ser presentada antes o al momento de la posesión del cargo.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN D: Parientes -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-users me-2"></i> D. Parientes</h5>
                <p class="text-muted mb-3">Agregue sus parientes directos.</p>
                
                <!-- Lista de parientes existentes -->
                <div id="listaParientes">
                    {% for pariente in parientes %}
                    <div class="pariente-item" id="pariente-{{ pariente.id }}">
                        <div class="pariente-header">
                            <h6 class="mb-0">{{ pariente.parentesco_nombre }} - {{ pariente.nombres }} {{ pariente.primer_apellido }}</h6>
                            <button type="button" class="btn btn-sm btn-outline-danger btn-eliminar-pariente" 
                                    data-id="{{ pariente.id }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <small><strong>Teléfono:</strong> {{ pariente.telefono or 'No registrado' }}</small>
                            </div>
                            <div class="col-md-3">
                                <small><strong>Nacionalidad:</strong> {{ pariente.nacionalidad_nombre }}</small>
                            </div>
                            <div class="col-md-3">
                                <small><strong>Identificación:</strong> {{ pariente.tipo_identificacion }} {{ pariente.numero_identificacion }}</small>
                            </div>
                        </div>
                        <input type="hidden" name="parientes_existentes[]" value="{{ pariente.id }}">
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Formulario para nuevo pariente -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-user-plus me-2"></i> Agregar Nuevo Pariente</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="parentesco" class="form-label campo-obligatorio">Parentesco</label>
                                <select class="form-select" id="parentesco" name="parentesco">
                                    <option value="">Seleccionar...</option>
                                    {% for parent in parametros.parentesco %}
                                    <option value="{{ parent.codigo }}">{{ parent.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="primer_apellido_pariente" class="form-label campo-obligatorio">Primer Apellido</label>
                                <input type="text" class="form-control" id="primer_apellido_pariente" name="primer_apellido_pariente" maxlength="30">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="segundo_apellido_pariente" class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" id="segundo_apellido_pariente" name="segundo_apellido_pariente" maxlength="30">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="nombres_pariente" class="form-label campo-obligatorio">Nombres</label>
                                <input type="text" class="form-control" id="nombres_pariente" name="nombres_pariente" maxlength="30">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="nacionalidad_pariente" class="form-label campo-obligatorio">Nacionalidad</label>
                                <select class="form-select" id="nacionalidad_pariente" name="nacionalidad_pariente">
                                    <option value="">Seleccionar...</option>
                                    {% for nac in parametros.nacionalidad %}
                                    <option value="{{ nac.codigo }}">{{ nac.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="telefono_pariente" class="form-label">Teléfono</label>
                                <input type="text" class="form-control" id="telefono_pariente" name="telefono_pariente" maxlength="35">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="genero_pariente" class="form-label campo-obligatorio">Género</label>
                                <select class="form-select" id="genero_pariente" name="genero_pariente">
                                    <option value="">Seleccionar...</option>
                                    {% for genero in parametros.genero %}
                                    <option value="{{ genero.codigo }}">{{ genero.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="fecha_nacimiento_pariente" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" class="form-control" id="fecha_nacimiento_pariente" name="fecha_nacimiento_pariente" max="{{ hoy }}">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="tipo_identificacion_pariente" class="form-label campo-obligatorio">Tipo Identificación</label>
                                <select class="form-select" id="tipo_identificacion_pariente" name="tipo_identificacion_pariente">
                                    <option value="">Seleccionar...</option>
                                    <option value="CI">CI</option>
                                    <option value="PASAPORTE">Pasaporte</option>
                                    <option value="OTRO">Otro</option>
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="numero_identificacion_pariente" class="form-label campo-obligatorio">Número Identificación</label>
                                <input type="text" class="form-control" id="numero_identificacion_pariente" name="numero_identificacion_pariente" maxlength="15">
                            </div>
                            
                            <div class="col-md-3 mb-3 align-self-end">
                                <button type="button" class="btn btn-primary" id="btnAgregarPariente">
                                    <i class="fas fa-plus me-1"></i> Agregar Pariente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de parientes a agregar (oculta) -->
                <div id="parientesNuevos" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Botones de acción -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="btnGuardarBorrador">
                                <i class="fas fa-save me-1"></i> Guardar Borrador
                            </button>
                            
                            <button type="submit" class="btn btn-success" id="btnGuardarContinuar">
                                <i class="fas fa-save me-1"></i> Guardar y Continuar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Variables globales
const hoy = '{{ hoy }}';

// Calcular fecha máxima para nacimiento (18 años atrás)
document.addEventListener('DOMContentLoaded', function() {
    const fechaMaxNacimiento = new Date();
    fechaMaxNacimiento.setFullYear(fechaMaxNacimiento.getFullYear() - 18);
    document.getElementById('fecha_nacimiento').max = fechaMaxNacimiento.toISOString().split('T')[0];
    
    // Fecha caducidad CI debe ser mayor a hoy
    const fechaHoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_caducidad_ci').min = fechaHoy;
    
    // Configurar validaciones condicionales
    configurarValidaciones();
    
    // Configurar eventos para parientes
    configurarParientes();
});

function configurarValidaciones() {
    // País de nacimiento afecta departamento y provincia
    const paisNacimiento = document.getElementById('pais_nacimiento');
    const deptoNacimiento = document.getElementById('depto_nacimiento');
    const provinciaNacimiento = document.getElementById('provincia_nacimiento');
    
    paisNacimiento.addEventListener('change', function() {
        if (this.value === 'BOL') {
            deptoNacimiento.disabled = false;
            deptoNacimiento.required = true;
            provinciaNacimiento.disabled = false;
        } else {
            deptoNacimiento.disabled = true;
            deptoNacimiento.required = false;
            deptoNacimiento.value = '';
            provinciaNacimiento.disabled = true;
            provinciaNacimiento.value = '';
        }
    });
    
    // Gestora afecta NUA
    const gestora = document.getElementById('gestora');
    const nroNua = document.getElementById('nro_nua');
    
    gestora.addEventListener('change', function() {
        nroNua.disabled = !this.value;
        if (!this.value) nroNua.value = '';
    });
    
    // Tipo vivienda afecta campos relacionados
    const tipoVivienda = document.getElementById('tipo_vivienda');
    const nombreTipoVivienda = document.getElementById('nombre_tipo_vivienda');
    const piso = document.getElementById('piso');
    const deptoVivienda = document.getElementById('depto');
    
    tipoVivienda.addEventListener('change', function() {
        const esEdificio = this.value === 'EDIFICIO';
        nombreTipoVivienda.disabled = !esEdificio;
        piso.disabled = !esEdificio;
        deptoVivienda.disabled = !esEdificio;
        
        if (!esEdificio) {
            nombreTipoVivienda.value = '';
            piso.value = '';
            deptoVivienda.value = '';
        }
    });
    
    // Licencia conducir afecta categoría
    const licenciaConducir = document.getElementById('licencia_conducir');
    const categoriaLicencia = document.getElementById('categoria_licencia');
    
    licenciaConducir.addEventListener('change', function() {
        categoriaLicencia.disabled = this.value !== 'SI';
        if (this.value !== 'SI') categoriaLicencia.value = '';
    });
    
    // Género afecta libreta militar
    const genero = document.getElementById('genero');
    const libretaMilitar = document.getElementById('nro_libreta_militar');
    
    genero.addEventListener('change', function() {
        if (this.value === 'M') {
            libretaMilitar.setAttribute('data-obligatorio', 'true');
        } else {
            libretaMilitar.removeAttribute('data-obligatorio');
        }
    });
}

function configurarParientes() {
    const btnAgregarPariente = document.getElementById('btnAgregarPariente');
    const listaParientes = document.getElementById('listaParientes');
    const parientesNuevos = document.getElementById('parientesNuevos');
    
    btnAgregarPariente.addEventListener('click', function() {
        // Validar campos obligatorios
        const camposObligatorios = [
            'parentesco', 'primer_apellido_pariente', 'nombres_pariente',
            'nacionalidad_pariente', 'genero_pariente', 'tipo_identificacion_pariente',
            'numero_identificacion_pariente'
        ];
        
        let valido = true;
        camposObligatorios.forEach(campoId => {
            const campo = document.getElementById(campoId);
            if (!campo.value.trim()) {
                campo.classList.add('is-invalid');
                valido = false;
            } else {
                campo.classList.remove('is-invalid');
            }
        });
        
        if (!valido) {
            alert('Por favor complete todos los campos obligatorios del pariente');
            return;
        }
        
        // Crear objeto con datos del pariente
        const pariente = {
            parentesco: document.getElementById('parentesco').value,
            primer_apellido: document.getElementById('primer_apellido_pariente').value,
            segundo_apellido: document.getElementById('segundo_apellido_pariente').value,
            nombres: document.getElementById('nombres_pariente').value,
            nacionalidad: document.getElementById('nacionalidad_pariente').value,
            telefono: document.getElementById('telefono_pariente').value,
            genero: document.getElementById('genero_pariente').value,
            fecha_nacimiento: document.getElementById('fecha_nacimiento_pariente').value,
            tipo_identificacion: document.getElementById('tipo_identificacion_pariente').value,
            numero_identificacion: document.getElementById('numero_identificacion_pariente').value
        };
        
        // Agregar a lista oculta
        const index = document.querySelectorAll('[name^="parientes_nuevos"]').length;
        let inputsOcultos = '';
        
        for (const [key, value] of Object.entries(pariente)) {
            inputsOcultos += `<input type="hidden" name="parientes_nuevos[${index}][${key}]" value="${value}">`;
        }
        
        parientesNuevos.insertAdjacentHTML('beforeend', inputsOcultos);
        
        // Mostrar en lista visible
        const parentescoText = document.querySelector(`#parentesco option[value="${pariente.parentesco}"]`).textContent;
        const nacionalidadText = document.querySelector(`#nacionalidad_pariente option[value="${pariente.nacionalidad}"]`).textContent;
        const generoText = document.querySelector(`#genero_pariente option[value="${pariente.genero}"]`).textContent;
        
        const parienteHTML = `
            <div class="pariente-item" id="pariente-nuevo-${index}">
                <div class="pariente-header">
                    <h6 class="mb-0">${parentescoText} - ${pariente.nombres} ${pariente.primer_apellido}</h6>
                    <button type="button" class="btn btn-sm btn-outline-danger btn-eliminar-pariente-nuevo" 
                            data-index="${index}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <small><strong>Teléfono:</strong> ${pariente.telefono || 'No registrado'}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Nacionalidad:</strong> ${nacionalidadText}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Género:</strong> ${generoText}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Identificación:</strong> ${pariente.tipo_identificacion} ${pariente.numero_identificacion}</small>
                    </div>
                </div>
            </div>
        `;
        
        listaParientes.insertAdjacentHTML('beforeend', parienteHTML);
        
        // Limpiar formulario
        camposObligatorios.forEach(campoId => {
            document.getElementById(campoId).value = '';
        });
        document.getElementById('segundo_apellido_pariente').value = '';
        document.getElementById('telefono_pariente').value = '';
        document.getElementById('fecha_nacimiento_pariente').value = '';
        
        // Configurar evento eliminar para nuevo pariente
        document.querySelector(`#pariente-nuevo-${index} .btn-eliminar-pariente-nuevo`)
            .addEventListener('click', eliminarParienteNuevo);
    });
    
    // Configurar eventos eliminar para parientes existentes
    document.querySelectorAll('.btn-eliminar-pariente').forEach(btn => {
        btn.addEventListener('click', function() {
            const parienteId = this.getAttribute('data-id');
            if (confirm('¿Está seguro de eliminar este pariente?')) {
                // Marcar para eliminación
                const inputEliminar = document.createElement('input');
                inputEliminar.type = 'hidden';
                inputEliminar.name = 'parientes_eliminar[]';
                inputEliminar.value = parienteId;
                parientesNuevos.appendChild(inputEliminar);
                
                // Ocultar en la vista
                document.getElementById(`pariente-${parienteId}`).style.display = 'none';
            }
        });
    });
    
    // Función para eliminar pariente nuevo
    function eliminarParienteNuevo() {
        const index = this.getAttribute('data-index');
        if (confirm('¿Está seguro de eliminar este pariente?')) {
            // Eliminar inputs ocultos
            document.querySelectorAll(`[name^="parientes_nuevos[${index}]"]`).forEach(input => {
                input.remove();
            });
            
            // Eliminar de la vista
            document.getElementById(`pariente-nuevo-${index}`).remove();
        }
    }
}

// Validación antes de enviar
document.getElementById('formDatosPersonales').addEventListener('submit', function(e) {
    // Validar género masculino -> libreta militar obligatoria
    const genero = document.getElementById('genero').value;
    const libretaMilitar = document.getElementById('nro_libreta_militar').value;
    
    if (genero === 'M' && !libretaMilitar.trim()) {
        e.preventDefault();
        alert('El número de libreta de servicio militar es obligatorio para funcionarios varones');
        document.getElementById('nro_libreta_militar').focus();
        return;
    }
    
    // Validar si se agregó al menos un pariente
    const tieneParientes = document.querySelectorAll('.pariente-item').length > 0;
    if (!tieneParientes) {
        if (!confirm('No ha agregado ningún pariente. ¿Desea continuar sin agregar parientes?')) {
            e.preventDefault();
            return;
        }
    }
    
    // Mostrar mensaje de confirmación
    if (!confirm('¿Está seguro de guardar sus datos personales?')) {
        e.preventDefault();
    }
});
</script>
{% endblock %}

talento_humano/templates/funcionario/documentos.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/experiencia_laboral.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/formacion_academica.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/imprimir_formulario.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/revisar_formulario.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/seguro_social.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/funcionario/ver_tramite.html:
aun no hice nada aqui pero me dijiste que lo creara asi que seguro pondras algo aqui

talento_humano/templates/base.html:
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema Talento Humano{% endblock %}</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-users me-2"></i> Sistema Talento Humano
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if 'user_id' in session %}
                        <li class="nav-item">
                            <a class="nav-link" href="
                                {% if session.rol == 'admin' %}
                                    {{ url_for('dashboard_admin') }}
                                {% elif session.rol == 'funcionario' %}
                                    {{ url_for('dashboard_funcionario') }}
                                {% elif session.rol == 'jefe' %}
                                    {{ url_for('dashboard_jefe') }}
                                {% endif %}
                            ">
                                <i class="fas fa-home"></i> Inicio
                            </a>
                        </li>
                        
                        {% if session.rol == 'admin' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('funcionario_nuevo') }}">
                                    <i class="fas fa-user-plus"></i> Nuevo Funcionario
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('funcionarios_lista') }}">
                                    <i class="fas fa-list"></i> Funcionarios
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    {% if 'user_id' in session %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i>
                                {{ session.username }}
                                <span class="badge bg-light text-dark ms-1">{{ session.rol }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">
                                    <i class="fas fa-user me-2"></i> Mi Perfil
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('login') }}">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mensajes flash -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Contenido principal -->
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-light border-top">
        <div class="container text-center">
            <span class="text-muted">
                <i class="fas fa-copyright"></i> 2025 FICTICIA SRL - Sistema Talento Humano v1.0
            </span>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts personalizados -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

talento_humano/templates/dashboard_admin.html:
{% extends "base.html" %}

{% block title %}Dashboard Administrador{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-tachometer-alt me-2"></i> Dashboard Administrador
        </h1>
        <p class="text-muted">Panel de control del sistema</p>
    </div>
</div>

<div class="row">
    <div class="col-md-3 mb-4">
        <div class="card border-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Funcionarios</h6>
                        <h3 class="mb-0">{{ total_funcionarios }}</h3>
                    </div>
                    <div class="bg-primary text-white rounded-circle p-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Pendientes</h6>
                        <h3 class="mb-0">{{ pendientes }}</h3>
                    </div>
                    <div class="bg-warning text-white rounded-circle p-3">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Activos</h6>
                        <h3 class="mb-0">{{ activos }}</h3>
                    </div>
                    <div class="bg-success text-white rounded-circle p-3">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-danger">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Inactivos/Baja</h6>
                        <h3 class="mb-0">{{ total_funcionarios - activos - pendientes }}</h3>
                    </div>
                    <div class="bg-danger text-white rounded-circle p-3">
                        <i class="fas fa-user-minus fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i> Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus me-2"></i> Nuevo Funcionario
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('funcionarios_lista') }}" class="btn btn-success w-100">
                            <i class="fas fa-list me-2"></i> Ver Funcionarios
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-warning w-100">
                            <i class="fas fa-file-alt me-2"></i> Generar Reportes
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-2"></i> Bajas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/dashboard_funcionario.html:
{% extends "base.html" %}

{% block title %}Mi Panel - Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-tie me-2"></i> Mi Panel - {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
        </h1>
        <p class="text-muted">Bienvenido al sistema Talento Humano</p>
    </div>
</div>

{% if funcionario and funcionario['estado'] == 'pendiente' %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i> Acción Requerida</h5>
            <p class="mb-0">
                Debe completar su ficha TALENTO dentro de los próximos <strong>5 días hábiles</strong>.
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="alert-link">Haga clic aquí para completarla</a>.
            </p>
        </div>
    </div>
</div>
{% endif %}

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i> Progreso de mi Ficha TALENTO</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" 
                         style="width: {{ progreso }}%;" aria-valuenow="{{ progreso }}" 
                         aria-valuemin="0" aria-valuemax="100">
                        {{ progreso }}% Completado
                    </div>
                </div>
                
                <div class="row text-center">
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.datos_personales else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-user fa-2x mb-2 text-{{ 'success' if secciones.datos_personales else 'secondary' }}"></i>
                                <h6>Datos Personales</h6>
                                <small class="text-{{ 'success' if secciones.datos_personales else 'secondary' }}">
                                    {% if secciones.datos_personales %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.formacion else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-graduation-cap fa-2x mb-2 text-{{ 'success' if secciones.formacion else 'secondary' }}"></i>
                                <h6>Formación Académica</h6>
                                <small class="text-{{ 'success' if secciones.formacion else 'secondary' }}">
                                    {% if secciones.formacion %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.seguro_social else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-heartbeat fa-2x mb-2 text-{{ 'success' if secciones.seguro_social else 'secondary' }}"></i>
                                <h6>Seguro Social</h6>
                                <small class="text-{{ 'success' if secciones.seguro_social else 'secondary' }}">
                                    {% if secciones.seguro_social %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.experiencia else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-briefcase fa-2x mb-2 text-{{ 'success' if secciones.experiencia else 'secondary' }}"></i>
                                <h6>Experiencia Laboral</h6>
                                <small class="text-{{ 'success' if secciones.experiencia else 'secondary' }}">
                                    {% if secciones.experiencia %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-primary text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-id-card fa-3x"></i>
                </div>
                <h5>Completar Ficha TALENTO</h5>
                <p class="text-muted">Complete todos los datos requeridos</p>
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Continuar Ficha
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-success text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-file-upload fa-3x"></i>
                </div>
                <h5>Documentos de Soporte</h5>
                <p class="text-muted">Suba los documentos requeridos</p>
                <a href="{{ url_for('funcionario_documentos') }}" class="btn btn-success">
                    <i class="fas fa-upload me-1"></i> Subir Documentos
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-info text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-history fa-3x"></i>
                </div>
                <h5>Estado de mi Trámite</h5>
                <p class="text-muted">Revise el estado de su registro</p>
                <a href="{{ url_for('funcionario_tramite') }}" class="btn btn-info">
                    <i class="fas fa-search me-1"></i> Ver Estado
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i> Información Importante</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>Tiene <strong>5 días hábiles</strong> para completar su ficha TALENTO.</li>
                    <li>Los documentos deben ser escaneados en formato PDF o imagen.</li>
                    <li>Para consultas, contacte al departamento de Recursos Humanos.</li>
                    <li>Guarde su número de trámite una vez generado.</li>
                    <li>Puede guardar su progreso y continuar después.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/dashboard_jefe.html:
{% extends "base.html" %}

{% block title %}Dashboard - Jefe{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-cog me-2"></i> Dashboard - Jefe de Departamento
        </h1>
        <p class="text-muted">Panel de revisión y aprobación</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0">
                    <i class="fas fa-clipboard-check me-2"></i> Formularios Pendientes
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Tiene <strong>3</strong> formularios pendientes de revisión.</p>
                <a href="#" class="btn btn-warning">
                    <i class="fas fa-eye me-1"></i> Revisar Pendientes
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i> Documentos por Validar
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Hay <strong>7</strong> documentos esperando validación.</p>
                <a href="#" class="btn btn-info">
                    <i class="fas fa-check-circle me-1"></i> Validar Documentos
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/funcionario_baja.html:
{% extends "base.html" %}

{% block title %}Baja de Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user-minus me-2 text-danger"></i> 
                    Dar de Baja Funcionario
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }}</p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                    <i class="fas fa-times me-1"></i> Cancelar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i> Confirmar Baja
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h6><i class="fas fa-warning me-2"></i> ¡Atención!</h6>
                    <p class="mb-0">
                        Está a punto de dar de baja al funcionario:
                        <strong>{{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}</strong>
                    </p>
                </div>
                
                <div class="mb-4">
                    <h6>Información del Funcionario:</h6>
                    <table class="table table-sm">
                        <tr>
                            <th width="40%">Nombre Completo:</th>
                            <td>{{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}</td>
                        </tr>
                        <tr>
                            <th>CI:</th>
                            <td>{{ funcionario['ci'] }}</td>
                        </tr>
                        <tr>
                            <th>Cargo:</th>
                            <td>{{ funcionario['cargo'] or 'No asignado' }}</td>
                        </tr>
                        <tr>
                            <th>Unidad:</th>
                            <td>{{ funcionario['unidad_organizacional'] or 'No asignada' }}</td>
                        </tr>
                        <tr>
                            <th>Usuario Sistema:</th>
                            <td>{{ funcionario['usuario_aplicacion'] or 'No generado' }}</td>
                        </tr>
                    </table>
                </div>
                
                <form method="POST" action="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}">
                    <div class="mb-3">
                        <label for="motivo_baja" class="form-label">Motivo de la Baja *</label>
                        <select class="form-select" id="motivo_baja" name="motivo_baja" required>
                            <option value="">Seleccionar motivo...</option>
                            <option value="RENUNCIA">Renuncia Voluntaria</option>
                            <option value="DESPIDO">Despido</option>
                            <option value="JUBILACION">Jubilación</option>
                            <option value="FIN_CONTRATO">Fin de Contrato</option>
                            <option value="OTRO">Otro</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="nro_memorandum_retiro" class="form-label">N° Memorándum de Retiro</label>
                        <input type="text" class="form-control" id="nro_memorandum_retiro" name="nro_memorandum_retiro" 
                               placeholder="Ej: MEM-RET-2025-001">
                    </div>
                    
                    <div class="mb-3">
                        <label for="fecha_retiro" class="form-label">Fecha de Retiro *</label>
                        <input type="date" class="form-control" id="fecha_retiro" name="fecha_retiro" 
                               value="{{ hoy }}" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="observaciones" class="form-label">Observaciones</label>
                        <textarea class="form-control" id="observaciones" name="observaciones" 
                                  rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-danger" 
                                onclick="return confirm('¿ESTÁ SEGURO de dar de baja a este funcionario? Esta acción NO se puede deshacer fácilmente.')">
                            <i class="fas fa-user-minus me-1"></i> Confirmar Baja
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Establecer fecha actual como fecha de retiro por defecto
    const hoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_retiro').value = hoy;
    document.getElementById('fecha_retiro').max = hoy;
});
</script>
{% endblock %}

talento_humano/templates/funcionario_editar.html:
{% extends "base.html" %}

{% block title %}Editar Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-edit me-2"></i> 
                    Editar Funcionario: {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }}</p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                    <i class="fas fa-times me-1"></i> Cancelar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}">
                    <!-- Pestañas igual que en registro pero con datos cargados -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                            <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" 
                                   value="{{ funcionario['primer_apellido'] or '' }}" maxlength="30" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="primer_nombre" class="form-label">Primer Nombre *</label>
                            <input type="text" class="form-control" id="primer_nombre" name="primer_nombre" 
                                   value="{{ funcionario['primer_nombre'] or '' }}" maxlength="30" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
                            <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" 
                                   value="{{ funcionario['segundo_apellido'] or '' }}" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                            <input type="text" class="form-control" id="segundo_nombre" name="segundo_nombre" 
                                   value="{{ funcionario['segundo_nombre'] or '' }}" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-select" id="estado" name="estado">
                                <option value="pendiente" {% if funcionario['estado'] == 'pendiente' %}selected{% endif %}>Pendiente</option>
                                <option value="activo" {% if funcionario['estado'] == 'activo' %}selected{% endif %}>Activo</option>
                                <option value="inactivo" {% if funcionario['estado'] == 'inactivo' %}selected{% endif %}>Inactivo</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nro_resolucion" class="form-label">Número de Resolución</label>
                            <input type="text" class="form-control" id="nro_resolucion" name="nro_resolucion" 
                                   value="{{ funcionario['nro_resolucion'] or '' }}" maxlength="20">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="fecha_resolucion" class="form-label">Fecha Resolución</label>
                            <input type="date" class="form-control" id="fecha_resolucion" name="fecha_resolucion" 
                                   value="{{ funcionario['fecha_resolucion'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fecha_posesion" class="form-label">Fecha Posesión</label>
                            <input type="date" class="form-control" id="fecha_posesion" name="fecha_posesion" 
                                   value="{{ funcionario['fecha_posesion'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nro_item" class="form-label">Número del Ítem</label>
                            <input type="text" class="form-control" id="nro_item" name="nro_item" 
                                   value="{{ funcionario['nro_item'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="administracion" class="form-label">Administración</label>
                            <select class="form-select" id="administracion" name="administracion">
                                <option value="">Seleccionar...</option>
                                <option value="SISTEMA CENTRAL" {% if funcionario['administracion'] == 'SISTEMA CENTRAL' %}selected{% endif %}>Sistema Central</option>
                                <option value="RRHH" {% if funcionario['administracion'] == 'RRHH' %}selected{% endif %}>Recursos Humanos</option>
                                <option value="FINANZAS" {% if funcionario['administracion'] == 'FINANZAS' %}selected{% endif %}>Finanzas</option>
                                <option value="SISTEMAS" {% if funcionario['administracion'] == 'SISTEMAS' %}selected{% endif %}>Sistemas</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="unidad_organizacional" class="form-label">Unidad Organizacional</label>
                            <select class="form-select" id="unidad_organizacional" name="unidad_organizacional">
                                <option value="">Seleccionar...</option>
                                <option value="DIRECCIÓN GENERAL" {% if funcionario['unidad_organizacional'] == 'DIRECCIÓN GENERAL' %}selected{% endif %}>Dirección General</option>
                                <option value="GERENCIA" {% if funcionario['unidad_organizacional'] == 'GERENCIA' %}selected{% endif %}>Gerencia</option>
                                <option value="DEPARTAMENTO" {% if funcionario['unidad_organizacional'] == 'DEPARTAMENTO' %}selected{% endif %}>Departamento</option>
                                <option value="ÁREA" {% if funcionario['unidad_organizacional'] == 'ÁREA' %}selected{% endif %}>Área</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cargo" class="form-label">Cargo</label>
                            <input type="text" class="form-control" id="cargo" name="cargo" 
                                   value="{{ funcionario['cargo'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="puesto" class="form-label">Puesto</label>
                            <input type="text" class="form-control" id="puesto" name="puesto" 
                                   value="{{ funcionario['puesto'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="direccion_oficina" class="form-label">Dirección Oficina</label>
                            <input type="text" class="form-control" id="direccion_oficina" name="direccion_oficina" 
                                   value="{{ funcionario['direccion_oficina'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="piso_interno" class="form-label">Piso / Interno</label>
                            <input type="text" class="form-control" id="piso_interno" name="piso_interno" 
                                   value="{{ funcionario['piso_interno'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/funcionario_nuevo.html:
{% extends "base.html" %}

{% block title %}Nuevo Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-plus me-2"></i> Registrar Nuevo Funcionario
        </h1>
        <p class="text-muted">Complete todos los datos del funcionario según formulario R-100</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="formTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab">
                            <i class="fas fa-file-contract me-1"></i> Datos de Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignar-item" data-bs-toggle="tab">
                            <i class="fas fa-briefcase me-1"></i> Asignar Ítem
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#archivos" data-bs-toggle="tab">
                            <i class="fas fa-file-upload me-1"></i> Archivos
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('funcionario_nuevo') }}" enctype="multipart/form-data">
                    <div class="tab-content">
                        <!-- Pestaña 1: Datos Personales -->
                        <div class="tab-pane fade show active" id="datos-personales">
                            <h5 class="mb-4">Datos Personales del Funcionario</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="ci" class="form-label">Número de Identificación *</label>
                                    <input type="text" class="form-control" id="ci" name="ci" 
                                           placeholder="Ej: 1234567" maxlength="15" required>
                                    <small class="text-muted">15 caracteres máximo</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="tipo_identificacion" class="form-label">Tipo Identificación *</label>
                                    <select class="form-select" id="tipo_identificacion" name="tipo_identificacion" required>
                                        <option value="CI">Carnet de Identidad (CI)</option>
                                        <option value="PASAPORTE">Pasaporte</option>
                                        <option value="OTRO">Otro</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                                    <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" 
                                           placeholder="Primer apellido" maxlength="30" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
                                    <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" 
                                           placeholder="Segundo apellido" maxlength="30">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tercer_apellido" class="form-label">Tercer Apellido</label>
                                    <input type="text" class="form-control" id="tercer_apellido" name="tercer_apellido" 
                                           placeholder="Apellido de casada" maxlength="30">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="primer_nombre" class="form-label">Primer Nombre *</label>
                                    <input type="text" class="form-control" id="primer_nombre" name="primer_nombre" 
                                           placeholder="Primer nombre" maxlength="30" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                                    <input type="text" class="form-control" id="segundo_nombre" name="segundo_nombre" 
                                           placeholder="Segundo nombre" maxlength="30">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tercer_nombre" class="form-label">Tercer Nombre</label>
                                    <input type="text" class="form-control" id="tercer_nombre" name="tercer_nombre" 
                                           placeholder="Tercer nombre" maxlength="30">
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="nextTab('datos-resolucion')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 2: Datos de Resolución -->
                        <div class="tab-pane fade" id="datos-resolucion">
                            <h5 class="mb-4">Datos de la Resolución</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nro_resolucion" class="form-label">Número de Resolución *</label>
                                    <input type="text" class="form-control" id="nro_resolucion" name="nro_resolucion" 
                                           placeholder="Ej: RES-2025-001" maxlength="20" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_resolucion" class="form-label">Fecha de Resolución *</label>
                                    <input type="date" class="form-control" id="fecha_resolucion" name="fecha_resolucion" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_posesion" class="form-label">Fecha de Posesión *</label>
                                    <input type="date" class="form-control" id="fecha_posesion" name="fecha_posesion" required>
                                    <small class="text-muted">No mayor a la fecha actual</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nro_memorandum_designacion" class="form-label">N° Memorándum Designación</label>
                                    <input type="text" class="form-control" id="nro_memorandum_designacion" name="nro_memorandum_designacion" 
                                           placeholder="Opcional" maxlength="20">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_memorandum" class="form-label">Fecha Memorándum</label>
                                    <input type="date" class="form-control" id="fecha_memorandum" name="fecha_memorandum">
                                    <small class="text-muted">No mayor a la fecha actual ni menor a fecha resolución</small>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('datos-personales')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="nextTab('asignar-item')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 3: Asignar Ítem -->
                        <div class="tab-pane fade" id="asignar-item">
                            <h5 class="mb-4">Asignación del Ítem</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nro_item" class="form-label">Número del Ítem *</label>
                                    <input type="text" class="form-control" id="nro_item" name="nro_item" 
                                           placeholder="Ej: 278" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="administracion" class="form-label">Administración</label>
                                    <select class="form-select" id="administracion" name="administracion">
                                        <option value="">Seleccionar...</option>
                                        <option value="SISTEMA CENTRAL">Sistema Central</option>
                                        <option value="RRHH">Recursos Humanos</option>
                                        <option value="FINANZAS">Finanzas</option>
                                        <option value="SISTEMAS">Sistemas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="jerarquia" class="form-label">Jerarquía</label>
                                    <select class="form-select" id="jerarquia" name="jerarquia">
                                        <option value="">Seleccionar...</option>
                                        <option value="ALTA DIRECCIÓN">Alta Dirección</option>
                                        <option value="EJECUTIVO">Ejecutivo</option>
                                        <option value="OPERATIVO">Operativo</option>
                                        <option value="ASESORÍA">Asesoría</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="depende_de" class="form-label">Depende de</label>
                                    <input type="text" class="form-control" id="depende_de" name="depende_de" 
                                           placeholder="Jefe inmediato o departamento">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="unidad_organizacional" class="form-label">Unidad Organizacional</label>
                                    <select class="form-select" id="unidad_organizacional" name="unidad_organizacional">
                                        <option value="">Seleccionar...</option>
                                        <option value="DIRECCIÓN GENERAL">Dirección General</option>
                                        <option value="GERENCIA">Gerencia</option>
                                        <option value="DEPARTAMENTO">Departamento</option>
                                        <option value="ÁREA">Área</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cargo" class="form-label">Cargo</label>
                                    <input type="text" class="form-control" id="cargo" name="cargo" 
                                           placeholder="Ej: Analista de Sistemas">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="puesto" class="form-label">Puesto</label>
                                    <input type="text" class="form-control" id="puesto" name="puesto" 
                                           placeholder="Ej: P-045">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="direccion_oficina" class="form-label">Dirección Oficina</label>
                                    <input type="text" class="form-control" id="direccion_oficina" name="direccion_oficina" 
                                           placeholder="Edificio, oficina, etc.">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="piso_interno" class="form-label">Piso / Número Interno</label>
                                    <input type="text" class="form-control" id="piso_interno" name="piso_interno" 
                                           placeholder="Ej: 3er piso, Oficina 301">
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('datos-resolucion')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="nextTab('archivos')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 4: Archivos -->
                        <div class="tab-pane fade" id="archivos">
                            <h5 class="mb-4">Cargar Archivos y Generar Credenciales</h5>
                            
                            <div class="row mb-4">
                                <div class="col-md-4 mb-3">
                                    <label for="firma" class="form-label">Firma (Imagen)</label>
                                    <input type="file" class="form-control" id="firma" name="firma" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="foto" class="form-label">Foto (Imagen)</label>
                                    <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="huella" class="form-label">Huella (Imagen)</label>
                                    <input type="file" class="form-control" id="huella" name="huella" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                            </div>
                            
                            <div class="card bg-light mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-key me-2"></i> Datos Generados Automáticamente</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Usuario Aplicación</label>
                                            <input type="text" class="form-control" id="usuario_generado" readonly
                                                   placeholder="Se generará automáticamente">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Clave Temporal</label>
                                            <input type="text" class="form-control" id="clave_generada" readonly
                                                   placeholder="Se generará automáticamente" value="CI del funcionario">
                                            <small class="text-muted">La contraseña inicial será el número de CI</small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Correo Institucional</label>
                                            <input type="text" class="form-control" id="correo_interno" readonly
                                                   placeholder="Se generará automáticamente">
                                        </div>
                                    </div>
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="fas fa-info-circle me-1"></i>
                                            Estos datos se generarán automáticamente al guardar. 
                                            El usuario se crea concatenando primer nombre y primer apellido.
                                            El correo será: usuario@gobierno.talento.bo
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('asignar-item')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Registrar Funcionario
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Navegación entre pestañas
function nextTab(nextTabId) {
    // Validar pestaña actual antes de avanzar
    const currentTab = document.querySelector('#formTabs .nav-link.active').getAttribute('href').substring(1);
    
    if (currentTab === 'datos-personales') {
        if (!validarDatosPersonales()) return;
    } else if (currentTab === 'datos-resolucion') {
        if (!validarDatosResolucion()) return;
    } else if (currentTab === 'asignar-item') {
        if (!validarAsignarItem()) return;
    }
    
    // Cambiar a siguiente pestaña
    const nextTabElement = new bootstrap.Tab(document.querySelector(`a[href="#${nextTabId}"]`));
    nextTabElement.show();
}

function prevTab(prevTabId) {
    const prevTabElement = new bootstrap.Tab(document.querySelector(`a[href="#${prevTabId}"]`));
    prevTabElement.show();
}

// Validaciones
function validarDatosPersonales() {
    const ci = document.getElementById('ci').value.trim();
    const primerApellido = document.getElementById('primer_apellido').value.trim();
    const primerNombre = document.getElementById('primer_nombre').value.trim();
    
    if (!ci || !primerApellido || !primerNombre) {
        alert('Por favor complete los campos obligatorios de Datos Personales');
        return false;
    }
    return true;
}

function validarDatosResolucion() {
    const nroResolucion = document.getElementById('nro_resolucion').value.trim();
    const fechaResolucion = document.getElementById('fecha_resolucion').value;
    const fechaPosesion = document.getElementById('fecha_posesion').value;
    
    if (!nroResolucion || !fechaResolucion || !fechaPosesion) {
        alert('Por favor complete los campos obligatorios de Datos de Resolución');
        return false;
    }
    
    // Validar que fecha posesión no sea mayor a hoy
    const hoy = new Date().toISOString().split('T')[0];
    if (fechaPosesion > hoy) {
        alert('La fecha de posesión no puede ser mayor a la fecha actual');
        return false;
    }
    
    return true;
}

function validarAsignarItem() {
    const nroItem = document.getElementById('nro_item').value.trim();
    
    if (!nroItem) {
        alert('El número de ítem es obligatorio');
        return false;
    }
    return true;
}

// Generar vista previa de usuario y correo
document.getElementById('primer_nombre').addEventListener('blur', generarUsuarioPreview);
document.getElementById('primer_apellido').addEventListener('blur', generarUsuarioPreview);

function generarUsuarioPreview() {
    const primerNombre = document.getElementById('primer_nombre').value.trim().toLowerCase();
    const primerApellido = document.getElementById('primer_apellido').value.trim().toLowerCase();
    
    if (primerNombre && primerApellido) {
        const usuario = `${primerNombre}.${primerApellido}`;
        document.getElementById('usuario_generado').value = usuario;
        document.getElementById('correo_interno').value = `${usuario}@gobierno.talento.bo`;
    }
}

// Setear fecha máxima a hoy en campos de fecha
document.addEventListener('DOMContentLoaded', function() {
    const hoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_resolucion').max = hoy;
    document.getElementById('fecha_posesion').max = hoy;
    document.getElementById('fecha_memorandum').max = hoy;
});
</script>
{% endblock %}

talento_humano/templates/funcionario_ver.html:
{% extends "base.html" %}

{% block title %}Ver Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user me-2"></i> 
                    {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }} | 
                    Estado: 
                    {% if funcionario['estado'] == 'pendiente' %}
                        <span class="badge bg-warning">Pendiente</span>
                    {% elif funcionario['estado'] == 'activo' %}
                        <span class="badge bg-success">Activo</span>
                    {% elif funcionario['estado'] == 'baja' %}
                        <span class="badge bg-danger">Baja</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ funcionario['estado'] }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <a href="{{ url_for('funcionarios_lista') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
                <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Editar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <!-- Pestañas de información -->
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="infoTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab">
                            <i class="fas fa-file-contract me-1"></i> Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignacion-item" data-bs-toggle="tab">
                            <i class="fas fa-briefcase me-1"></i> Asignación
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#credenciales" data-bs-toggle="tab">
                            <i class="fas fa-key me-1"></i> Credenciales
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Pestaña 1: Datos Personales -->
                    <div class="tab-pane fade show active" id="datos-personales">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información Personal</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">CI/Número Identificación:</th>
                                        <td>{{ funcionario['ci'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Tipo Identificación:</th>
                                        <td>{{ funcionario['tipo_identificacion'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Nombre Completo:</th>
                                        <td>
                                            {{ funcionario['primer_apellido'] }} 
                                            {{ funcionario['segundo_apellido'] or '' }} 
                                            {{ funcionario['tercer_apellido'] or '' }}
                                            {{ funcionario['primer_nombre'] }}
                                            {{ funcionario['segundo_nombre'] or '' }}
                                            {{ funcionario['tercer_nombre'] or '' }}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información del Sistema</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Estado:</th>
                                        <td>
                                            {% if funcionario['estado'] == 'pendiente' %}
                                                <span class="badge bg-warning">Pendiente</span>
                                            {% elif funcionario['estado'] == 'activo' %}
                                                <span class="badge bg-success">Activo</span>
                                            {% elif funcionario['estado'] == 'baja' %}
                                                <span class="badge bg-danger">Baja</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Registro:</th>
                                        <td>{{ funcionario['fecha_registro'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Última Actualización:</th>
                                        <td>{{ funcionario['fecha_actualizacion'] or 'Sin actualizar' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 2: Datos de Resolución -->
                    <div class="tab-pane fade" id="datos-resolucion">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Resolución:</th>
                                        <td>{{ funcionario['nro_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Resolución:</th>
                                        <td>{{ funcionario['fecha_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Posesión:</th>
                                        <td>{{ funcionario['fecha_posesion'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Memorándum:</th>
                                        <td>{{ funcionario['nro_memorandum_designacion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Memorándum:</th>
                                        <td>{{ funcionario['fecha_memorandum'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 3: Asignación de Ítem -->
                    <div class="tab-pane fade" id="asignacion-item">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Ítem:</th>
                                        <td>{{ funcionario['nro_item'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Administración:</th>
                                        <td>{{ funcionario['administracion'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Jerarquía:</th>
                                        <td>{{ funcionario['jerarquia'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Depende de:</th>
                                        <td>{{ funcionario['depende_de'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Unidad Organizacional:</th>
                                        <td>{{ funcionario['unidad_organizacional'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Cargo:</th>
                                        <td>{{ funcionario['cargo'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Puesto:</th>
                                        <td>{{ funcionario['puesto'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Dirección Oficina:</th>
                                        <td>{{ funcionario['direccion_oficina'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Piso/Interno:</th>
                                        <td>{{ funcionario['piso_interno'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 4: Credenciales -->
                    <div class="tab-pane fade" id="credenciales">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-muted mb-3">Credenciales del Sistema</h6>
                                        <table class="table table-sm">
                                            <tr>
                                                <th width="40%">Usuario Aplicación:</th>
                                                <td>
                                                    {% if funcionario['usuario_aplicacion'] %}
                                                        <code>{{ funcionario['usuario_aplicacion'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Clave Temporal:</th>
                                                <td>
                                                    {% if funcionario['clave_generada'] %}
                                                        <code>{{ funcionario['clave_generada'] }}</code>
                                                        <small class="text-muted d-block">(CI del funcionario)</small>
                                                    {% else %}
                                                        <span class="text-muted">No generada</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Correo Institucional:</th>
                                                <td>
                                                    {% if funcionario['correo_interno'] %}
                                                        <code>{{ funcionario['correo_interno'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Estado Usuario:</th>
                                                <td>
                                                    {% if funcionario['estado'] == 'baja' %}
                                                        <span class="badge bg-danger">Usuario Inactivo</span>
                                                    {% else %}
                                                        <span class="badge bg-success">Usuario Activo</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-cogs me-2"></i> Acciones Disponibles</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" 
                           class="btn btn-primary w-100">
                            <i class="fas fa-edit me-1"></i> Editar Datos
                        </a>
                    </div>
                    {% if funcionario['estado'] == 'baja' %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_activar', ci=funcionario['ci']) }}" 
                           class="btn btn-success w-100"
                           onclick="return confirm('¿Está seguro de reactivar este funcionario?')">
                            <i class="fas fa-user-check me-1"></i> Reactivar
                        </a>
                    </div>
                    {% else %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}" 
                           class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-1"></i> Dar de Baja
                        </a>
                    </div>
                    {% endif %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionarios_lista') }}" 
                           class="btn btn-secondary w-100">
                            <i class="fas fa-list me-1"></i> Volver a Lista
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-info w-100" onclick="window.print()">
                            <i class="fas fa-print me-1"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/funcionarios_lista.html:
{% extends "base.html" %}

{% block title %}Lista de Funcionarios{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-users me-2"></i> Funcionarios Registrados
                </h1>
                <p class="text-muted">Gestión de funcionarios del sistema</p>
            </div>
            <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary">
                <i class="fas fa-user-plus me-1"></i> Nuevo Funcionario
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {% if funcionarios %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>CI</th>
                                <th>Nombre Completo</th>
                                <th>Cargo</th>
                                <th>Unidad</th>
                                <th>Usuario</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for funcionario in funcionarios %}
                            <tr>
                                <td>{{ funcionario['ci'] }}</td>
                                <td>
                                    {{ funcionario['primer_apellido'] }}
                                    {% if funcionario['segundo_apellido'] %} {{ funcionario['segundo_apellido'] }}{%
                                    endif %}
                                    {{ funcionario['primer_nombre'] }}
                                </td>
                                <td>{{ funcionario['cargo'] or 'Sin asignar' }}</td>
                                <td>{{ funcionario['unidad_organizacional'] or 'Sin asignar' }}</td>
                                <td>
                                    {% if funcionario['usuario_aplicacion'] %}
                                    <span class="badge bg-info">{{ funcionario['usuario_aplicacion'] }}</span>
                                    {% else %}
                                    <span class="badge bg-secondary">No generado</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if funcionario['estado'] == 'pendiente' %}
                                    <span class="badge bg-warning">Pendiente</span>
                                    {% elif funcionario['estado'] == 'activo' %}
                                    <span class="badge bg-success">Activo</span>
                                    {% else %}
                                    <span class="badge bg-danger">{{ funcionario['estado'] }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ funcionario['fecha_registro'][:10] }}</td>
                                <!-- En la tabla, actualiza la columna de Acciones: -->
                                <td>
                                    <!-- Botón Ver -->
                                    <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}"
                                        class="btn btn-sm btn-outline-primary" title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </a>

                                    <!-- Botón Editar -->
                                    <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}"
                                        class="btn btn-sm btn-outline-success" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>

                                    <!-- Botón Baja/Activar según estado -->
                                    {% if funcionario['estado'] == 'baja' %}
                                    <a href="{{ url_for('funcionario_activar', ci=funcionario['ci']) }}"
                                        class="btn btn-sm btn-outline-warning" title="Reactivar"
                                        onclick="return confirm('¿Está seguro de reactivar este funcionario?')">
                                        <i class="fas fa-user-check"></i>
                                    </a>
                                    {% else %}
                                    <a href="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}"
                                        class="btn btn-sm btn-outline-danger" title="Dar de baja">
                                        <i class="fas fa-user-minus"></i>
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-users fa-4x text-muted mb-3"></i>
                    <h5>No hay funcionarios registrados</h5>
                    <p class="text-muted">Comience registrando un nuevo funcionario</p>
                    <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-1"></i> Registrar Primer Funcionario
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/index.html:
{% extends "base.html" %}

{% block title %}Inicio - Sistema Talento Humano{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="card border-0 shadow-lg">
            <div class="card-body py-5">
                <h1 class="display-4 text-primary mb-4">
                    <i class="fas fa-users"></i> Sistema Talento Humano
                </h1>
                <p class="lead mb-4">
                    Sistema de Gestión de Recursos Humanos<br>
                    <strong>FICTICIA SRL</strong>
                </p>
                
                <div class="row mt-5">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                                <h5>Administradores</h5>
                                <p class="text-muted">Gestión completa del sistema</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <i class="fas fa-user-tie fa-3x text-success mb-3"></i>
                                <h5>Funcionarios</h5>
                                <p class="text-muted">Complete su ficha TALENTO</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <i class="fas fa-user-cog fa-3x text-warning mb-3"></i>
                                <h5>Jefes</h5>
                                <p class="text-muted">Revisión y aprobación</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5">
                    <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

talento_humano/templates/login.html:
{% extends "base.html" %}

{% block title %}Inicio de Sesión{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-sign-in-alt me-2"></i> Inicio de Sesión
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('login') }}">
                    <div class="mb-3">
                        <label for="tipo_usuario" class="form-label">Tipo de Usuario</label>
                        <select class="form-select" id="tipo_usuario" name="tipo_usuario" required>
                            <option value="">Seleccionar...</option>
                            <option value="admin">Administrador</option>
                            <option value="funcionario">Funcionario</option>
                            <option value="jefe">Jefe de Departamento</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="ci" class="form-label">Carnet de Identidad (CI)</label>
                        <input type="text" class="form-control" id="ci" name="ci" 
                               placeholder="Ej: 1234567" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="username" class="form-label">Nombre de Usuario</label>
                        <input type="text" class="form-control" id="username" name="username" 
                               placeholder="Ingrese su usuario" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" name="password" 
                               placeholder="Ingrese su contraseña" required>
                    </div>
                    
                    <div class="mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <small class="text-muted d-block">Código del Sistema</small>
                                        <h3 class="text-primary mb-0" id="codigo-display">{{ codigo }}</h3>
                                        <small class="text-muted">Copie este código</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="codigo_verificacion" class="form-label">Código de Verificación</label>
                                <input type="text" class="form-control text-center" id="codigo_verificacion" 
                                       name="codigo_verificacion" placeholder="XXXX" maxlength="4" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-2" 
                                        onclick="generarNuevoCodigo()">
                                    <i class="fas fa-sync-alt me-1"></i> Nuevo Código
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                        </button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center text-muted">
                <small>Credenciales demo: admin / admin123</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function generarNuevoCodigo() {
    fetch('{{ url_for("generar_codigo") }}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('codigo-display').textContent = data.codigo;
        });
}
</script>
{% endblock %}

talento_humano/.gitignore:
__pycache__/
*.pyc
instance/
.env
*.db
.DS_Store
uploads/

talento_humano/app.py:
import os
from flask import Flask, render_template, request, redirect, url_for, flash, session
from dotenv import load_dotenv
from database import Database
from auth import Auth
from datetime import datetime, timedelta

# Cargar variables de entorno
load_dotenv()

# Crear aplicación Flask
app = Flask(__name__)
app.secret_key = os.environ.get('SECRET_KEY') or 'clave_secreta_default'

# Configuración
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB

# Inicializar base de datos y autenticación
db = Database()
auth = Auth(db)

# Crear carpetas necesarias
os.makedirs('instance', exist_ok=True)
os.makedirs('uploads', exist_ok=True)
os.makedirs('templates', exist_ok=True)
os.makedirs('static/css', exist_ok=True)
os.makedirs('static/js', exist_ok=True)

# ==================== RUTAS PÚBLICAS ====================

@app.route('/')
def index():
    """Página principal"""
    if 'user_id' in session:
        # Redirigir al dashboard según rol
        rol = session.get('rol')
        if rol == 'admin':
            return redirect(url_for('dashboard_admin'))
        elif rol == 'funcionario':
            return redirect(url_for('dashboard_funcionario'))
        elif rol == 'jefe':
            return redirect(url_for('dashboard_jefe'))
    
    return render_template('index.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    """Página de login"""
    if 'user_id' in session:
        return redirect(url_for('index'))
    
    # Generar código de verificación si no existe en sesión
    if 'codigo_verificacion' not in session:
        session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    
    if request.method == 'POST':
        # Obtener datos del formulario
        tipo_usuario = request.form.get('tipo_usuario')
        ci = request.form.get('ci')
        username = request.form.get('username')
        password = request.form.get('password')
        codigo_ingresado = request.form.get('codigo_verificacion')
        
        # Validar código de verificación
        if codigo_ingresado != session.get('codigo_verificacion'):
            flash('Código de verificación incorrecto', 'danger')
            session['codigo_verificacion'] = auth.generar_codigo_verificacion()
            return render_template('login.html', codigo=session['codigo_verificacion'])
        
        # Buscar usuario
        usuario = db.get_usuario_by_username(username)
        
        if usuario and usuario['ci'] == ci:
            # Verificar contraseña
            if auth.verify_password(password, usuario['password_hash']):
                # Verificar que el rol coincida
                if usuario['rol'] == tipo_usuario:
                    # Iniciar sesión
                    session['user_id'] = usuario['id']
                    session['username'] = usuario['username']
                    session['ci'] = usuario['ci']
                    session['email'] = usuario['email']
                    session['rol'] = usuario['rol']
                    
                    # Actualizar último acceso
                    db.actualizar_ultimo_acceso(usuario['id'])
                    
                    flash(f'¡Bienvenido(a) {usuario["username"]}!', 'success')
                    
                    # Redirigir según rol
                    if usuario['rol'] == 'admin':
                        return redirect(url_for('dashboard_admin'))
                    elif usuario['rol'] == 'funcionario':
                        return redirect(url_for('dashboard_funcionario'))
                    elif usuario['rol'] == 'jefe':
                        return redirect(url_for('dashboard_jefe'))
                else:
                    flash('El tipo de usuario no coincide con su rol asignado', 'danger')
            else:
                flash('Contraseña incorrecta', 'danger')
        else:
            flash('Usuario o CI incorrectos', 'danger')
        
        # Generar nuevo código
        session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    
    return render_template('login.html', codigo=session['codigo_verificacion'])

@app.route('/logout')
def logout():
    """Cerrar sesión"""
    session.clear()
    flash('Sesión cerrada exitosamente', 'info')
    return redirect(url_for('index'))

@app.route('/generar-codigo')
def generar_codigo():
    """Generar nuevo código de verificación"""
    session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    return {'codigo': session['codigo_verificacion']}

# ==================== RUTAS DE ADMIN ====================

@app.route('/admin/dashboard')
@auth.login_required
@auth.role_required(['admin'])
def dashboard_admin():
    """Dashboard para administradores"""
    # Obtener estadísticas
    conteo_estados = db.contar_funcionarios_por_estado()
    total_funcionarios = sum(conteo_estados.values())
    
    return render_template('dashboard_admin.html',
                         total_funcionarios=total_funcionarios,
                         pendientes=conteo_estados['pendiente'],
                         activos=conteo_estados['activo'])

@app.route('/admin/funcionarios')
@auth.login_required
@auth.role_required(['admin'])
def funcionarios_lista():
    """Lista de funcionarios"""
    funcionarios = db.get_all_funcionarios()
    return render_template('funcionarios_lista.html', funcionarios=funcionarios)

@app.route('/admin/funcionarios/nuevo', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_nuevo():
    """Registrar nuevo funcionario - COMPLETO"""
    if request.method == 'POST':
        try:
            # Obtener todos los datos del formulario
            datos = {
                # Datos personales
                'ci': request.form.get('ci'),
                'primer_apellido': request.form.get('primer_apellido'),
                'segundo_apellido': request.form.get('segundo_apellido'),
                'tercer_apellido': request.form.get('tercer_apellido'),
                'primer_nombre': request.form.get('primer_nombre'),
                'segundo_nombre': request.form.get('segundo_nombre'),
                'tercer_nombre': request.form.get('tercer_nombre'),
                'tipo_identificacion': request.form.get('tipo_identificacion'),
                
                # Datos de resolución
                'nro_resolucion': request.form.get('nro_resolucion'),
                'fecha_resolucion': request.form.get('fecha_resolucion'),
                'fecha_posesion': request.form.get('fecha_posesion'),
                'nro_memorandum_designacion': request.form.get('nro_memorandum_designacion'),
                'fecha_memorandum': request.form.get('fecha_memorandum'),
                
                # Datos de ítem
                'nro_item': request.form.get('nro_item'),
                'administracion': request.form.get('administracion'),
                'jerarquia': request.form.get('jerarquia'),
                'depende_de': request.form.get('depende_de'),
                'unidad_organizacional': request.form.get('unidad_organizacional'),
                'cargo': request.form.get('cargo'),
                'puesto': request.form.get('puesto'),
                'direccion_oficina': request.form.get('direccion_oficina'),
                'piso_interno': request.form.get('piso_interno'),
                
                # Archivos (por ahora solo nombres)
                'firma_path': '',  # Aquí irían las rutas si subimos archivos
                'foto_path': '',
                'huella_path': '',
            }
            
            # Generar usuario y datos automáticos
            primer_nombre = datos['primer_nombre'].lower()
            primer_apellido = datos['primer_apellido'].lower()
            username_base = f"{primer_nombre}.{primer_apellido}"
            
            # Verificar si el username ya existe
            usuario_existente = db.get_usuario_by_username(username_base)
            contador = 1
            username_final = username_base
            
            while usuario_existente:
                if datos.get('segundo_apellido'):
                    inicial = datos['segundo_apellido'][0].lower()
                    username_final = f"{username_base}.{inicial}"
                else:
                    username_final = f"{username_base}{contador}"
                    contador += 1
                usuario_existente = db.get_usuario_by_username(username_final)
            
            # Agregar datos generados al diccionario
            datos['usuario_aplicacion'] = username_final
            datos['clave_generada'] = datos['ci']  # Contraseña inicial = CI
            datos['correo_interno'] = f"{username_final}@gobierno.talento.bo"
            
            # Crear funcionario
            funcionario_id = db.crear_funcionario(datos)
            
            # Crear usuario para el funcionario
            password_hash = auth.hash_password(datos['ci'])
            user_id = db.crear_usuario(
                ci=datos['ci'],
                username=username_final,
                email=datos['correo_interno'],
                password_hash=password_hash,
                rol='funcionario'
            )
            
            flash(f'✅ Funcionario registrado exitosamente!', 'success')
            flash(f'📋 Usuario: {username_final}', 'info')
            flash(f'🔑 Contraseña: {datos["ci"]} (CI del funcionario)', 'info')
            flash(f'📧 Correo: {datos["correo_interno"]}', 'info')
            
            return redirect(url_for('funcionarios_lista'))
            
        except Exception as e:
            flash(f'❌ Error al registrar funcionario: {str(e)}', 'danger')
    
    return render_template('funcionario_nuevo.html')

# ==================== RUTAS DE FUNCIONARIO ====================

# ==================== RUTAS PARA GESTIÓN DE FUNCIONARIOS ====================

@app.route('/admin/funcionarios/ver/<ci>')
@auth.login_required
@auth.role_required(['admin'])
def funcionario_ver(ci):
    """Ver detalles de un funcionario"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    return render_template('funcionario_ver.html', funcionario=funcionario)

@app.route('/admin/funcionarios/editar/<ci>', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_editar(ci):
    """Editar funcionario existente"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    if request.method == 'POST':
        try:
            # Actualizar los datos (simplificado por ahora)
            conn = db.get_connection()
            cursor = conn.cursor()
            
            # Datos actualizables (excluyendo CI y campos generados)
            campos_actualizables = [
                'primer_apellido', 'segundo_apellido', 'tercer_apellido',
                'primer_nombre', 'segundo_nombre', 'tercer_nombre',
                'tipo_identificacion', 'nro_resolucion', 'fecha_resolucion',
                'fecha_posesion', 'nro_memorandum_designacion', 'fecha_memorandum',
                'nro_item', 'administracion', 'jerarquia', 'depende_de',
                'unidad_organizacional', 'cargo', 'puesto', 'direccion_oficina',
                'piso_interno', 'estado'
            ]
            
            # Construir query de actualización
            set_clause = []
            valores = []
            
            for campo in campos_actualizables:
                valor = request.form.get(campo)
                if valor is not None:
                    set_clause.append(f"{campo} = ?")
                    valores.append(valor)
            
            # Agregar fecha de actualización
            set_clause.append("fecha_actualizacion = CURRENT_TIMESTAMP")
            
            # Agregar CI al final para WHERE
            valores.append(ci)
            
            query = f"UPDATE funcionarios SET {', '.join(set_clause)} WHERE ci = ?"
            cursor.execute(query, valores)
            conn.commit()
            conn.close()
            
            flash('✅ Funcionario actualizado correctamente', 'success')
            return redirect(url_for('funcionario_ver', ci=ci))
            
        except Exception as e:
            flash(f'❌ Error al actualizar funcionario: {str(e)}', 'danger')
    
    return render_template('funcionario_editar.html', funcionario=funcionario)

@app.route('/admin/funcionarios/baja/<ci>', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_baja(ci):
    """Dar de baja a un funcionario"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
     # Obtener fecha actual
    from datetime import datetime
    hoy = datetime.now().strftime('%Y-%m-%d')
    
    if request.method == 'POST':
        try:
            motivo = request.form.get('motivo_baja')
            nro_memorandum = request.form.get('nro_memorandum_retiro')
            fecha_retiro = request.form.get('fecha_retiro')
            
            # Actualizar estado del funcionario
            conn = db.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('''
            UPDATE funcionarios 
            SET estado = 'baja', 
                fecha_actualizacion = CURRENT_TIMESTAMP
            WHERE ci = ?
            ''', (ci,))
            
            # También desactivar usuario asociado
            cursor.execute('''
            UPDATE usuarios 
            SET activo = 0 
            WHERE ci = ?
            ''', (ci,))
            
            conn.commit()
            conn.close()
            
            flash(f'✅ Funcionario {funcionario["primer_nombre"]} {funcionario["primer_apellido"]} dado de baja', 'success')
            return redirect(url_for('funcionarios_lista'))
            
        except Exception as e:
            flash(f'❌ Error al dar de baja: {str(e)}', 'danger')
    
    return render_template('funcionario_baja.html', funcionario=funcionario)

@app.route('/admin/funcionarios/activar/<ci>')
@auth.login_required
@auth.role_required(['admin'])
def funcionario_activar(ci):
    """Reactivar un funcionario dado de baja"""
    try:
        conn = db.get_connection()
        cursor = conn.cursor()
        
        cursor.execute('''
        UPDATE funcionarios 
        SET estado = 'activo', 
            fecha_actualizacion = CURRENT_TIMESTAMP
        WHERE ci = ?
        ''', (ci,))
        
        # Reactivar usuario asociado
        cursor.execute('''
        UPDATE usuarios 
        SET activo = 1 
        WHERE ci = ?
        ''', (ci,))
        
        conn.commit()
        conn.close()
        
        flash('✅ Funcionario reactivado correctamente', 'success')
        
    except Exception as e:
        flash(f'❌ Error al reactivar: {str(e)}', 'danger')
    
    return redirect(url_for('funcionarios_lista'))

# ==================== RUTAS PARA FUNCIONARIO ====================

@app.route('/funcionario/completar-ficha')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_completar_ficha():
    """Página principal para completar la ficha TALENTO"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    # Calcular progreso (simulado por ahora)
    progreso = 25
    secciones = {
        'datos_personales': False,
        'formacion': False,
        'seguro_social': False,
        'experiencia': False
    }
    
    return render_template('funcionario/completar_ficha.html', 
                         funcionario=funcionario,
                         progreso=progreso,
                         secciones=secciones)

@app.route('/funcionario/datos-personales', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_datos_personales():
    """Funcionario completa sus datos personales (Actividad 5)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('dashboard_funcionario'))
    
    # Obtener parámetros para los dropdowns
    parametros = {
        'genero': db.get_parametros('genero'),
        'departamentos': db.get_parametros('departamentos'),
        'paises': db.get_parametros('paises'),
        'estado_civil': db.get_parametros('estado_civil'),
        'tipo_sangre': db.get_parametros('tipo_sangre'),
        'gestora': db.get_parametros('gestora'),
        'parentesco': db.get_parametros('parentesco'),
        'nacionalidad': db.get_parametros('nacionalidad')
    }
    
    # Obtener datos adicionales existentes
    datos_adicionales = db.get_datos_adicionales(funcionario['id'])
    
    # Obtener parientes existentes
    parientes = db.get_parientes(funcionario['id'])
    
    # Enriquecer parientes con nombres de parámetros
    for pariente in parientes:
        # Buscar nombre del parentesco
        for parent in parametros['parentesco']:
            if parent['codigo'] == pariente['parentesco']:
                pariente['parentesco_nombre'] = parent['nombre']
                break
        
        # Buscar nombre de nacionalidad
        for nac in parametros['nacionalidad']:
            if nac['codigo'] == pariente['nacionalidad']:
                pariente['nacionalidad_nombre'] = nac['nombre']
                break
    
    if request.method == 'POST':
        try:
            # 1. Guardar datos adicionales
            datos = {
                'genero': request.form.get('genero'),
                'expedido_en': request.form.get('expedido_en'),
                'fecha_nacimiento': request.form.get('fecha_nacimiento'),
                'pais_nacimiento': request.form.get('pais_nacimiento'),
                'depto_nacimiento': request.form.get('depto_nacimiento'),
                'provincia_nacimiento': request.form.get('provincia_nacimiento'),
                'lugar_nacimiento': request.form.get('lugar_nacimiento'),
                'nro_libreta_militar': request.form.get('nro_libreta_militar'),
                'gestora': request.form.get('gestora'),
                'nro_nua': request.form.get('nro_nua'),
                'tipo_sangre': request.form.get('tipo_sangre'),
                'fecha_caducidad_ci': request.form.get('fecha_caducidad_ci'),
                'estado_civil': request.form.get('estado_civil'),
                'nro_hijos': request.form.get('nro_hijos'),
                'nro_dependientes': request.form.get('nro_dependientes'),
                'direccion_domicilio': request.form.get('direccion_domicilio'),
                'nro_domicilio': request.form.get('nro_domicilio'),
                'zona_domicilio': request.form.get('zona_domicilio'),
                'ciudad_localidad': request.form.get('ciudad_localidad'),
                'tipo_vivienda': request.form.get('tipo_vivienda'),
                'nombre_tipo_vivienda': request.form.get('nombre_tipo_vivienda'),
                'piso': request.form.get('piso'),
                'depto': request.form.get('depto'),
                'casilla': request.form.get('casilla'),
                'correo_electronico1': request.form.get('correo_electronico1'),
                'correo_electronico2': request.form.get('correo_electronico2'),
                'telefono_fijo1': request.form.get('telefono_fijo1'),
                'telefono_fijo2': request.form.get('telefono_fijo2'),
                'telefono_celular1': request.form.get('telefono_celular1'),
                'telefono_celular2': request.form.get('telefono_celular2'),
                'nro_carrera_administrativa': request.form.get('nro_carrera_administrativa'),
                'licencia_conducir': request.form.get('licencia_conducir'),
                'categoria_licencia': request.form.get('categoria_licencia'),
                'emergencia_contacto': request.form.get('emergencia_contacto'),
                'nro_declaracion_jurada': request.form.get('nro_declaracion_jurada'),
                'fecha_declaracion_jurada': request.form.get('fecha_declaracion_jurada')
            }
            
            # Validaciones especiales
            if datos['genero'] == 'M' and not datos['nro_libreta_militar']:
                flash('El número de libreta de servicio militar es obligatorio para varones', 'danger')
                return render_template('funcionario/datos_personales.html',
                                     funcionario=funcionario,
                                     parametros=parametros,
                                     datos_adicionales=datos_adicionales,
                                     parientes=parientes,
                                     hoy=datetime.now().strftime('%Y-%m-%d'),
                                     fecha_max_nacimiento=(datetime.now() - timedelta(days=365*18)).strftime('%Y-%m-%d'))
            
            # Guardar datos adicionales
            db.guardar_datos_adicionales(funcionario['id'], datos)
            
            # 2. Procesar parientes nuevos
            parientes_nuevos = []
            i = 0
            while f'parientes_nuevos[{i}][parentesco]' in request.form:
                pariente = {
                    'parentesco': request.form.get(f'parientes_nuevos[{i}][parentesco]'),
                    'primer_apellido': request.form.get(f'parientes_nuevos[{i}][primer_apellido]'),
                    'segundo_apellido': request.form.get(f'parientes_nuevos[{i}][segundo_apellido]'),
                    'nombres': request.form.get(f'parientes_nuevos[{i}][nombres]'),
                    'nacionalidad': request.form.get(f'parientes_nuevos[{i}][nacionalidad]'),
                    'telefono': request.form.get(f'parientes_nuevos[{i}][telefono]'),
                    'genero': request.form.get(f'parientes_nuevos[{i}][genero]'),
                    'fecha_nacimiento': request.form.get(f'parientes_nuevos[{i}][fecha_nacimiento]'),
                    'tipo_identificacion': request.form.get(f'parientes_nuevos[{i}][tipo_identificacion]'),
                    'numero_identificacion': request.form.get(f'parientes_nuevos[{i}][numero_identificacion]')
                }
                parientes_nuevos.append(pariente)
                i += 1
            
            # Guardar parientes nuevos
            for pariente in parientes_nuevos:
                db.guardar_pariente(funcionario['id'], pariente)
            
            # 3. Procesar parientes a eliminar
            parientes_eliminar = request.form.getlist('parientes_eliminar[]')
            for pariente_id in parientes_eliminar:
                db.eliminar_pariente(pariente_id)
            
            flash('✅ Datos personales guardados correctamente', 'success')
            
            # Actualizar estado del funcionario si es la primera vez
            conn = db.get_connection()
            cursor = conn.cursor()
            cursor.execute("UPDATE funcionarios SET estado = 'en_proceso' WHERE id = ?", (funcionario['id'],))
            conn.commit()
            conn.close()
            
            return redirect(url_for('funcionario_completar_ficha'))
            
        except Exception as e:
            flash(f'❌ Error al guardar datos: {str(e)}', 'danger')
    
    # Para GET, calcular fechas límite
    hoy = datetime.now().strftime('%Y-%m-%d')
    fecha_max_nacimiento = (datetime.now() - timedelta(days=365*18)).strftime('%Y-%m-%d')
    
    return render_template('funcionario/datos_personales.html',
                         funcionario=funcionario,
                         parametros=parametros,
                         datos_adicionales=datos_adicionales,
                         parientes=parientes,
                         hoy=hoy,
                         fecha_max_nacimiento=fecha_max_nacimiento)

@app.route('/funcionario/formacion-academica', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_formacion_academica():
    """Funcionario completa formación académica (Actividad 6)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Formación académica guardada correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/formacion_academica.html', funcionario=funcionario)

@app.route('/funcionario/seguro-social', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_seguro_social():
    """Funcionario completa seguro social (Actividad 7)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Seguro social guardado correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/seguro_social.html', funcionario=funcionario)

@app.route('/funcionario/experiencia-laboral', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_experiencia_laboral():
    """Funcionario completa experiencia laboral (Actividad 8)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Experiencia laboral guardada correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/experiencia_laboral.html', funcionario=funcionario)

@app.route('/funcionario/documentos')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_documentos():
    """Funcionario sube documentos de soporte"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/documentos.html', funcionario=funcionario)

@app.route('/funcionario/revisar-formulario')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_revisar_formulario():
    """Funcionario revisa formulario completo (Actividad 9)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/revisar_formulario.html', funcionario=funcionario)

@app.route('/funcionario/imprimir-formulario')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_imprimir_formulario():
    """Funcionario imprime formulario (Actividad 10)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/imprimir_formulario.html', funcionario=funcionario)

@app.route('/funcionario/ver-tramite')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_tramite():
    """Funcionario ve número de trámite (Actividad 11)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    # Generar número de trámite ficticio
    import random
    nro_tramite = f"TAL-{random.randint(1000, 9999)}-2025"
    
    return render_template('funcionario/ver_tramite.html', 
                         funcionario=funcionario,
                         nro_tramite=nro_tramite)

# Actualizar el dashboard del funcionario para pasar datos de progreso
@app.route('/funcionario/dashboard')
@auth.login_required
@auth.role_required(['funcionario'])
def dashboard_funcionario():
    """Dashboard para funcionarios"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('logout'))
    
    # Calcular progreso real
    progreso, secciones = db.calcular_progreso_funcionario(funcionario['id'])
    
    return render_template('dashboard_funcionario.html', 
                         funcionario=funcionario,
                         progreso=progreso,
                         secciones=secciones)

# ==================== RUTAS DE JEFE ====================

@app.route('/jefe/dashboard')
@auth.login_required
@auth.role_required(['jefe'])
def dashboard_jefe():
    """Dashboard para jefes de departamento"""
    return render_template('dashboard_jefe.html')

# ==================== EJECUCIÓN ====================

if __name__ == '__main__':
    print("🚀 Iniciando Sistema Talento Humano...")
    print("🌐 Accede en: http://localhost:5000")
    print("👤 Usuario admin: admin / admin123")
    app.run(debug=True, port=5000)

talento_humano/auth.py:
import hashlib
import secrets
from datetime import datetime
from functools import wraps
from flask import session, redirect, url_for, flash

class Auth:
    def __init__(self, db):
        self.db = db
    
    def hash_password(self, password):
        """Hash simple de contraseña (para desarrollo)"""
        salt = "talento_humano_2025"
        return hashlib.sha256((password + salt).encode()).hexdigest()
    
    def verify_password(self, password, password_hash):
        """Verificar contraseña"""
        return self.hash_password(password) == password_hash
    
    def login_required(self, f):
        """Decorador para requerir login"""
        @wraps(f)
        def decorated_function(*args, **kwargs):
            if 'user_id' not in session:
                flash('Por favor inicie sesión para acceder a esta página.', 'warning')
                return redirect(url_for('login'))
            return f(*args, **kwargs)
        return decorated_function
    
    def role_required(self, roles):
        """Decorador para requerir rol específico"""
        def decorator(f):
            @wraps(f)
            def decorated_function(*args, **kwargs):
                if 'user_id' not in session:
                    flash('Por favor inicie sesión.', 'warning')
                    return redirect(url_for('login'))
                
                if session.get('rol') not in roles:
                    flash('No tiene permisos para acceder a esta página.', 'danger')
                    return redirect(url_for('dashboard'))
                
                return f(*args, **kwargs)
            return decorated_function
        return decorator
    
    def generar_codigo_verificacion(self):
        """Generar código de verificación de 4 dígitos"""
        return ''.join(secrets.choice('0123456789') for _ in range(4))

talento_humano/database.py:
import sqlite3
import os
import hashlib  # <-- AÑADE ESTO
from datetime import datetime

class Database:
    def __init__(self, db_path='instance/talento.db'):
        self.db_path = db_path
        self.init_db()
    
    def get_connection(self):
        """Obtener conexión a la base de datos"""
        conn = sqlite3.connect(self.db_path)
        conn.row_factory = sqlite3.Row  # Para acceso por nombre de columna
        return conn
    
    def hash_password(self, password):
        """Función para hashear contraseñas"""
        salt = "talento_humano_2025"
        return hashlib.sha256((password + salt).encode()).hexdigest()
    
    def init_db(self):
        """Inicializar base de datos con tablas necesarias"""
        # Crear directorio instance si no existe
        os.makedirs('instance', exist_ok=True)
        
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Tabla de usuarios
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS usuarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            username TEXT UNIQUE NOT NULL,
            email TEXT UNIQUE NOT NULL,
            password_hash TEXT NOT NULL,
            rol TEXT NOT NULL DEFAULT 'funcionario',
            activo INTEGER DEFAULT 1,
            fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            ultimo_acceso TIMESTAMP
        )
        ''')
        
        # Tabla de funcionarios (según documento R-100)
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS funcionarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            primer_apellido TEXT NOT NULL,
            segundo_apellido TEXT,
            tercer_apellido TEXT,
            primer_nombre TEXT NOT NULL,
            segundo_nombre TEXT,
            tercer_nombre TEXT,
            tipo_identificacion TEXT DEFAULT 'CI',
            
            -- Campos básicos del sistema
            estado TEXT DEFAULT 'pendiente',
            fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            fecha_actualizacion TIMESTAMP,
            
            -- === NUEVOS CAMPOS SEGÚN DOCUMENTO R-100 ===
            -- Datos de resolución
            nro_resolucion TEXT,
            fecha_resolucion DATE,
            fecha_posesion DATE,
            nro_memorandum_designacion TEXT,
            fecha_memorandum DATE,
            
            -- Datos de ítem
            nro_item TEXT,
            administracion TEXT,
            jerarquia TEXT,
            depende_de TEXT,
            unidad_organizacional TEXT,
            cargo TEXT,
            puesto TEXT,
            direccion_oficina TEXT,
            piso_interno TEXT,
            
            -- Archivos (rutas)
            firma_path TEXT,
            foto_path TEXT,
            huella_path TEXT,
            
            -- Datos generados
            usuario_aplicacion TEXT,
            clave_generada TEXT,
            correo_interno TEXT
        )
        ''')
        
        # Tabla para documentos de respaldo
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS documentos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            funcionario_id INTEGER NOT NULL,
            tipo_documento TEXT NOT NULL,
            nombre_archivo TEXT NOT NULL,
            ruta_archivo TEXT NOT NULL,
            fecha_subida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
        )
        ''')
        
        cursor.execute('''
    CREATE TABLE IF NOT EXISTS datos_adicionales (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    genero TEXT,
    expedido_en TEXT,
    fecha_nacimiento DATE,
    pais_nacimiento TEXT,
    depto_nacimiento TEXT,
    provincia_nacimiento TEXT,
    lugar_nacimiento TEXT,
    nro_libreta_militar TEXT,
    afp TEXT,
    nro_nua TEXT,
    tipo_sangre TEXT,
    fecha_caducidad_ci DATE,
    estado_civil TEXT,
    nro_hijos INTEGER DEFAULT 0,
    nro_dependientes INTEGER DEFAULT 0,
    direccion_domicilio TEXT,
    nro_domicilio TEXT,
    zona_domicilio TEXT,
    ciudad_localidad TEXT,
    tipo_vivienda TEXT,
    nombre_tipo_vivienda TEXT,
    piso TEXT,
    depto TEXT,
    casilla TEXT,
    correo_electronico1 TEXT,
    correo_electronico2 TEXT,
    telefono_fijo1 TEXT,
    telefono_fijo2 TEXT,
    telefono_celular1 TEXT,
    telefono_celular2 TEXT,
    nro_carrera_administrativa TEXT,
    fecha_cas DATE,
    anos_cas INTEGER,
    meses_cas INTEGER,
    dias_cas INTEGER,
    licencia_conducir TEXT,
    categoria_licencia TEXT,
    emergencia_contacto TEXT,
    nro_declaracion_jurada TEXT,
    fecha_declaracion_jurada DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para parientes
        cursor.execute('''
CREATE TABLE IF NOT EXISTS parientes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    parentesco TEXT,
    primer_apellido TEXT,
    segundo_apellido TEXT,
    nombres TEXT,
    nacionalidad TEXT,
    telefono TEXT,
    genero TEXT,
    fecha_nacimiento DATE,
    tipo_identificacion TEXT,
    numero_identificacion TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para formación académica
        cursor.execute('''
CREATE TABLE IF NOT EXISTS formacion_academica (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    pais_estudio TEXT,
    estado_instruccion TEXT,
    nivel_instruccion TEXT,
    area TEXT,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nombre_institucion TEXT,
    carrera TEXT,
    titulado TEXT,
    documento_respaldo TEXT,
    detalle_documento TEXT,
    fecha_inicio DATE,
    fecha_final DATE,
    nro_titulo_academico TEXT,
    fecha_emision_titulo DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para bachillerato
        cursor.execute('''
CREATE TABLE IF NOT EXISTS bachillerato (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    es_bachiller TEXT,
    ano INTEGER,
    unidad_educativa TEXT,
    ultimo_curso_vencido TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para cursos
        cursor.execute('''
CREATE TABLE IF NOT EXISTS cursos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    nivel_instruccion TEXT,
    area TEXT,
    nombre_curso TEXT,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nro_horas INTEGER,
    fecha_inicio DATE,
    fecha_final DATE,
    documento_respaldo TEXT,
    detalle_documento TEXT,
    pais_estudio TEXT,
    depto_estudio TEXT,
    capacitacion TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para idiomas
        cursor.execute('''
CREATE TABLE IF NOT EXISTS idiomas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    idioma TEXT,
    habla TEXT,
    escribe TEXT,
    lee TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para experiencia laboral
        cursor.execute('''
CREATE TABLE IF NOT EXISTS experiencia_laboral (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    entidad_empresa TEXT,
    area_departamento TEXT,
    tipo_entidad TEXT,
    puesto TEXT,
    jerarquia TEXT,
    cargo_mando TEXT,
    nro_dependientes INTEGER,
    fecha_inicio DATE,
    fecha_final DATE,
    forma_ingreso TEXT,
    causa_retiro TEXT,
    nit_empresa TEXT,
    haber_basico REAL,
    pais TEXT,
    descripcion_labores TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para capacitaciones impartidas
        cursor.execute('''
CREATE TABLE IF NOT EXISTS capacitaciones_impartidas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nombre_institucion TEXT,
    tipo_capacitacion TEXT,
    carrera TEXT,
    asignatura_tema TEXT,
    nro_horas INTEGER,
    fecha_desde DATE,
    fecha_hasta DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

        print("✅ Tablas de datos de funcionario creadas")
        
        # Insertar usuario admin por defecto
        cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
        if not cursor.fetchone():
            # Calcular hash de la contraseña
            password_hash = self.hash_password("admin123")
            
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
            VALUES (?, ?, ?, ?, ?, ?)
            ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
                  password_hash, 'admin', 1))
            print(f"✅ Usuario admin creado con hash: {password_hash[:20]}...")
        
        # Tablas de parámetros (catálogos)
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_genero (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_departamentos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_paises (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_estado_civil (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_tipo_sangre (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_gestora (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_parentesco (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        cursor.execute('''
        CREATE TABLE IF NOT EXISTS parametros_nacionalidad (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            codigo TEXT UNIQUE NOT NULL,
            nombre TEXT NOT NULL,
            activo INTEGER DEFAULT 1
        )
        ''')

        # Insertar datos básicos en parámetros
        parametros_basicos = {
            'genero': [
                ('M', 'MASCULINO'),
                ('F', 'FEMENINO')
            ],
            'departamentos': [
                ('LP', 'LA PAZ'),
                ('CB', 'COCHABAMBA'),
                ('SC', 'SANTA CRUZ'),
                ('OR', 'ORURO'),
                ('PT', 'POTOSÍ'),
                ('TJ', 'TARIJA'),
                ('CH', 'CHUQUISACA'),
                ('BN', 'BENI'),
                ('PD', 'PANDO')
            ],
            'paises': [
                ('BOL', 'BOLIVIA'),
                ('ARG', 'ARGENTINA'),
                ('BRA', 'BRASIL'),
                ('CHL', 'CHILE'),
                ('PER', 'PERÚ')
            ],
            'estado_civil': [
                ('S', 'SOLTERO(A)'),
                ('C', 'CASADO(A)'),
                ('D', 'DIVORCIADO(A)'),
                ('V', 'VIUDO(A)'),
                ('U', 'UNIÓN LIBRE')
            ],
            'tipo_sangre': [
                ('A+', 'A+'),
                ('A-', 'A-'),
                ('B+', 'B+'),
                ('B-', 'B-'),
                ('AB+', 'AB+'),
                ('AB-', 'AB-'),
                ('O+', 'O+'),
                ('O-', 'O-')
            ],
            'gestora': [
                ('CSS', 'CAJA DE SALUD DE SEGUROS SOCIALES'),
                ('CPS', 'CAJA PETROLERA DE SALUD'),
                ('CNS', 'CAJA NACIONAL DE SALUD'),
                ('CSM', 'CAJA DE SALUD DE LA MUJER'),
                ('CSR', 'CAJA DE SALUD RURAL')
            ],
            'parentesco': [
                ('PAD', 'PADRE'),
                ('MAD', 'MADRE'),
                ('CON', 'CÓNYUGUE'),
                ('HIJ', 'HIJO(A)'),
                ('HER', 'HERMANO(A)'),
                ('OTR', 'OTRO')
            ],
            'nacionalidad': [
                ('BOL', 'BOLIVIANA'),
                ('ARG', 'ARGENTINA'),
                ('BRA', 'BRASILEÑA'),
                ('CHL', 'CHILENA'),
                ('PER', 'PERUANA'),
                ('OTR', 'OTRA')
            ]
        }

        for tabla, datos in parametros_basicos.items():
            cursor.execute(f"SELECT COUNT(*) FROM parametros_{tabla}")
            if cursor.fetchone()[0] == 0:
                for codigo, nombre in datos:
                    cursor.execute(f"INSERT INTO parametros_{tabla} (codigo, nombre) VALUES (?, ?)", (codigo, nombre))
                print(f"✅ Datos insertados en: parametros_{tabla}")

        conn.commit()
        conn.close()
        print("✅ Tablas de parámetros creadas e inicializadas")
    
    def get_parametros(self, tipo):
        """Obtener lista de parámetros por tipo"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        tablas_validas = ['genero', 'departamentos', 'paises', 'estado_civil', 
                        'tipo_sangre', 'gestora', 'parentesco', 'nacionalidad']
        
        if tipo not in tablas_validas:
            conn.close()
            return []
        
        cursor.execute(f"SELECT codigo, nombre FROM parametros_{tipo} WHERE activo = 1 ORDER BY nombre")
        resultados = cursor.fetchall()
        conn.close()
        
        return [dict(row) for row in resultados]

    def get_datos_adicionales(self, funcionario_id):
        """Obtener datos adicionales del funcionario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
        datos = cursor.fetchone()
        conn.close()
        return datos

    def get_parientes(self, funcionario_id):
        """Obtener parientes del funcionario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM parientes WHERE funcionario_id = ? ORDER BY parentesco", (funcionario_id,))
        parientes = cursor.fetchall()
        conn.close()
        return [dict(p) for p in parientes]

    def guardar_datos_adicionales(self, funcionario_id, datos):
        """Guardar o actualizar datos adicionales"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Verificar si ya existen datos
        cursor.execute("SELECT id FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
        existe = cursor.fetchone()
        
        if existe:
            # Actualizar
            campos = []
            valores = []
            for campo, valor in datos.items():
                if valor is not None:
                    campos.append(f"{campo} = ?")
                    valores.append(valor)
            
            valores.append(funcionario_id)
            query = f"UPDATE datos_adicionales SET {', '.join(campos)} WHERE funcionario_id = ?"
            cursor.execute(query, valores)
        else:
            # Insertar
            campos = ['funcionario_id'] + list(datos.keys())
            placeholders = ['?'] * len(campos)
            valores = [funcionario_id] + list(datos.values())
            
            query = f"INSERT INTO datos_adicionales ({', '.join(campos)}) VALUES ({', '.join(placeholders)})"
            cursor.execute(query, valores)
        
        conn.commit()
        conn.close()
        return True

    def guardar_pariente(self, funcionario_id, datos_pariente):
        """Guardar un pariente"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        campos = ['funcionario_id'] + list(datos_pariente.keys())
        placeholders = ['?'] * len(campos)
        valores = [funcionario_id] + list(datos_pariente.values())
        
        query = f"INSERT INTO parientes ({', '.join(campos)}) VALUES ({', '.join(placeholders)})"
        cursor.execute(query, valores)
        
        pariente_id = cursor.lastrowid
        conn.commit()
        conn.close()
        return pariente_id

    def eliminar_pariente(self, pariente_id):
        """Eliminar un pariente"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("DELETE FROM parientes WHERE id = ?", (pariente_id,))
        conn.commit()
        conn.close()
        return True    
          
    # Métodos CRUD para usuarios
    def get_usuario_by_username(self, username):
        """Obtener usuario por nombre de usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE username = ? AND activo = 1", (username,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def get_usuario_by_ci(self, ci):
        """Obtener usuario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE ci = ? AND activo = 1", (ci,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def crear_usuario(self, ci, username, email, password_hash, rol='funcionario'):
        """Crear nuevo usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        try:
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol)
            VALUES (?, ?, ?, ?, ?)
            ''', (ci, username, email, password_hash, rol))
            conn.commit()
            user_id = cursor.lastrowid
            conn.close()
            return user_id
        except sqlite3.IntegrityError as e:
            conn.close()
            raise Exception(f"Error al crear usuario: {str(e)}")
    
    # Métodos CRUD para funcionarios
    def crear_funcionario(self, datos):
        """Crear nuevo funcionario según formulario R-100"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Lista completa de campos según el documento
        campos = [
            # Datos personales
            'ci', 'primer_apellido', 'segundo_apellido', 'tercer_apellido',
            'primer_nombre', 'segundo_nombre', 'tercer_nombre', 'tipo_identificacion',
            
            # Datos de resolución
            'nro_resolucion', 'fecha_resolucion', 'fecha_posesion',
            'nro_memorandum_designacion', 'fecha_memorandum',
            
            # Datos de ítem
            'nro_item', 'administracion', 'jerarquia', 'depende_de',
            'unidad_organizacional', 'cargo', 'puesto',
            'direccion_oficina', 'piso_interno',
            
            # Archivos (solo rutas por ahora)
            'firma_path', 'foto_path', 'huella_path',
            
            # Datos generados
            'usuario_aplicacion', 'clave_generada', 'correo_interno'
        ]
        
        # Asegurar que todos los campos existan en el diccionario datos
        valores = [datos.get(campo) for campo in campos]
        
        cursor.execute(f'''
        INSERT INTO funcionarios ({', '.join(campos)})
        VALUES ({', '.join(['?'] * len(campos))})
        ''', valores)
        
        funcionario_id = cursor.lastrowid
        conn.commit()
        conn.close()
        return funcionario_id
    
    def get_funcionario_by_ci(self, ci):
        """Obtener funcionario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios WHERE ci = ?", (ci,))
        funcionario = cursor.fetchone()
        conn.close()
        return funcionario
    
    def get_all_funcionarios(self):
        """Obtener todos los funcionarios"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios ORDER BY fecha_registro DESC")
        funcionarios = cursor.fetchall()
        conn.close()
        return funcionarios
    
    def contar_funcionarios_por_estado(self):
        """Contar funcionarios por estado"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        cursor.execute("SELECT estado, COUNT(*) as cantidad FROM funcionarios GROUP BY estado")
        resultados = cursor.fetchall()
        
        # Crear diccionario con todos los estados
        conteo = {
            'pendiente': 0,
            'activo': 0,
            'inactivo': 0,
            'baja': 0
        }
        
        for row in resultados:
            estado = row['estado']
            if estado in conteo:
                conteo[estado] = row['cantidad']
        
        conn.close()
        return conteo
    
    # Agrega este método en database.py para calcular progreso
    def calcular_progreso_funcionario(self, funcionario_id):
        """Calcular progreso de completado de ficha TALENTO"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Verificar qué tablas tienen datos
        secciones = {
            'datos_personales': False,
            'formacion': False,
            'seguro_social': False,
            'experiencia': False
        }
        
        # Verificar datos personales
        cursor.execute("SELECT COUNT(*) FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
        if cursor.fetchone()[0] > 0:
            secciones['datos_personales'] = True
        
        # Verificar formación académica
        cursor.execute("SELECT COUNT(*) FROM formacion_academica WHERE funcionario_id = ?", (funcionario_id,))
        if cursor.fetchone()[0] > 0:
            secciones['formacion'] = True
        
        # Verificar seguro social
        # Nota: Necesitaríamos una tabla específica o campo en funcionarios
        
        # Verificar experiencia laboral
        cursor.execute("SELECT COUNT(*) FROM experiencia_laboral WHERE funcionario_id = ?", (funcionario_id,))
        if cursor.fetchone()[0] > 0:
            secciones['experiencia'] = True
        
        conn.close()
        
        # Calcular porcentaje
        completadas = sum(1 for sec in secciones.values() if sec)
        total = len(secciones)
        progreso = int((completadas / total) * 100) if total > 0 else 0
        
        return progreso, secciones
    
    def actualizar_ultimo_acceso(self, user_id):
        """Actualizar último acceso del usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("UPDATE usuarios SET ultimo_acceso = CURRENT_TIMESTAMP WHERE id = ?", (user_id,))
        conn.commit()
        conn.close()


talento_humano/requirements.txt:
Flask==2.3.3
python-dotenv==1.0.0

talento_humano/reset_admin.py:
#!/usr/bin/env python3
import sqlite3
import hashlib

def reset_admin_password():
    """Resetear contraseña del admin a 'admin123'"""
    
    # Conectar a la base de datos
    conn = sqlite3.connect('instance/talento.db')
    cursor = conn.cursor()
    
    # Calcular hash
    salt = "talento_humano_2025"
    password = "admin123"
    password_hash = hashlib.sha256((password + salt).encode()).hexdigest()
    
    # Actualizar contraseña
    cursor.execute('''
    UPDATE usuarios 
    SET password_hash = ?
    WHERE username = 'admin'
    ''', (password_hash,))
    
    if cursor.rowcount > 0:
        print(f"✅ Contraseña de admin actualizada a: {password}")
        print(f"🔑 Hash generado: {password_hash}")
    else:
        print("❌ No se encontró usuario admin")
        # Crearlo si no existe
        cursor.execute('''
        INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
        VALUES (?, ?, ?, ?, ?, ?)
        ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
              password_hash, 'admin', 1))
        print("✅ Usuario admin creado")
    
    conn.commit()
    conn.close()

if __name__ == '__main__':
    reset_admin_password()

---------------------------------------aqui vendra los prompts que charlamos para que veas como estabamos trabajando--------------------------------------------------------------
tengo que realizar un sistema con python usando flask con base de datos con SQLite y quisiera que me analizes estos documentos de como crees que seria el sistema, aun no programes nada solo dime como crees que funcionaria segun los documentos para asi revisarlo y decirte si estamos en lo correcto o no ok?, te envio estos PDF que explican como es mas o menos el sistema:
Voy a analizar ambos documentos para entender cómo sería el sistema de "Talento Humano" en Flask con SQLite. Aquí está mi análisis estructurado:

📋 VISIÓN GENERAL DEL SISTEMA
Según los documentos, se trata de un Sistema de Gestión de Recursos Humanos llamado "TALENTO" para la entidad FICTICIA, que busca:

Digitalizar procesos de RRHH

Gestionar alrededor de 23,000-50,000 funcionarios

Migrar datos desde un sistema antiguo en ACCESS

Integrarse con otros sistemas (biométrico, ERP, Directorio Activo)

🏗️ ARQUITECTURA PROPUESTA (Flask + SQLite)
1. Estructura de la Aplicación Flask:
text
talento_humano/
├── app.py                    # Punto de entrada principal
├── config.py                # Configuraciones
├── requirements.txt         # Dependencias
├── instance/
│   └── talento.db          # Base de datos SQLite
├── models.py               # Modelos SQLAlchemy
├── forms.py                # Formularios WTForms
├── templates/              # Templates HTML
│   ├── layout.html
│   ├── auth/
│   │   ├── login.html
│   ├── funcionarios/
│   │   ├── registrar.html
│   │   ├── ficha.html
│   ├── admin/
│   │   ├── dashboard.html
│   │   ├── revision.html
├── static/
│   ├── css/
│   ├── js/
│   └── uploads/            # Documentos escaneados
└── routes/
    ├── auth_routes.py
    ├── funcionario_routes.py
    ├── admin_routes.py
    ├── api_routes.py
2. Modelo de Datos Principal (SQLite):
Tablas principales según el documento R-100:

TAHU_PERSONAS - Datos personales

TAHU_FUNCIONARIOS - Info laboral/resoluciones

TAHU_ITEMS - Items/puestos

TAHU_DATOS_ADICIONALES - Datos complementarios

TAHU_PARENTESCO_PERSONA - Familiares

TAHU_BACHILLERATO_PERSONA - Educación

TAHU_SSOCIAL_PERSONA - Seguro social

TAHU_EXPERIENCIAS_TRAB_PERSONA - Experiencia laboral

TAHU_DOCENCIA_CPCTCN_PERSONA - Capacitaciones

TAHU_DOCTOS_RESPALDO_PERSONA - Documentos

3. Roles y Permisos:
Administrador - Acceso total, puede crear funcionarios, revisar todo

Funcionario - Solo su información, completar ficha TALENTO

Jefe de Departamento - Revisar y aprobar formularios de su área

4. Flujo de Trabajo Principal:
A. Alta de Funcionario:

text
1. Admin registra datos básicos → genera usuario/clave
2. Sistema crea "Caso" para funcionario
3. Funcionario completa ficha (5 días hábiles):
   - Datos personales/adicionales/parientes
   - Formación académica/cursos/idiomas
   - Seguro social
   - Experiencia laboral
4. Funcionario revisa y aprueba formulario
5. Admin revisa y verifica documentos
6. Jefe revisa y da aprobación final
B. Procesos Adicionales:

Baja de funcionarios

Consulta de datos migrados

Reportes automáticos

Gestión de documentos

5. Características Técnicas Clave:
Autenticación:

Login con usuario/contraseña + código de verificación

Integración con Oficina Virtual

Sesiones Flask con Flask-Login

Validaciones:

Campos obligatorios/opcionales según perfil

Validaciones de formato (fechas, números, textos)

Dependencias condicionales (ej: si es casado → cert. matrimonio)

Documentos:

Carga de archivos (firma, foto, huella, escaneos)

Almacenamiento en sistema de archivos o BLOB en SQLite

Lista dinámica de documentos requeridos según perfil

6. Desafíos Técnicos con SQLite:
Ventajas:

Simple de configurar

Bueno para desarrollo/prototipo

No requiere servidor de BD separado

Limitaciones a considerar:

Concurrencia: SQLite no maneja bien muchos usuarios concurrentes (50,000 usuarios según doc)

Escalabilidad: Para producción real necesitarías PostgreSQL/MySQL

BLOBs grandes: Documentos escaneados pueden ser pesados

Migración ACCESS → SQLite: Necesitarás scripts de conversión

7. Módulos Flask Sugeridos:
python
# requirements.txt
Flask==2.3.3
Flask-SQLAlchemy==3.0.5
Flask-Login==0.6.2
Flask-WTF==1.1.1
WTForms==3.0.1
email-validator==2.0.0
python-dotenv==1.0.0
reportlab==4.0.4  # Para PDFs
openpyxl==3.1.2   # Para Excel
8. Consideraciones de Seguridad:
Hash de contraseñas con bcrypt

Protección CSRF en formularios

Validación de entrada de datos

Control de acceso por roles

Cifrado de datos sensibles

9. Para la Migración ACCESS:
Exportar ACCESS a CSV

Script Python para transformar datos

Validar integridad referencial

Pantalla web para ver datos migrados

🔍 PUNTOS CRÍTICOS A DISCUTIR:
¿SQLite es suficiente? Para 50,000 usuarios necesitarías algo más robusto en producción.

¿Cómo manejar los 2000 puntos de red/500 AP? Esto es infraestructura, no software.

¿Integración con sistemas externos? VPN, biométrico, ERP necesitarían APIs.

¿Almacenamiento de 6TB? SQLite no es ideal para esto, necesitarías sistema de archivos.

¿Trabajo remoto/VPN? La app Flask correría en servidores accesibles via VPN.

💡 MI RECOMENDACIÓN:
Para desarrollo/prototipo/testing: Flask + SQLite está bien.

Para producción real:

Flask + PostgreSQL/MySQL

Servidor de aplicaciones (Gunicorn/uWSGI)

Nginx como proxy inverso

Sistema de archivos para documentos

Redis para sesiones/caché

¿Qué te parece esta aproximación? ¿Hay algún aspecto específico del documento que quieras que analice más a fondo o algún módulo que sea prioridad para implementar primero?

This response is AI-generated, for reference only.
ok esta bien pero aun quiero mas informacion si entendiste o no el sistema, este sistema sera semiprofesional porque solo sera un prototipo de como puede ser una version rapida por esp quiero trabajar con SQLite, tambien ahora quiero que me des de cada "CARACTERÍSTICAS Y FUNCIONALIDAD" del PDF como podemos diseñar el sistema, por ejemplo quiero que me digas algo como: primera vista sera de "Login" donde mandaremos datos de CI, usuario y contraseña e iniciara sesion segun el rol que se designo ese usuario(funcionario, administrador, jefe) con un codigo de verificacion que tendra que coincidir para el iniciar sesion. una vez iniciada sesion se ira a una vista llamada"modulo de organizacion" que sera donde muestre la lista de informacion (segun el rol que inicio sesion)de los registros del funcionaridonde tendra un boton que sera para añadir un nuevo registro, y mas abajo botones de esto... y aquello..etc
algo asi quiero que me expliques sobre el sistema a lo que entendiste para ver si podemos empezar a programar el sistema o darte mas informacion si no entendiste bien ok?
¡Perfecto! Voy a describirte exactamente cómo visualizo el sistema basándome en cada sección de "CARACTERÍSTICAS Y FUNCIONALIDAD" del PDF R-100, paso a paso, como si estuviera diseñando las pantallas:

🎯 SISTEMA TALENTO HUMANO - FLUJO COMPLETO SEGÚN DOCUMENTOS
1. INICIO DE SESIÓN (Página 5 - NRO. 1)
Vista: login.html

Elementos:

text
[LOGO FICTICIA] SISTEMA TALENTO HUMANO

INICIO DE SESIÓN:
[Tipo de Usuario: ▼ ComboBox (Funcionario/Admin/Jefe)]
[Carnet de Identidad (CI): ______________]
[Usuario: ______________]
[Contraseña: ______________]
[Código de Verificación: **4782**]
[Ingrese Código: ______________]

[BOTÓN: INICIAR SESIÓN] [BOTÓN: ¿OLVIDÓ CONTRASEÑA?]
Flujo:

Sistema muestra código aleatorio (ej: 4782)

Usuario debe copiarlo en campo correspondiente

Si coincide → redirige según rol

Si no coincide → mensaje error "Código incorrecto"

2. DASHBOARD PRINCIPAL (Según Rol)
A) PARA ADMINISTRADOR:
Vista: admin_dashboard.html

text
MENÚ PRINCIPAL - ADMINISTRADOR
----------------------------------------
[1. REGISTRAR NUEVO FUNCIONARIO]
[2. GESTIÓN DE FUNCIONARIOS]
[3. REVISIÓN DE FORMULARIOS PENDIENTES (5)]
[4. DOCUMENTOS POR VALIDAR (12)]
[5. MIGRACIÓN DE DATOS]
[6. REPORTES]
[7. GESTIÓN DE ROLES]
[8. BAJA DE FUNCIONARIOS]

LISTA DE ÚLTIMOS REGISTROS:
┌─────────────────────────────────────────┐
│ CI         │ NOMBRE COMPLETO     │ ESTADO │
├─────────────────────────────────────────┤
│ 1234567    │ Juan Pérez          │ Pendiente │
│ 7654321    │ María Gómez         │ Aprobado │
│ 8912345    │ Carlos López        │ Devuelto │
└─────────────────────────────────────────┘
[BOTÓN: Ver Todos] [BOTÓN: Exportar Excel]
B) PARA FUNCIONARIO:
Vista: funcionario_dashboard.html

text
BIENVENIDO, JUAN PÉREZ
----------------------------------------
MI FICHA TALENTO - ESTADO: [PENDIENTE] ⏳

⚠️ **URGENTE:** Tiene 3 días para completar su ficha

ACCIONES DISPONIBLES:
[1. COMPLETAR FICHA TALENTO] (PRINCIPAL)
[2. VER MI INFORMACIÓN]
[3. SUBIR DOCUMENTOS]
[4. VER TRÁMITES PENDIENTES]

RECORDATORIO:
• Complete todos los campos marcados como obligatorios
• Suba documentos escaneados en PDF/JPG
• Tiene plazo: 5 días hábiles
C) PARA JEFE DE DEPARTAMENTO:
Vista: jefe_dashboard.html

text
JEFE DE DEPARTAMENTO - RECURSOS HUMANOS
----------------------------------------
FORMULARIOS PENDIENTES DE APROBACIÓN (3):
┌─────────────────────────────────────────┐
│ Funcionario      │ Fecha Envío │ Acciones │
├─────────────────────────────────────────┤
│ Ana Martínez     │ 28/11/2025  │ [Revisar] │
│ Luis Fernández   │ 27/11/2025  │ [Revisar] │
│ Carla Rodríguez  │ 26/11/2025  │ [Revisar] │
└─────────────────────────────────────────┘

DOCUMENTOS POR VALIDAR (7):
[Ver Detalle]
3. REGISTRAR INFORMACIÓN BÁSICA (Páginas 6-9 - NRO. 3)
Solo para ADMINISTRADOR

Vista: admin_registrar_basico.html

text
REGISTRAR NUEVO FUNCIONARIO - DATOS BÁSICOS
════════════════════════════════════════════

[Pestañas: 1. DATOS PERSONALES | 2. RESOLUCIÓN | 3. ASIGNAR ÍTEM | 4. ARCHIVOS]

--- SECCIÓN 1: DATOS PERSONALES ---
Número Identificación: [______________] (15 chars)*
Primer Apellido:       [______________] (30 chars)*
Segundo Apellido:      [______________] (opcional)
Tercer Apellido:       [______________] (opcional)
Primer Nombre:         [______________] (30 chars)*
Segundo Nombre:        [______________] (opcional)
Tercer Nombre:         [______________] (opcional)
Tipo Identificación:   [▼ CI / PASAPORTE / OTRO]

--- SECCIÓN 2: DATOS RESOLUCIÓN ---
Número Resolución:     [______________] (20 chars)*
Fecha Resolución:      [📅 ______________]*
Fecha Posesión:        [📅 ______________]*
N° Memorándum:         [______________] (opcional)
Fecha Memorándum:      [📅 ______________] (opcional)

--- SECCIÓN 3: ASIGNAR ÍTEM ---
Número Ítem:           [▼ Seleccionar ítem ACÉFALO]
(Al seleccionar, muestra automáticamente:)
Administración:        [SISTEMA CENTRAL] (auto)
Jerarquía:             [JEFE DE DEPARTAMENTO] (auto)
Unidad Organizacional: [RRHH] (auto)
Cargo:                 [ANALISTA] (auto)
Puesto:                [P-045] (auto)

--- SECCIÓN 4: CARGAR ARCHIVOS ---
Firma:    [📎 Examinar...] [BOTÓN: Cargar]
Foto:     [📎 Examinar...] [BOTÓN: Cargar]
Huella:   [📎 Examinar...] [BOTÓN: Cargar]

[BOTÓN: GENERAR USUARIO Y GUARDAR] [BOTÓN: CANCELAR]
Al guardar:

Sistema genera usuario: primernombre.primerapellido (ej: juan.perez)

Si existe → primernombre.primerapellido.inicialsegundoapellido

Genera email: juan.perez@gobierno.talento.bo

Crea "CASO" para que funcionario complete ficha

Muestra constancia imprimible

4. FUNCIONARIO COMPLETA FICHA (Páginas 9-19)
Vista Principal: funcionario_completar_ficha.html
text
COMPLETAR FICHA TALENTO - JUAN PÉREZ
════════════════════════════════════════════
Progreso: ████████░░░░ 80% (4/5 secciones)

[Pestañas activas]:
1. ✅ DATOS PERSONALES (Completo)
2. ✅ DATOS ADICIONALES (Completo)  
3. ✅ FORMACIÓN ACADÉMICA (Completo)
4. ⏳ SEGURO SOCIAL (Pendiente)
5. ❌ EXPERIENCIA LABORAL (Pendiente)

[BOTÓN: Guardar y Continuar] [BOTÓN: Guardar y Salir]
A) DATOS PERSONALES (Página 10-11 - NRO. 5)
Vista: datos_personales.html (CAMPOS NO EDITABLES - vienen del admin)

text
DATOS PERSONALES (NO EDITABLE - Solo verificación)
──────────────────────────────────────────────────
Primer Apellido:    [PÉREZ] (bloqueado)
Segundo Apellido:   [GONZÁLEZ] (bloqueado)
Primer Nombre:      [JUAN] (bloqueado)
...
Número Identificación: [1234567] (bloqueado)

--- CAMPOS A COMPLETAR ---
Género:             [▼ MASCULINO / FEMENINO]*
Expedido en:        [▼ LA PAZ / SANTA CRUZ /...]*
Fecha Nacimiento:   [📅 __/__/____]* (≥18 años)
País Nacimiento:    [▼ BOLIVIA / ARGENTINA /...]*
(Al seleccionar "Bolivia", habilita:)
Departamento:       [▼ LA PAZ / COCHABAMBA /...]*
Provincia:          [▼ MURILLO / INGAVI /...]*
N° Libreta Militar: [______________] (obligatorio si género=M)
B) DATOS ADICIONALES (Página 11-12)
Vista: datos_adicionales.html

text
DATOS ADICIONALES
──────────────────────────────────────────────────
Estado Civil:       [▼ SOLTERO / CASADO /...]*
N° de Hijos:        [0] (numérico, 3 dígitos)
Dirección Domicilio:[Av. 16 de Julio #1234]*
Teléfono Celular:   [______________]* (10 dígitos)
Correo Electrónico: [juan@gmail.com]*
...
Declaración Jurada de Bienes:
N° DJ:              [LPZ-2025-001]*
Fecha DJ:           [📅 __/__/____]*
C) FORMACIÓN ACADÉMICA (Páginas 13-16 - NRO. 6)
Vista con pestañas internas:

text
[1. BACHILLERATO | 2. UNIVERSIDAD | 3. CURSOS | 4. IDIOMAS]

--- BACHILLERATO ---
¿Es bachiller?:     [▼ SÍ / NO]*
Si "SÍ":
  Año:              [2010]* (≤ año actual)
  Unidad Educativa: [COLEGIO "BOLIVIA"]*
Si "NO":
  Último curso:     [▼ 6TO DE PRIMARIA /...]*

--- UNIVERSIDAD ---
[+] AÑADIR TÍTULO
País Estudio:       [▼ BOLIVIA]*
Estado:             [▼ TITULADO / EGRESADO]*
Institución:        [▼ UMSA / UAGRM /...]*
Carrera:            [INGENIERÍA DE SISTEMAS]*
Titulado:           [▼ SÍ / NO]*
Fechas:             [📅 01/01/2015] a [📅 31/12/2020]
D) SEGURO SOCIAL (Página 16 - NRO. 7)
Vista: seguro_social.html

text
SEGURO SOCIAL
──────────────────────────────────────────────────
Caja de Salud:      [▼ COSSMIL / CAJA PETROLERA /...]*
Fecha Registro:     [📅 __/__/____]* (≤ hoy)
N° Formulario:      [______________] (opcional)
N° Seguro Social:   [______________]* (20 chars)

[BOTÓN: Guardar] [BOTÓN: Añadir Otro Seguro (+)]
E) EXPERIENCIA LABORAL (Páginas 17-18 - NRO. 8)
Vista con formulario repetible:

text
EXPERIENCIA LABORAL
[+] AÑADIR EXPERIENCIA

Experiencia 1:
Empresa:            [FICTICIA SRL]*
Área:               [RECURSOS HUMANOS]*
Puesto:             [ANALISTA JR]*
Fechas:             [📅 01/01/2020] a [📅 31/12/2022]
Salario:            [5000 Bs] (opcional)
Descripción:        [_________________________]*

[BOTÓN: Eliminar esta experiencia (🗑️)]
5. REVISIÓN Y APROBACIÓN (Páginas 18-28)
A) FUNCIONARIO REVISA TODO (NRO. 9)
Vista: revision_funcionario.html

text
REVISIÓN FINAL - ANTES DE ENVIAR
════════════════════════════════════════════

[RESUMEN DE TODOS LOS DATOS EN MODO LECTURA]
(igual que formulario pero sin editar)

DOCUMENTOS REQUERIDOS PARA SU PERFIL:
☑ [X] 1. Documento de identificación (OBLIGATORIO)
☑ [X] 2. Certificado de nacimiento (OBLIGATORIO)
☐ [ ] 3. Certificado de matrimonio (Solo si es CASADO)
☑ [X] 4. Libreta servicio militar (Solo si es VARÓN)
...

¿ESTÁN CORRECTOS TODOS LOS DATOS?
( ) SÍ - Continuar a impresión
( ) NO - Volver a corregir

[BOTÓN: CONFIRMAR Y ENVIAR]
B) ADMINISTRADOR REVISA (NRO. 13-14)
Vista: admin_revision.html

text
REVISIÓN ADMINISTRATIVA - TRÁMITE #2025-001
════════════════════════════════════════════

[Datos del funcionario en modo EDICIÓN/VER]

[Pestañas para revisar cada sección igual que funcionario]

DOCUMENTOS PRESENTADOS:
(Admin hace check de lo recibido físicamente)
☑ [✓] 1. CI - RECIBIDO
☑ [✓] 2. Cert. Nacimiento - RECIBIDO  
☐ [ ] 3. Cert. Matrimonio - FALTANTE
...

ACCIONES:
[ ] APROBAR Y DERIVAR A JEFE
[ ] DEVOLVER PARA CORRECCIÓN
[ ] CORREGIR DATOS DIRECTAMENTE

Motivo devolución: [_________________________]

[BOTÓN: GUARDAR DECISIÓN]
C) JEFE REVISA Y APRUEBA (NRO. 15-17)
Vista: jefe_aprobacion.html

text
APROBACIÓN FINAL - JEFE DE DEPARTAMENTO
════════════════════════════════════════════

[Datos en MODO SOLO LECTURA - no puede editar]

DOCUMENTOS VERIFICADOS POR ADMIN:
(Checklist solo para ver, no modificar)

¿APROBAR DEFINITIVAMENTE ESTE TRÁMITE?
( ) SÍ - Funcionario queda REGISTRADO
( ) NO - Devuelve a Administración

[BOTÓN: CONFIRMAR APROBACIÓN FINAL]
6. BAJA DE FUNCIONARIO (Páginas 29-31 - NRO. 18)
Vista solo ADMIN: admin_baja.html

text
BAJA DE FUNCIONARIO
════════════════════════════════════════════

Ingrese N° de Ítem: [________] [BOTÓN: Buscar]

--- DATOS AUTOCARGADOS AL BUSCAR ---
Funcionario: JUAN PÉREZ PÉREZ
Ítem: 278 - ANALISTA JR - RRHH

--- MOTIVO BAJA ---
Motivo Retiro:      [▼ RENUNCIA / DESPIDO / JUBILACIÓN]*
N° Memorándum:      [MEM-2025-001]*
Fecha Retiro:       [📅 __/__/____]* (≤ hoy)
Observaciones:      [_________________________]

[BOTÓN: CONFIRMAR BAJA] [BOTÓN: CANCELAR]
Al confirmar:

Estado funcionario → "D" (Deshabilitado)

Estado ítem → "F" (Acéfalo - disponible)

Notifica a nómina

7. MÓDULO CONSULTAS (Página 31-36 - NRO. 19)
Vista: consultas_generales.html

text
CONSULTAS Y VISUALIZACIÓN
════════════════════════════════════════════

[Barra de búsqueda: CI o Nombre: ______________ [🔍 Buscar]]

[Pestañas de información]:
1. 📋 DATOS PERSONALES
2. 👨‍👩‍👧‍👦 FAMILIARES  
3. 🎓 FORMACIÓN
4. 🏥 SEGURO SOCIAL
5. 💼 EXPERIENCIA
6. ⚖️ PROCESOS
7. 📄 DOCUMENTOS
8. 📋 LICENCIAS
9. ✈️ COMISIONES
10. ⚠️ FALTAS/ATRASOS

(Permite solo VER según permisos rol)
8. ESTRUCTURA DE NAVEGACIÓN
Para todos los roles:

text
┌─── BARRA SUPERIOR ──────────────────────────┐
│ [Logo] TALENTO │ [Usuario: Juan Pérez] ▼ │ [🔔 (3)] │ [❓ Ayuda] │ [🚪 Salir] │
└─────────────────────────────────────────────┘
Menú lateral según rol:

text
ADMIN:
├── 📊 Dashboard
├── 👤 Funcionarios
│   ├── ➕ Nuevo Registro
│   ├── 📋 Lista General
│   ├── ⬇️ Bajas
│   └── 🔄 Migración
├── 📄 Trámites
│   ├── ⏳ Pendientes
│   ├── 📄 Por Validar
│   └── 📈 Historial
├── 📊 Reportes
└── ⚙️ Configuración

FUNCIONARIO:
├── 🏠 Mi Inicio
├── 📝 Mi Ficha
├── 📄 Mis Documentos
├── 📋 Mis Trámites
└── 👤 Mi Perfil

JEFE:
├── 🏠 Dashboard
├── 👥 Mi Departamento
├── ✅ Aprobaciones Pendientes
├── 📋 Historial Aprobaciones
└── 📊 Reportes Departamento
🔑 PUNTOS CLAVE QUE ENTENDÍ DEL SISTEMA:
Tres roles bien diferenciados con permisos específicos

Flujo secuencial estricto: Admin crea → Funcionario completa → Admin revisa → Jefe aprueba

Validaciones condicionales complejas (ej: si es casado, si es varón, si es titulado)

Documentos dinámicos según perfil del funcionario

Estados de trámite: Pendiente → En revisión → Devuelto → Aprobado Admin → Aprobado Jefe → Finalizado

Ítems como recursos limitados que se asignan/liberan

Migración desde ACCESS como proceso separado

Códigos de verificación en login como capa extra seguridad

¿Estoy entendiendo bien el sistema? ¿Hay algún flujo o pantalla que deba ajustar antes de empezar a programar? ¿Quieres que profundice en algún módulo específico primero?

ok esta pasable lo que entendiste asi que trabajaremos para realizar el sistema, programaremos como te dije con visual studio code usando python con flask, sin muchas librerias extrañas para evitar errores de ejecucion y la base de datos SQLite ok?, ahora iremos poco a poco y empezaremos a realizar el sistema, iremos por partes que primero hacemos?
¡Excelente! Vamos paso a paso. Empecemos con la estructura base mínima del sistema Flask con SQLite.

PRIMER PASO: CONFIGURACIÓN INICIAL
1. Crear la estructura de carpetas:
text
talento_humano/
├── app.py
├── config.py
├── requirements.txt
├── .env
├── .gitignore
├── instance/
│   └── talento.db (se creará automáticamente)
├── models.py
├── forms.py
├── templates/
│   └── base.html
├── static/
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── script.js
└── routes/
    └── __init__.py
2. Crear requirements.txt:
txt
Flask==2.3.3
Flask-SQLAlchemy==3.0.5
Flask-Login==0.6.2
Flask-WTF==1.1.1
WTForms==3.0.1
python-dotenv==1.0.0
3. Crear config.py:
python
import os
from datetime import timedelta

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'clave_super_secreta_cambiar_en_produccion'
    SQLALCHEMY_DATABASE_URI = 'sqlite:///' + os.path.join(os.path.abspath(os.path.dirname(__file__)), 'instance', 'talento.db')
    SQLALCHEMY_TRACK_MODIFICATIONS = False
    SESSION_PERMANENT = True
    PERMANENT_SESSION_LIFETIME = timedelta(hours=2)
    
    # Configuración del sistema
    NOMBRE_SISTEMA = "Sistema Talento Humano"
    VERSION = "1.0"
    EMPRESA = "FICTICIA SRL"
    
    # Configuración de subida de archivos
    UPLOAD_FOLDER = os.path.join(os.path.abspath(os.path.dirname(__file__)), 'static', 'uploads')
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB máximo por archivo
    ALLOWED_EXTENSIONS = {'pdf', 'png', 'jpg', 'jpeg', 'doc', 'docx'}
4. Crear .env:
env
SECRET_KEY=clave_super_secreta_para_flask_123456
5. Crear .gitignore:
gitignore
__pycache__/
*.pyc
instance/
.env
*.db
.DS_Store
static/uploads/
6. Crear app.py (versión inicial mínima):
python
from flask import Flask, render_template
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager
import os
from dotenv import load_dotenv

# Cargar variables de entorno
load_dotenv()

# Inicializar extensiones
db = SQLAlchemy()
login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    
    # Configuración
    app.config.from_object('config.Config')
    
    # Inicializar extensiones con la app
    db.init_app(app)
    login_manager.init_app(app)
    
    # Configurar Flask-Login
    login_manager.login_view = 'auth.login'
    login_manager.login_message = 'Por favor inicie sesión para acceder a esta página.'
    login_manager.login_message_category = 'warning'
    
    # Crear carpeta de uploads si no existe
    if not os.path.exists(app.config['UPLOAD_FOLDER']):
        os.makedirs(app.config['UPLOAD_FOLDER'])
    
    # Crear carpeta instance si no existe
    if not os.path.exists(app.instance_path):
        os.makedirs(app.instance_path)
    
    # Registrar blueprints (rutas)
    from routes.auth import auth_bp
    from routes.main import main_bp
    
    app.register_blueprint(auth_bp)
    app.register_blueprint(main_bp)
    
    # Crear tablas en la base de datos
    with app.app_context():
        db.create_all()
        print("✅ Base de datos inicializada")
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(debug=True, port=5000)
7. Crear models.py (versión inicial):
python
from app import db
from flask_login import UserMixin
from datetime import datetime
from werkzeug.security import generate_password_hash, check_password_hash

class Usuario(UserMixin, db.Model):
    __tablename__ = 'usuarios'
    
    id = db.Column(db.Integer, primary_key=True)
    ci = db.Column(db.String(15), unique=True, nullable=False)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    password_hash = db.Column(db.String(256), nullable=False)
    rol = db.Column(db.String(20), nullable=False, default='funcionario')  # admin, funcionario, jefe
    activo = db.Column(db.Boolean, default=True)
    fecha_creacion = db.Column(db.DateTime, default=datetime.utcnow)
    ultimo_acceso = db.Column(db.DateTime)
    
    # Relación con funcionario (si aplica)
    funcionario_id = db.Column(db.Integer, db.ForeignKey('funcionarios.id'), nullable=True)
    funcionario = db.relationship('Funcionario', backref='usuario', lazy=True)
    
    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
    
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)
    
    def __repr__(self):
        return f'<Usuario {self.username}>'

class Funcionario(db.Model):
    __tablename__ = 'funcionarios'
    
    id = db.Column(db.Integer, primary_key=True)
    ci = db.Column(db.String(15), unique=True, nullable=False)
    primer_apellido = db.Column(db.String(30), nullable=False)
    segundo_apellido = db.Column(db.String(30))
    tercer_apellido = db.Column(db.String(30))
    primer_nombre = db.Column(db.String(30), nullable=False)
    segundo_nombre = db.Column(db.String(30))
    tercer_nombre = db.Column(db.String(30))
    tipo_identificacion = db.Column(db.String(20), nullable=False, default='CI')
    
    # Campos básicos del documento R-100
    estado = db.Column(db.String(20), default='pendiente')  # pendiente, activo, inactivo, baja
    fecha_registro = db.Column(db.DateTime, default=datetime.utcnow)
    fecha_actualizacion = db.Column(db.DateTime, onupdate=datetime.utcnow)
    
    def nombre_completo(self):
        nombres = f"{self.primer_nombre or ''} {self.segundo_nombre or ''} {self.tercer_nombre or ''}".strip()
        apellidos = f"{self.primer_apellido or ''} {self.segundo_apellido or ''} {self.tercer_apellido or ''}".strip()
        return f"{apellidos} {nombres}"
    
    def __repr__(self):
        return f'<Funcionario {self.nombre_completo()}>'

# Crearemos más modelos después, pero estos son los básicos para empezar
8. Crear forms.py (versión inicial):
python
from flask_wtf import FlaskForm
from wtforms import StringField, PasswordField, SubmitField, SelectField, DateField
from wtforms.validators import DataRequired, Email, Length, EqualTo, ValidationError
from models import Usuario

class LoginForm(FlaskForm):
    tipo_usuario = SelectField('Tipo de Usuario', 
                              choices=[('funcionario', 'Funcionario'), 
                                       ('admin', 'Administrador'), 
                                       ('jefe', 'Jefe de Departamento')],
                              validators=[DataRequired()])
    ci = StringField('Carnet de Identidad', validators=[DataRequired(), Length(min=5, max=15)])
    username = StringField('Usuario', validators=[DataRequired()])
    password = PasswordField('Contraseña', validators=[DataRequired()])
    codigo_verificacion = StringField('Código de Verificación', validators=[DataRequired(), Length(min=4, max=4)])
    codigo_sistema = StringField('Código del Sistema', validators=[DataRequired()])  # Esto se generará
    submit = SubmitField('Iniciar Sesión')

class RegistroFuncionarioForm(FlaskForm):
    # Datos Personales (Sección 1)
    ci = StringField('Número de Identificación', validators=[DataRequired(), Length(max=15)])
    primer_apellido = StringField('Primer Apellido', validators=[DataRequired(), Length(max=30)])
    segundo_apellido = StringField('Segundo Apellido', validators=[Length(max=30)])
    tercer_apellido = StringField('Tercer Apellido (Casada)', validators=[Length(max=30)])
    primer_nombre = StringField('Primer Nombre', validators=[DataRequired(), Length(max=30)])
    segundo_nombre = StringField('Segundo Nombre', validators=[Length(max=30)])
    tercer_nombre = StringField('Tercer Nombre', validators=[Length(max=30)])
    tipo_identificacion = SelectField('Tipo Identificación', 
                                     choices=[('CI', 'Carnet de Identidad'), 
                                              ('PASAPORTE', 'Pasaporte'),
                                              ('OTRO', 'Otro')],
                                     validators=[DataRequired()])
    
    submit = SubmitField('Registrar Funcionario')
9. Crear templates/base.html:
html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema Talento Humano - FICTICIA SRL{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <i class="fas fa-users me-2"></i>
                Sistema Talento Humano
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                                <i class="fas fa-home"></i> Inicio
                            </a>
                        </li>
                        
                        {% if current_user.rol == 'admin' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('main.registrar_funcionario') }}">
                                    <i class="fas fa-user-plus"></i> Nuevo Funcionario
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('main.lista_funcionarios') }}">
                                    <i class="fas fa-list"></i> Funcionarios
                                </a>
                            </li>
                        {% endif %}
                        
                        {% if current_user.rol == 'funcionario' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('main.mi_ficha') }}">
                                    <i class="fas fa-id-card"></i> Mi Ficha
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i>
                                {{ current_user.username }}
                                <span class="badge bg-light text-dark ms-1">{{ current_user.rol }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('main.perfil') }}">
                                    <i class="fas fa-user me-2"></i> Mi Perfil
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.login') }}">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mensajes flash -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Contenido principal -->
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-light border-top">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <span class="text-muted">
                        <i class="fas fa-copyright"></i> 2025 {{ config.EMPRESA }} - Sistema Talento Humano v{{ config.VERSION }}
                    </span>
                </div>
                <div class="col-md-6 text-end">
                    <span class="text-muted">
                        <i class="fas fa-user-shield"></i> Sistema de Gestión de Recursos Humanos
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS y dependencias -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts personalizados -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
10. Crear static/css/style.css:
css
/* Estilos generales */
body {
    background-color: #f8f9fa;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1;
}

/* Cards */
.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: none;
    margin-bottom: 1.5rem;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    font-weight: 600;
}

/* Botones */
.btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.btn-success {
    background-color: #198754;
    border-color: #198754;
}

/* Formularios */
.form-label {
    font-weight: 500;
    color: #495057;
}

.form-control:focus, .form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* Tablas */
.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
}

/* Alertas */
.alert {
    border: none;
    border-left: 4px solid;
}

.alert-success {
    border-left-color: #198754;
}

.alert-warning {
    border-left-color: #ffc107;
}

.alert-danger {
    border-left-color: #dc3545;
}

/* Login */
.login-container {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

/* Dashboard */
.dashboard-card {
    transition: transform 0.3s;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

/* Badges */
.badge {
    font-weight: 500;
}
11. Crear static/js/script.js:
javascript
// Scripts generales del sistema

// Confirmación antes de acciones importantes
document.addEventListener('DOMContentLoaded', function() {
    // Confirmar eliminación
    const deleteButtons = document.querySelectorAll('.btn-delete');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!confirm('¿Está seguro que desea eliminar este registro? Esta acción no se puede deshacer.')) {
                e.preventDefault();
            }
        });
    });
    
    // Confirmar baja de funcionario
    const bajaButtons = document.querySelectorAll('.btn-baja');
    bajaButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!confirm('¿Está seguro que desea dar de baja a este funcionario?')) {
                e.preventDefault();
            }
        });
    });
    
    // Validar formularios
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let valid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    valid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!valid) {
                e.preventDefault();
                alert('Por favor complete todos los campos obligatorios.');
            }
        });
    });
});
12. Crear routes/__init__.py:
python
# Este archivo marca la carpeta como paquete Python
13. Crear routes/auth.py:
python
from flask import Blueprint, render_template, redirect, url_for, flash, request, session
from flask_login import login_user, logout_user, login_required, current_user
import random
import string
from forms import LoginForm
from models import Usuario, db
from datetime import datetime

auth_bp = Blueprint('auth', __name__)

@auth_bp.route('/login', methods=['GET', 'POST'])
def login():
    if current_user.is_authenticated:
        return redirect(url_for('main.dashboard'))
    
    # Generar código de verificación
    if 'codigo_verificacion' not in session:
        session['codigo_verificacion'] = ''.join(random.choices(string.digits, k=4))
    
    form = LoginForm()
    form.codigo_sistema.data = session['codigo_verificacion']
    
    if form.validate_on_submit():
        # Verificar código de verificación
        if form.codigo_verificacion.data != session['codigo_verificacion']:
            flash('Código de verificación incorrecto', 'danger')
            return render_template('auth/login.html', form=form)
        
        # Buscar usuario
        usuario = Usuario.query.filter_by(
            username=form.username.data,
            ci=form.ci.data
        ).first()
        
        if usuario and usuario.check_password(form.password.data) and usuario.activo:
            if usuario.rol == form.tipo_usuario.data:
                usuario.ultimo_acceso = datetime.utcnow()
                db.session.commit()
                
                login_user(usuario)
                flash(f'¡Bienvenido(a) {usuario.username}!', 'success')
                
                # Redirigir según rol
                return redirect(url_for('main.dashboard'))
            else:
                flash('Tipo de usuario no coincide con el rol asignado', 'danger')
        else:
            flash('Credenciales incorrectas o usuario inactivo', 'danger')
    
    return render_template('auth/login.html', form=form)

@auth_bp.route('/logout')
@login_required
def logout():
    logout_user()
    flash('Sesión cerrada exitosamente', 'info')
    return redirect(url_for('auth.login'))

@auth_bp.route('/generar-codigo')
def generar_codigo():
    session['codigo_verificacion'] = ''.join(random.choices(string.digits, k=4))
    return {'codigo': session['codigo_verificacion']}
14. Crear routes/main.py:
python
from flask import Blueprint, render_template, redirect, url_for, flash, request
from flask_login import login_required, current_user
from forms import RegistroFuncionarioForm
from models import db, Funcionario, Usuario
from datetime import datetime

main_bp = Blueprint('main', __name__)

@main_bp.route('/')
def index():
    if current_user.is_authenticated:
        return redirect(url_for('main.dashboard'))
    return render_template('main/index.html')

@main_bp.route('/dashboard')
@login_required
def dashboard():
    # Estadísticas según rol
    if current_user.rol == 'admin':
        total_funcionarios = Funcionario.query.count()
        pendientes = Funcionario.query.filter_by(estado='pendiente').count()
        activos = Funcionario.query.filter_by(estado='activo').count()
        
        return render_template('main/dashboard_admin.html',
                             total_funcionarios=total_funcionarios,
                             pendientes=pendientes,
                             activos=activos)
    
    elif current_user.rol == 'funcionario':
        funcionario = Funcionario.query.filter_by(id=current_user.funcionario_id).first()
        return render_template('main/dashboard_funcionario.html',
                             funcionario=funcionario)
    
    elif current_user.rol == 'jefe':
        return render_template('main/dashboard_jefe.html')
    
    return redirect(url_for('main.index'))

@main_bp.route('/registrar-funcionario', methods=['GET', 'POST'])
@login_required
def registrar_funcionario():
    if current_user.rol != 'admin':
        flash('No tiene permisos para acceder a esta función', 'danger')
        return redirect(url_for('main.dashboard'))
    
    form = RegistroFuncionarioForm()
    
    if form.validate_on_submit():
        try:
            # Verificar si ya existe el CI
            if Funcionario.query.filter_by(ci=form.ci.data).first():
                flash('Ya existe un funcionario con este CI', 'danger')
                return render_template('main/registrar_funcionario.html', form=form)
            
            # Crear funcionario
            funcionario = Funcionario(
                ci=form.ci.data,
                primer_apellido=form.primer_apellido.data.upper(),
                segundo_apellido=form.segundo_apellido.data.upper() if form.segundo_apellido.data else None,
                tercer_apellido=form.tercer_apellido.data.upper() if form.tercer_apellido.data else None,
                primer_nombre=form.primer_nombre.data.upper(),
                segundo_nombre=form.segundo_nombre.data.upper() if form.segundo_nombre.data else None,
                tercer_nombre=form.tercer_nombre.data.upper() if form.tercer_nombre.data else None,
                tipo_identificacion=form.tipo_identificacion.data,
                estado='pendiente'
            )
            
            db.session.add(funcionario)
            db.session.flush()  # Para obtener el ID
            
            # Crear usuario para el funcionario
            username = f"{funcionario.primer_nombre.lower()}.{funcionario.primer_apellido.lower()}"
            
            # Verificar si el username ya existe
            contador = 1
            username_original = username
            while Usuario.query.filter_by(username=username).first():
                if funcionario.segundo_apellido:
                    inicial = funcionario.segundo_apellido[0].lower()
                    username = f"{username_original}.{inicial}"
                else:
                    username = f"{username_original}{contador}"
                    contador += 1
            
            email = f"{username}@gobierno.talento.bo"
            password = funcionario.ci  # Contraseña inicial = CI
            
            usuario = Usuario(
                ci=funcionario.ci,
                username=username,
                email=email,
                rol='funcionario',
                funcionario_id=funcionario.id
            )
            usuario.set_password(password)
            
            db.session.add(usuario)
            db.session.commit()
            
            flash(f'Funcionario registrado exitosamente. Usuario: {username}, Contraseña: {password}', 'success')
            return redirect(url_for('main.lista_funcionarios'))
            
        except Exception as e:
            db.session.rollback()
            flash(f'Error al registrar funcionario: {str(e)}', 'danger')
    
    return render_template('main/registrar_funcionario.html', form=form)

@main_bp.route('/funcionarios')
@login_required
def lista_funcionarios():
    if current_user.rol != 'admin':
        flash('No tiene permisos para acceder a esta función', 'danger')
        return redirect(url_for('main.dashboard'))
    
    funcionarios = Funcionario.query.all()
    return render_template('main/lista_funcionarios.html', funcionarios=funcionarios)

@main_bp.route('/perfil')
@login_required
def perfil():
    return render_template('main/perfil.html')
15. Crear templates necesarios:
templates/main/index.html:

html
{% extends "base.html" %}

{% block title %}Inicio - Sistema Talento Humano{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="card">
            <div class="card-body py-5">
                <h1 class="display-4 text-primary mb-4">
                    <i class="fas fa-users"></i> Sistema Talento Humano
                </h1>
                <p class="lead mb-4">
                    Sistema de Gestión de Recursos Humanos de <strong>FICTICIA SRL</strong><br>
                    Versión {{ config.VERSION }}
                </p>
                <div class="row mt-5">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                                <h5>Administradores</h5>
                                <p>Gestión completa del sistema y funcionarios</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-tie fa-3x text-success mb-3"></i>
                                <h5>Funcionarios</h5>
                                <p>Completar fichas y gestionar información personal</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-cog fa-3x text-warning mb-3"></i>
                                <h5>Jefes de Departamento</h5>
                                <p>Revisión y aprobación de trámites</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-5">
                    <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
templates/auth/login.html:

html
{% extends "base.html" %}

{% block title %}Iniciar Sesión - Sistema Talento Humano{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-sign-in-alt me-2"></i> Inicio de Sesión
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('auth.login') }}">
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ form.tipo_usuario.label(class="form-label") }}
                        {{ form.tipo_usuario(class="form-select") }}
                        {% if form.tipo_usuario.errors %}
                            <div class="text-danger">
                                {% for error in form.tipo_usuario.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.ci.label(class="form-label") }}
                        {{ form.ci(class="form-control", placeholder="Ej: 1234567") }}
                        {% if form.ci.errors %}
                            <div class="text-danger">
                                {% for error in form.ci.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.username.label(class="form-label") }}
                        {{ form.username(class="form-control", placeholder="Nombre de usuario") }}
                        {% if form.username.errors %}
                            <div class="text-danger">
                                {% for error in form.username.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.password.label(class="form-label") }}
                        {{ form.password(class="form-control", placeholder="Contraseña") }}
                        {% if form.password.errors %}
                            <div class="text-danger">
                                {% for error in form.password.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <small class="text-muted d-block">Código del Sistema</small>
                                        <h3 class="text-primary mb-0">{{ form.codigo_sistema.data }}</h3>
                                        <small class="text-muted">Copie este código abajo</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {{ form.codigo_verificacion.label(class="form-label") }}
                                {{ form.codigo_verificacion(class="form-control text-center", placeholder="XXXX", maxlength="4") }}
                                {% if form.codigo_verificacion.errors %}
                                    <div class="text-danger">
                                        {% for error in form.codigo_verificacion.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                    </div>
                </form>
            </div>
            <div class="card-footer text-center text-muted">
                <small>Sistema Talento Humano &copy; 2025</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Generar nuevo código
    document.getElementById('generar-codigo').addEventListener('click', function() {
        fetch('{{ url_for("auth.generar_codigo") }}')
            .then(response => response.json())
            .then(data => {
                document.getElementById('codigo_sistema').innerText = data.codigo;
            });
    });
});
</script>
{% endblock %}
📁 PASOS PARA EJECUTAR:
Crear la estructura de carpetas como se muestra arriba

Instalar dependencias:

bash
pip install -r requirements.txt
Ejecutar la aplicación:

bash
python app.py
Acceder en el navegador:

text
http://localhost:5000
👤 CREAR USUARIO ADMIN INICIAL (manual):
Necesitamos crear un usuario admin para empezar. Podemos hacerlo con un script o manualmente. Te sugiero agregar esto en app.py después de crear la app:

python
# En app.py, dentro de create_app(), después de db.create_all():
with app.app_context():
    db.create_all()
    
    # Crear usuario admin si no existe
    if not Usuario.query.filter_by(username='admin').first():
        admin = Usuario(
            ci='0000000',
            username='admin',
            email='admin@gobierno.talento.bo',
            rol='admin',
            activo=True
        )
        admin.set_password('admin123')  # Cambiar en producción!
        db.session.add(admin)
        db.session.commit()
        print("👑 Usuario admin creado: admin / admin123")
    
    print("✅ Base de datos inicializada")
¿Qué te parece? ¿Comenzamos así y luego vamos agregando las demás funcionalidades paso a paso? ¿O prefieres que ajustemos algo primero?

si esta bien asi para luego completarlo poco a poco las demas cosas, pero primero quiero correr hasta donde tenemos y este error me sale:
PS C:\xampp\htdocs\prototipo2\talento_humano> python app.py
Traceback (most recent call last):
  File "C:\xampp\htdocs\prototipo2\talento_humano\app.py", line 2, in <module>
    from flask_sqlalchemy import SQLAlchemy
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_sqlalchemy\__init__.py", line 5, in <module>
    from .extension import SQLAlchemy
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_sqlalchemy\extension.py", line 7, in <module>
    import sqlalchemy as sa
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
Este error es de compatibilidad entre Python 3.13 y SQLAlchemy. Python 3.13 introdujo cambios en el sistema de tipos que rompen algunas bibliotecas. Aquí te muestro cómo solucionarlo:

SOLUCIÓN RÁPIDA:
Opción 1: Usar Python 3.11 o 3.12 (Recomendado)
Python 3.13 es muy nuevo (Oct 2024) y muchas librerías aún no son compatibles.

Instalar Python 3.12:

Descarga desde python.org

Versión 3.12.8 es estable

Instalar y asegurarte de agregar al PATH

Crear entorno virtual con Python 3.12:

bash
# En PowerShell
py -3.12 -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
Opción 2: Actualizar SQLAlchemy (si quieres usar Python 3.13)
bash
pip install --upgrade sqlalchemy==2.0.25
pip install --upgrade flask-sqlalchemy==3.1.1
Opción 3: Usar versión más reciente de todo (si la anterior no funciona):
bash
# Primero desinstalar
pip uninstall flask-sqlalchemy sqlalchemy

# Instalar versiones específicas
pip install flask-sqlalchemy==3.1.1
pip install sqlalchemy==2.0.30
ARCHIVO requirements.txt ACTUALIZADO:
txt
Flask==2.3.3
Flask-SQLAlchemy==3.1.1
Flask-Login==0.6.2
Flask-WTF==1.1.1
WTForms==3.0.1
python-dotenv==1.0.0
SQLAlchemy==2.0.30
PASOS PARA RESOLVER:
Paso 1: Verificar versión de Python:
bash
python --version
# Si dice Python 3.13.x, entonces necesitas cambiar

py --list
# Ver qué versiones tienes instaladas
Paso 2: Si tienes Python 3.11 o 3.12, úsalo:
bash
# Usar Python 3.12 específicamente
py -3.12 -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
Paso 3: Si solo tienes Python 3.13, actualizar dependencias:
bash
# En tu directorio del proyecto
pip install --upgrade pip

# Instalar versiones compatibles
pip install Flask==2.3.3
pip install Flask-SQLAlchemy==3.1.1
pip install Flask-Login==0.6.2
pip install Flask-WTF==1.1.1
pip install WTForms==3.0.1
pip install python-dotenv==1.0.0
pip install SQLAlchemy==2.0.30

# Verificar instalación
pip list
Paso 4: Si persiste el error, usar solución temporal en el código:
En app.py, antes de importar Flask-SQLAlchemy:

python
import sys
import os

# Solución temporal para Python 3.13
if sys.version_info >= (3, 13):
    os.environ['SQLALCHEMY_WARN_20'] = '1'

from flask import Flask, render_template
# ... resto del código
ARCHIVO app.py COMPLETO CORREGIDO:
python
import sys
import os

# Solución para Python 3.13
if sys.version_info >= (3, 13):
    os.environ['SQLALCHEMY_WARN_20'] = '1'

from flask import Flask, render_template
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager
from dotenv import load_dotenv

# Cargar variables de entorno
load_dotenv()

# Inicializar extensiones
db = SQLAlchemy()
login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    
    # Configuración
    app.config.from_object('config.Config')
    
    # Inicializar extensiones con la app
    db.init_app(app)
    login_manager.init_app(app)
    
    # Configurar Flask-Login
    login_manager.login_view = 'auth.login'
    login_manager.login_message = 'Por favor inicie sesión para acceder a esta página.'
    login_manager.login_message_category = 'warning'
    
    # Crear carpeta de uploads si no existe
    if not os.path.exists(app.config['UPLOAD_FOLDER']):
        os.makedirs(app.config['UPLOAD_FOLDER'])
    
    # Crear carpeta instance si no existe
    if not os.path.exists(app.instance_path):
        os.makedirs(app.instance_path)
    
    # Importar modelos después de inicializar db
    from models import Usuario, Funcionario
    
    # Registrar blueprints (rutas)
    from routes.auth import auth_bp
    from routes.main import main_bp
    
    app.register_blueprint(auth_bp)
    app.register_blueprint(main_bp)
    
    # Crear tablas y usuario admin
    with app.app_context():
        db.create_all()
        
        # Crear usuario admin si no existe
        if not Usuario.query.filter_by(username='admin').first():
            admin = Usuario(
                ci='0000000',
                username='admin',
                email='admin@gobierno.talento.bo',
                rol='admin',
                activo=True
            )
            admin.set_password('admin123')  # Cambiar en producción!
            db.session.add(admin)
            db.session.commit()
            print("👑 Usuario admin creado: admin / admin123")
        
        print("✅ Base de datos inicializada")
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(debug=True, port=5000)
SI NADA FUNCIONA, USAR SQLite DIRECTAMENTE (sin SQLAlchemy):
Como alternativa más simple, podemos usar SQLite3 nativo de Python:

python
# app_simple.py - Versión simplificada sin SQLAlchemy
from flask import Flask, render_template, request, redirect, url_for, flash, session
import sqlite3
import os
import random
import string
from datetime import datetime
from functools import wraps

app = Flask(__name__)
app.secret_key = 'clave_super_secreta_123'
app.config['DATABASE'] = 'instance/talento.db'

def init_db():
    conn = sqlite3.connect(app.config['DATABASE'])
    cursor = conn.cursor()
    
    # Tabla de usuarios
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS usuarios (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ci TEXT UNIQUE NOT NULL,
        username TEXT UNIQUE NOT NULL,
        email TEXT UNIQUE NOT NULL,
        password_hash TEXT NOT NULL,
        rol TEXT NOT NULL DEFAULT 'funcionario',
        activo BOOLEAN DEFAULT 1,
        fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')
    
    # Tabla de funcionarios
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS funcionarios (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ci TEXT UNIQUE NOT NULL,
        primer_apellido TEXT NOT NULL,
        segundo_apellido TEXT,
        tercer_apellido TEXT,
        primer_nombre TEXT NOT NULL,
        segundo_nombre TEXT,
        tercer_nombre TEXT,
        tipo_identificacion TEXT DEFAULT 'CI',
        estado TEXT DEFAULT 'pendiente',
        fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    ''')
    
    # Insertar admin si no existe
    cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
    if not cursor.fetchone():
        cursor.execute('''
        INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
        VALUES (?, ?, ?, ?, ?, ?)
        ''', ('0000000', 'admin', 'admin@talento.bo', 'hash_aqui', 'admin', 1))
    
    conn.commit()
    conn.close()

def login_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            flash('Por favor inicie sesión', 'warning')
            return redirect(url_for('login'))
        return f(*args, **kwargs)
    return decorated_function

@app.route('/')
def index():
    if 'user_id' in session:
        return redirect(url_for('dashboard'))
    return render_template('main/index.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        # Validar login simple
        username = request.form['username']
        password = request.form['password']  # En realidad debería hashearse
        
        conn = sqlite3.connect(app.config['DATABASE'])
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM usuarios WHERE username = ?', (username,))
        user = cursor.fetchone()
        conn.close()
        
        if user and user[4] == password:  # Comparación simple
            session['user_id'] = user[0]
            session['username'] = user[2]
            session['rol'] = user[5]
            flash('Login exitoso', 'success')
            return redirect(url_for('dashboard'))
        else:
            flash('Credenciales incorrectas', 'danger')
    
    return render_template('auth/login.html')

@app.route('/logout')
def logout():
    session.clear()
    flash('Sesión cerrada', 'info')
    return redirect(url_for('index'))

@app.route('/dashboard')
@login_required
def dashboard():
    return render_template(f'main/dashboard_{session["rol"]}.html')

if __name__ == '__main__':
    # Asegurar que existe la carpeta instance
    os.makedirs('instance', exist_ok=True)
    
    # Inicializar base de datos
    init_db()
    
    app.run(debug=True, port=5000)
¿QUÉ QUIERES HACER?
¿Cambiar a Python 3.12? (Recomendado - más estable)

¿Actualizar SQLAlchemy? (Intentar con las versiones que te puse)

¿Usar versión simplificada sin SQLAlchemy? (Más simple pero menos potente)

Dime qué prefieres y te ayudo paso a paso.

corre normal la pagina ahora pero me da este error:jinja2.exceptions.TemplateNotFound: templates/main/index.html

Traceback (most recent call last)
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2213, in __call__
return self.wsgi_app(environ, start_response)
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2193, in wsgi_app
response = self.handle_exception(e)
           ^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
response = self.full_dispatch_request()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
rv = self.handle_user_exception(e)
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
rv = self.dispatch_request()
     ^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\xampp\htdocs\prototipo2\talento_humano\app.py", line 74, in index
return render_template('templates/main/index.html')
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
El error es porque Flask busca las plantillas en la carpeta templates/ automáticamente. Cuando escribes 'templates/main/index.html', está buscando en templates/templates/main/index.html.

Solución: Solo debes poner 'main/index.html' en lugar de 'templates/main/index.html'.

CORRECCIÓN EN app.py:
Busca esta línea en app.py (línea 74):
python
return render_template('templates/main/index.html')
Cámbiala por:
python
return render_template('main/index.html')
Y en routes/main.py también:
En la función index():
python
@main_bp.route('/')
def index():
    if current_user.is_authenticated:
        return redirect(url_for('main.dashboard'))
    return render_template('main/index.html')  # <-- Así, sin 'templates/'
CREA TODAS LAS PLANTILLAS FALTANTES:
1. templates/main/index.html:
html
{% extends "base.html" %}

{% block title %}Inicio - Sistema Talento Humano{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="card">
            <div class="card-body py-5">
                <h1 class="display-4 text-primary mb-4">
                    <i class="fas fa-users"></i> Sistema Talento Humano
                </h1>
                <p class="lead mb-4">
                    Sistema de Gestión de Recursos Humanos de <strong>FICTICIA SRL</strong><br>
                    Versión {{ config.VERSION }}
                </p>
                <div class="row mt-5">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                                <h5>Administradores</h5>
                                <p>Gestión completa del sistema y funcionarios</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-tie fa-3x text-success mb-3"></i>
                                <h5>Funcionarios</h5>
                                <p>Completar fichas y gestionar información personal</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="fas fa-user-cog fa-3x text-warning mb-3"></i>
                                <h5>Jefes de Departamento</h5>
                                <p>Revisión y aprobación de trámites</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-5">
                    <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
2. templates/main/dashboard_admin.html:
html
{% extends "base.html" %}

{% block title %}Dashboard - Administrador{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-tachometer-alt me-2"></i> Dashboard Administrador
        </h1>
        <p class="text-muted">Panel de control del sistema</p>
    </div>
</div>

<div class="row">
    <!-- Tarjeta 1 -->
    <div class="col-md-3 mb-4">
        <div class="card dashboard-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Funcionarios</h6>
                        <h3 class="mb-0">{{ total_funcionarios }}</h3>
                    </div>
                    <div class="bg-primary text-white rounded-circle p-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tarjeta 2 -->
    <div class="col-md-3 mb-4">
        <div class="card dashboard-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Pendientes</h6>
                        <h3 class="mb-0">{{ pendientes }}</h3>
                    </div>
                    <div class="bg-warning text-white rounded-circle p-3">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tarjeta 3 -->
    <div class="col-md-3 mb-4">
        <div class="card dashboard-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Activos</h6>
                        <h3 class="mb-0">{{ activos }}</h3>
                    </div>
                    <div class="bg-success text-white rounded-circle p-3">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tarjeta 4 -->
    <div class="col-md-3 mb-4">
        <div class="card dashboard-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Bajas</h6>
                        <h3 class="mb-0">{{ total_funcionarios - activos - pendientes }}</h3>
                    </div>
                    <div class="bg-danger text-white rounded-circle p-3">
                        <i class="fas fa-user-minus fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i> Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('main.registrar_funcionario') }}" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus me-2"></i> Nuevo Funcionario
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('main.lista_funcionarios') }}" class="btn btn-success w-100">
                            <i class="fas fa-list me-2"></i> Ver Funcionarios
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-warning w-100">
                            <i class="fas fa-file-alt me-2"></i> Reportes
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-2"></i> Bajas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
3. templates/main/dashboard_funcionario.html:
html
{% extends "base.html" %}

{% block title %}Mi Dashboard - Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-tie me-2"></i> Mi Panel - {{ funcionario.nombre_completo() if funcionario else current_user.username }}
        </h1>
        <p class="text-muted">Bienvenido al sistema Talento Humano</p>
    </div>
</div>

{% if funcionario and funcionario.estado == 'pendiente' %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i> Acción Requerida</h5>
            <p class="mb-0">
                Debe completar su ficha TALENTO dentro de los próximos <strong>5 días hábiles</strong>.
                <a href="{{ url_for('main.mi_ficha') }}" class="alert-link">Haga clic aquí para completarla</a>.
            </p>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- Tarjeta 1 -->
    <div class="col-md-4 mb-4">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <div class="bg-primary text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-id-card fa-3x"></i>
                </div>
                <h5>Mi Ficha TALENTO</h5>
                <p class="text-muted">Complete su información personal y profesional</p>
                <a href="{{ url_for('main.mi_ficha') }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Completar Ficha
                </a>
            </div>
        </div>
    </div>
    
    <!-- Tarjeta 2 -->
    <div class="col-md-4 mb-4">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <div class="bg-success text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-file-upload fa-3x"></i>
                </div>
                <h5>Documentos</h5>
                <p class="text-muted">Suba los documentos requeridos</p>
                <a href="#" class="btn btn-success">
                    <i class="fas fa-upload me-1"></i> Subir Documentos
                </a>
            </div>
        </div>
    </div>
    
    <!-- Tarjeta 3 -->
    <div class="col-md-4 mb-4">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <div class="bg-info text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-history fa-3x"></i>
                </div>
                <h5>Mis Trámites</h5>
                <p class="text-muted">Revise el estado de sus trámites</p>
                <a href="#" class="btn btn-info">
                    <i class="fas fa-search me-1"></i> Ver Trámites
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i> Información Importante</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>Tiene <strong>5 días hábiles</strong> para completar su ficha TALENTO.</li>
                    <li>Los documentos deben ser escaneados en formato PDF o imagen.</li>
                    <li>Para consultas, contacte al departamento de Recursos Humanos.</li>
                    <li>Guarde su número de trámite una vez generado.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
4. templates/main/dashboard_jefe.html:
html
{% extends "base.html" %}

{% block title %}Dashboard - Jefe de Departamento{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-cog me-2"></i> Dashboard - Jefe de Departamento
        </h1>
        <p class="text-muted">Panel de revisión y aprobación</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0">
                    <i class="fas fa-clipboard-check me-2"></i> Formularios Pendientes
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Tiene <strong>3</strong> formularios pendientes de revisión.</p>
                <a href="#" class="btn btn-warning">
                    <i class="fas fa-eye me-1"></i> Revisar Pendientes
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i> Documentos por Validar
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Hay <strong>7</strong> documentos esperando validación.</p>
                <a href="#" class="btn btn-info">
                    <i class="fas fa-check-circle me-1"></i> Validar Documentos
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i> Acciones Disponibles</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <a href="#" class="btn btn-outline-primary w-100">
                            <i class="fas fa-search me-2"></i> Revisar Formularios
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="#" class="btn btn-outline-success w-100">
                            <i class="fas fa-check-double me-2"></i> Validar Documentos
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="#" class="btn btn-outline-info w-100">
                            <i class="fas fa-chart-bar me-2"></i> Reportes Departamento
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
5. templates/main/registrar_funcionario.html:
html
{% extends "base.html" %}

{% block title %}Registrar Nuevo Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-plus me-2"></i> Registrar Nuevo Funcionario
        </h1>
        <p class="text-muted">Complete los datos básicos del funcionario</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab" disabled>
                            <i class="fas fa-file-contract me-1"></i> Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignar-item" data-bs-toggle="tab" disabled>
                            <i class="fas fa-briefcase me-1"></i> Asignar Ítem
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#archivos" data-bs-toggle="tab" disabled>
                            <i class="fas fa-file-upload me-1"></i> Archivos
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('main.registrar_funcionario') }}">
                    {{ form.hidden_tag() }}
                    
                    <div class="tab-content">
                        <!-- Pestaña 1: Datos Personales -->
                        <div class="tab-pane fade show active" id="datos-personales">
                            <h5 class="mb-4">Datos Personales del Funcionario</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.ci.label(class="form-label") }}
                                    {{ form.ci(class="form-control", placeholder="Ej: 1234567") }}
                                    {% if form.ci.errors %}
                                        <div class="text-danger small">
                                            {% for error in form.ci.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.tipo_identificacion.label(class="form-label") }}
                                    {{ form.tipo_identificacion(class="form-select") }}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    {{ form.primer_apellido.label(class="form-label") }}
                                    {{ form.primer_apellido(class="form-control", placeholder="Primer apellido") }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.segundo_apellido.label(class="form-label") }}
                                    {{ form.segundo_apellido(class="form-control", placeholder="Segundo apellido") }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.tercer_apellido.label(class="form-label") }}
                                    {{ form.tercer_apellido(class="form-control", placeholder="Apellido de casada") }}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    {{ form.primer_nombre.label(class="form-label") }}
                                    {{ form.primer_nombre(class="form-control", placeholder="Primer nombre") }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.segundo_nombre.label(class="form-label") }}
                                    {{ form.segundo_nombre(class="form-control", placeholder="Segundo nombre") }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.tercer_nombre.label(class="form-label") }}
                                    {{ form.tercer_nombre(class="form-control", placeholder="Tercer nombre") }}
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Registrar Funcionario
                                </button>
                                <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                                    <i class="fas fa-times me-1"></i> Cancelar
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validación simple
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const ci = document.getElementById('ci');
        const primerApellido = document.getElementById('primer_apellido');
        const primerNombre = document.getElementById('primer_nombre');
        
        let valid = true;
        
        if (!ci.value.trim()) {
            ci.classList.add('is-invalid');
            valid = false;
        }
        
        if (!primerApellido.value.trim()) {
            primerApellido.classList.add('is-invalid');
            valid = false;
        }
        
        if (!primerNombre.value.trim()) {
            primerNombre.classList.add('is-invalid');
            valid = false;
        }
        
        if (!valid) {
            e.preventDefault();
            alert('Por favor complete los campos obligatorios');
        }
    });
});
</script>
{% endblock %}
6. templates/main/lista_funcionarios.html:
html
{% extends "base.html" %}

{% block title %}Lista de Funcionarios{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-users me-2"></i> Funcionarios Registrados
                </h1>
                <p class="text-muted">Gestión de funcionarios del sistema</p>
            </div>
            <a href="{{ url_for('main.registrar_funcionario') }}" class="btn btn-primary">
                <i class="fas fa-user-plus me-1"></i> Nuevo Funcionario
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {% if funcionarios %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>CI</th>
                                <th>Nombre Completo</th>
                                <th>Tipo ID</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for funcionario in funcionarios %}
                            <tr>
                                <td>{{ funcionario.ci }}</td>
                                <td>{{ funcionario.nombre_completo() }}</td>
                                <td>{{ funcionario.tipo_identificacion }}</td>
                                <td>
                                    {% if funcionario.estado == 'pendiente' %}
                                        <span class="badge bg-warning">Pendiente</span>
                                    {% elif funcionario.estado == 'activo' %}
                                        <span class="badge bg-success">Activo</span>
                                    {% elif funcionario.estado == 'inactivo' %}
                                        <span class="badge bg-secondary">Inactivo</span>
                                    {% else %}
                                        <span class="badge bg-danger">Baja</span>
                                    {% endif %}
                                </td>
                                <td>{{ funcionario.fecha_registro.strftime('%d/%m/%Y') }}</td>
                                <td>
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-outline-success" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-outline-danger" title="Baja">
                                        <i class="fas fa-user-minus"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-users fa-4x text-muted mb-3"></i>
                    <h5>No hay funcionarios registrados</h5>
                    <p class="text-muted">Comience registrando un nuevo funcionario</p>
                    <a href="{{ url_for('main.registrar_funcionario') }}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-1"></i> Registrar Primer Funcionario
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
7. templates/main/perfil.html:
html
{% extends "base.html" %}

{% block title %}Mi Perfil{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-circle me-2"></i> Mi Perfil
        </h1>
        <p class="text-muted">Información de su cuenta</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <div class="bg-primary text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-user fa-3x"></i>
                </div>
                <h4>{{ current_user.username }}</h4>
                <p class="text-muted">{{ current_user.email }}</p>
                <div class="mb-3">
                    <span class="badge bg-primary">{{ current_user.rol|upper }}</span>
                </div>
                <p class="text-muted small">
                    Miembro desde: {{ current_user.fecha_creacion.strftime('%d/%m/%Y') }}
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Información de la Cuenta</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Usuario:</strong>
                        <p>{{ current_user.username }}</p>
                    </div>
                    <div class="col-md-6">
                        <strong>CI:</strong>
                        <p>{{ current_user.ci }}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Email:</strong>
                        <p>{{ current_user.email }}</p>
                    </div>
                    <div class="col-md-6">
                        <strong>Rol:</strong>
                        <p>{{ current_user.rol|upper }}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Estado:</strong>
                        <p>
                            {% if current_user.activo %}
                                <span class="badge bg-success">Activo</span>
                            {% else %}
                                <span class="badge bg-danger">Inactivo</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <strong>Último acceso:</strong>
                        <p>
                            {% if current_user.ultimo_acceso %}
                                {{ current_user.ultimo_acceso.strftime('%d/%m/%Y %H:%M') }}
                            {% else %}
                                No registrado
                            {% endif %}
                        </p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-primary" disabled>
                        <i class="fas fa-edit me-1"></i> Editar Perfil
                    </button>
                    <button class="btn btn-outline-secondary" disabled>
                        <i class="fas fa-key me-1"></i> Cambiar Contraseña
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
RESUMEN DE CORRECCIONES:
En app.py: Cambiar render_template('templates/main/index.html') por render_template('main/index.html')

En routes/main.py: Asegurar que todas las rutas usen 'main/index.html' sin templates/

Crear todas las plantillas faltantes en templates/

ESTRUCTURA FINAL DE CARPETAS:
text
talento_humano/
├── app.py
├── config.py
├── requirements.txt
├── .env
├── .gitignore
├── models.py
├── forms.py
├── instance/
│   └── talento.db
├── static/
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── script.js
├── templates/
│   ├── base.html
│   ├── auth/
│   │   └── login.html
│   └── main/
│       ├── index.html
│       ├── dashboard_admin.html
│       ├── dashboard_funcionario.html
│       ├── dashboard_jefe.html
│       ├── registrar_funcionario.html
│       ├── lista_funcionarios.html
│       └── perfil.html
└── routes/
    ├── __init__.py
    ├── auth.py
    └── main.py
Ahora debería funcionar. Ve a http://localhost:5000 y prueba:

Login con: admin / admin123

Deberías ver el dashboard del admin

Prueba registrar un funcionario

¿Funciona ahora?

ya corregi lo que me digiste y cree los demas archivos faltantes, ahora dice este error:
werkzeug.routing.exceptions.BuildError: Could not build url for endpoint 'main.index'. Did you mean 'index' instead?

Traceback (most recent call last)
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2213, in __call__
return self.wsgi_app(environ, start_response)
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2193, in wsgi_app
response = self.handle_exception(e)
           ^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
response = self.full_dispatch_request()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
rv = self.handle_user_exception(e)
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
rv = self.dispatch_request()
     ^^^^^^^^^^^^^^^^^^^^^^^
File "C:\Users\DIEGO\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "C:\xampp\htdocs\prototipo2\talento_humano\app.py", line 74, in index
return render_template('main/index.html')
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
El error es porque en app.py tienes una función index() que no está registrada correctamente en el Blueprint main. Vamos a corregirlo:

PROBLEMA:
En app.py tienes:

python
@app.route('/')
def index():
    return render_template('main/index.html')
Pero también en routes/main.py tienes:

python
@main_bp.route('/')
def index():
    # ...
Están duplicadas y Flask está confundido.

SOLUCIÓN:
Opción 1: Eliminar la función index() de app.py
En app.py, elimina o comenta estas líneas (alrededor de la línea 74):

python
# ELIMINA ESTO:
@app.route('/')
def index():
    return render_template('main/index.html')

# O COMENTA ASÍ:
# @app.route('/')
# def index():
#     return render_template('main/index.html')
Opción 2: O mejor, actualiza app.py completo:
Aquí está el app.py corregido:

python
import sys
import os

# Solución para Python 3.13
if sys.version_info >= (3, 13):
    os.environ['SQLALCHEMY_WARN_20'] = '1'

from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager
from dotenv import load_dotenv

# Cargar variables de entorno
load_dotenv()

# Inicializar extensiones
db = SQLAlchemy()
login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    
    # Configuración
    app.config.from_object('config.Config')
    
    # Inicializar extensiones con la app
    db.init_app(app)
    login_manager.init_app(app)
    
    # Configurar Flask-Login
    login_manager.login_view = 'auth.login'
    login_manager.login_message = 'Por favor inicie sesión para acceder a esta página.'
    login_manager.login_message_category = 'warning'
    
    # Crear carpeta de uploads si no existe
    if not os.path.exists(app.config['UPLOAD_FOLDER']):
        os.makedirs(app.config['UPLOAD_FOLDER'])
    
    # Crear carpeta instance si no existe
    if not os.path.exists(app.instance_path):
        os.makedirs(app.instance_path)
    
    # Importar modelos después de inicializar db
    with app.app_context():
        # Importar aquí para evitar import circular
        from models import Usuario, Funcionario
        
        # Crear tablas y usuario admin
        db.create_all()
        
        # Crear usuario admin si no existe
        if not Usuario.query.filter_by(username='admin').first():
            admin = Usuario(
                ci='0000000',
                username='admin',
                email='admin@gobierno.talento.bo',
                rol='admin',
                activo=True
            )
            admin.set_password('admin123')  # Cambiar en producción!
            db.session.add(admin)
            db.session.commit()
            print("👑 Usuario admin creado: admin / admin123")
        
        print("✅ Base de datos inicializada")
    
    # Registrar blueprints (rutas) - DESPUÉS de crear tablas
    from routes.auth import auth_bp
    from routes.main import main_bp
    
    app.register_blueprint(auth_bp, url_prefix='/auth')
    app.register_blueprint(main_bp)
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(debug=True, port=5000)
Opción 3: Si prefieres mantener una ruta simple en app.py:
Si quieres mantener la ruta en app.py, cambia el nombre de la función:

python
# En app.py
@app.route('/')
def home():
    return render_template('main/index.html')
Y luego en templates/base.html cambia los enlaces de url_for('main.index') a url_for('home').

CORRECCIÓN MÁS SENCILLA:
Abre app.py

Busca estas líneas (alrededor de la línea 74):

python
@app.route('/')
def index():
    return render_template('main/index.html')
Coméntalas o elimínalas:

python
# @app.route('/')
# def index():
#     return render_template('main/index.html')
Asegúrate que en routes/main.py tengas esto:

python
@main_bp.route('/')
def index():
    if current_user.is_authenticated:
        return redirect(url_for('main.dashboard'))
    return render_template('main/index.html')
En templates/base.html verifica los enlaces:

En la barra de navegación de base.html, el logo debería apuntar a main.index:

html
<a class="navbar-brand" href="{{ url_for('main.index') }}">
VERIFICA TAMBIÉN EN templates/auth/login.html:
En la parte inferior del login, el botón debería ser:

html
<a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg px-5">
    <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
</a>
Pero si quieres ir a la página principal, debería ser:

html
<a href="{{ url_for('main.index') }}" class="btn btn-primary btn-lg px-5">
    <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
</a>
RESUMEN:
El problema es que tienes dos funciones llamadas index():

Una en app.py (sin blueprint)

Otra en routes/main.py (con blueprint main_bp)

Solución: Elimina la de app.py y deja solo la de routes/main.py.

Pasos:

Elimina/Comenta las líneas de index() en app.py

Reinicia el servidor Flask

Accede a http://localhost:5000

¿Funciona ahora?

aver aver se cago todo, borrare todo y comenzaremos de nuevo pero ahora ya sabes con "SQLite" y manejar bien los datos, no quiero que te olvides que duplicaste un dato y lo volviste a poner en otro ok?, comenzaremos de nuevo desde cero
¡Perfecto! Empezaremos desde cero de manera ordenada y simplificada, usando SQLite directamente (sin SQLAlchemy para evitar problemas) y estructurando bien el sistema paso a paso.

📁 ESTRUCTURA DEL PROYECTO - VERSIÓN SIMPLIFICADA
text
talento_humano/
├── app.py                    # Archivo principal
├── database.py              # Gestión de base de datos
├── auth.py                  # Autenticación y usuarios
├── requirements.txt         # Dependencias
├── .gitignore
├── instance/
│   └── talento.db          # Base de datos SQLite
├── templates/
│   ├── base.html           # Template base
│   ├── index.html          # Página principal
│   ├── login.html          # Login
│   ├── dashboard_admin.html
│   ├── dashboard_funcionario.html
│   └── dashboard_jefe.html
├── static/
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── script.js
└── uploads/                # Para documentos
PASO 1: CREAR ARCHIVOS BÁSICOS
1. requirements.txt:
txt
Flask==2.3.3
python-dotenv==1.0.0
2. .gitignore:
gitignore
__pycache__/
*.pyc
instance/
.env
*.db
.DS_Store
uploads/
3. .env:
env
SECRET_KEY=clave_super_secreta_talento_humano_2025
PASO 2: CREAR database.py
python
import sqlite3
import os
from datetime import datetime

class Database:
    def __init__(self, db_path='instance/talento.db'):
        self.db_path = db_path
        self.init_db()
    
    def get_connection(self):
        """Obtener conexión a la base de datos"""
        conn = sqlite3.connect(self.db_path)
        conn.row_factory = sqlite3.Row  # Para acceso por nombre de columna
        return conn
    
    def init_db(self):
        """Inicializar base de datos con tablas necesarias"""
        # Crear directorio instance si no existe
        os.makedirs('instance', exist_ok=True)
        
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Tabla de usuarios
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS usuarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            username TEXT UNIQUE NOT NULL,
            email TEXT UNIQUE NOT NULL,
            password_hash TEXT NOT NULL,
            rol TEXT NOT NULL DEFAULT 'funcionario',
            activo INTEGER DEFAULT 1,
            fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            ultimo_acceso TIMESTAMP
        )
        ''')
        
        # Tabla de funcionarios (según documento R-100)
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS funcionarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            primer_apellido TEXT NOT NULL,
            segundo_apellido TEXT,
            tercer_apellido TEXT,
            primer_nombre TEXT NOT NULL,
            segundo_nombre TEXT,
            tercer_nombre TEXT,
            tipo_identificacion TEXT DEFAULT 'CI',
            
            -- Campos básicos del sistema
            estado TEXT DEFAULT 'pendiente',
            fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            fecha_actualizacion TIMESTAMP,
            
            -- Datos de resolución
            nro_resolucion TEXT,
            fecha_resolucion DATE,
            fecha_posesion DATE,
            nro_memorandum TEXT,
            fecha_memorandum DATE,
            
            -- Datos de ítem
            nro_item TEXT,
            administracion TEXT,
            jerarquia TEXT,
            unidad_organizacional TEXT,
            cargo TEXT,
            puesto TEXT
        )
        ''')
        
        # Tabla para documentos de respaldo
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS documentos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            funcionario_id INTEGER NOT NULL,
            tipo_documento TEXT NOT NULL,
            nombre_archivo TEXT NOT NULL,
            ruta_archivo TEXT NOT NULL,
            fecha_subida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
        )
        ''')
        
        # Insertar usuario admin por defecto
        cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
        if not cursor.fetchone():
            # Contraseña: admin123 (hasheada simple para desarrollo)
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
            VALUES (?, ?, ?, ?, ?, ?)
            ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
                  'pbkdf2:sha256:260000$abc123$hash_simple', 'admin', 1))
        
        conn.commit()
        conn.close()
        print("✅ Base de datos inicializada correctamente")
    
    # Métodos CRUD para usuarios
    def get_usuario_by_username(self, username):
        """Obtener usuario por nombre de usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE username = ? AND activo = 1", (username,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def get_usuario_by_ci(self, ci):
        """Obtener usuario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE ci = ? AND activo = 1", (ci,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def crear_usuario(self, ci, username, email, password_hash, rol='funcionario'):
        """Crear nuevo usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        try:
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol)
            VALUES (?, ?, ?, ?, ?)
            ''', (ci, username, email, password_hash, rol))
            conn.commit()
            user_id = cursor.lastrowid
            conn.close()
            return user_id
        except sqlite3.IntegrityError as e:
            conn.close()
            raise Exception(f"Error al crear usuario: {str(e)}")
    
    # Métodos CRUD para funcionarios
    def crear_funcionario(self, datos):
        """Crear nuevo funcionario según formulario R-100"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        campos = [
            'ci', 'primer_apellido', 'segundo_apellido', 'tercer_apellido',
            'primer_nombre', 'segundo_nombre', 'tercer_nombre', 'tipo_identificacion'
        ]
        
        valores = [datos.get(campo) for campo in campos]
        
        cursor.execute(f'''
        INSERT INTO funcionarios ({', '.join(campos)})
        VALUES ({', '.join(['?'] * len(campos))})
        ''', valores)
        
        funcionario_id = cursor.lastrowid
        conn.commit()
        conn.close()
        return funcionario_id
    
    def get_funcionario_by_ci(self, ci):
        """Obtener funcionario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios WHERE ci = ?", (ci,))
        funcionario = cursor.fetchone()
        conn.close()
        return funcionario
    
    def get_all_funcionarios(self):
        """Obtener todos los funcionarios"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios ORDER BY fecha_registro DESC")
        funcionarios = cursor.fetchall()
        conn.close()
        return funcionarios
    
    def contar_funcionarios_por_estado(self):
        """Contar funcionarios por estado"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        cursor.execute("SELECT estado, COUNT(*) as cantidad FROM funcionarios GROUP BY estado")
        resultados = cursor.fetchall()
        
        # Crear diccionario con todos los estados
        conteo = {
            'pendiente': 0,
            'activo': 0,
            'inactivo': 0,
            'baja': 0
        }
        
        for row in resultados:
            estado = row['estado']
            if estado in conteo:
                conteo[estado] = row['cantidad']
        
        conn.close()
        return conteo
    
    def actualizar_ultimo_acceso(self, user_id):
        """Actualizar último acceso del usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("UPDATE usuarios SET ultimo_acceso = CURRENT_TIMESTAMP WHERE id = ?", (user_id,))
        conn.commit()
        conn.close()
PASO 3: CREAR auth.py
python
import hashlib
import secrets
from datetime import datetime
from functools import wraps
from flask import session, redirect, url_for, flash

class Auth:
    def __init__(self, db):
        self.db = db
    
    def hash_password(self, password):
        """Hash simple de contraseña (para desarrollo)"""
        salt = "talento_humano_2025"
        return hashlib.sha256((password + salt).encode()).hexdigest()
    
    def verify_password(self, password, password_hash):
        """Verificar contraseña"""
        return self.hash_password(password) == password_hash
    
    def login_required(self, f):
        """Decorador para requerir login"""
        @wraps(f)
        def decorated_function(*args, **kwargs):
            if 'user_id' not in session:
                flash('Por favor inicie sesión para acceder a esta página.', 'warning')
                return redirect(url_for('login'))
            return f(*args, **kwargs)
        return decorated_function
    
    def role_required(self, roles):
        """Decorador para requerir rol específico"""
        def decorator(f):
            @wraps(f)
            def decorated_function(*args, **kwargs):
                if 'user_id' not in session:
                    flash('Por favor inicie sesión.', 'warning')
                    return redirect(url_for('login'))
                
                if session.get('rol') not in roles:
                    flash('No tiene permisos para acceder a esta página.', 'danger')
                    return redirect(url_for('dashboard'))
                
                return f(*args, **kwargs)
            return decorated_function
        return decorator
    
    def generar_codigo_verificacion(self):
        """Generar código de verificación de 4 dígitos"""
        return ''.join(secrets.choice('0123456789') for _ in range(4))
PASO 4: CREAR app.py (PRINCIPAL)
python
import os
from flask import Flask, render_template, request, redirect, url_for, flash, session
from dotenv import load_dotenv
from database import Database
from auth import Auth

# Cargar variables de entorno
load_dotenv()

# Crear aplicación Flask
app = Flask(__name__)
app.secret_key = os.environ.get('SECRET_KEY') or 'clave_secreta_default'

# Configuración
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB

# Inicializar base de datos y autenticación
db = Database()
auth = Auth(db)

# Crear carpetas necesarias
os.makedirs('instance', exist_ok=True)
os.makedirs('uploads', exist_ok=True)
os.makedirs('templates', exist_ok=True)
os.makedirs('static/css', exist_ok=True)
os.makedirs('static/js', exist_ok=True)

# ==================== RUTAS PÚBLICAS ====================

@app.route('/')
def index():
    """Página principal"""
    if 'user_id' in session:
        # Redirigir al dashboard según rol
        rol = session.get('rol')
        if rol == 'admin':
            return redirect(url_for('dashboard_admin'))
        elif rol == 'funcionario':
            return redirect(url_for('dashboard_funcionario'))
        elif rol == 'jefe':
            return redirect(url_for('dashboard_jefe'))
    
    return render_template('index.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    """Página de login"""
    if 'user_id' in session:
        return redirect(url_for('index'))
    
    # Generar código de verificación si no existe en sesión
    if 'codigo_verificacion' not in session:
        session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    
    if request.method == 'POST':
        # Obtener datos del formulario
        tipo_usuario = request.form.get('tipo_usuario')
        ci = request.form.get('ci')
        username = request.form.get('username')
        password = request.form.get('password')
        codigo_ingresado = request.form.get('codigo_verificacion')
        
        # Validar código de verificación
        if codigo_ingresado != session.get('codigo_verificacion'):
            flash('Código de verificación incorrecto', 'danger')
            session['codigo_verificacion'] = auth.generar_codigo_verificacion()
            return render_template('login.html', codigo=session['codigo_verificacion'])
        
        # Buscar usuario
        usuario = db.get_usuario_by_username(username)
        
        if usuario and usuario['ci'] == ci:
            # Verificar contraseña
            if auth.verify_password(password, usuario['password_hash']):
                # Verificar que el rol coincida
                if usuario['rol'] == tipo_usuario:
                    # Iniciar sesión
                    session['user_id'] = usuario['id']
                    session['username'] = usuario['username']
                    session['ci'] = usuario['ci']
                    session['email'] = usuario['email']
                    session['rol'] = usuario['rol']
                    
                    # Actualizar último acceso
                    db.actualizar_ultimo_acceso(usuario['id'])
                    
                    flash(f'¡Bienvenido(a) {usuario["username"]}!', 'success')
                    
                    # Redirigir según rol
                    if usuario['rol'] == 'admin':
                        return redirect(url_for('dashboard_admin'))
                    elif usuario['rol'] == 'funcionario':
                        return redirect(url_for('dashboard_funcionario'))
                    elif usuario['rol'] == 'jefe':
                        return redirect(url_for('dashboard_jefe'))
                else:
                    flash('El tipo de usuario no coincide con su rol asignado', 'danger')
            else:
                flash('Contraseña incorrecta', 'danger')
        else:
            flash('Usuario o CI incorrectos', 'danger')
        
        # Generar nuevo código
        session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    
    return render_template('login.html', codigo=session['codigo_verificacion'])

@app.route('/logout')
def logout():
    """Cerrar sesión"""
    session.clear()
    flash('Sesión cerrada exitosamente', 'info')
    return redirect(url_for('index'))

@app.route('/generar-codigo')
def generar_codigo():
    """Generar nuevo código de verificación"""
    session['codigo_verificacion'] = auth.generar_codigo_verificacion()
    return {'codigo': session['codigo_verificacion']}

# ==================== RUTAS DE ADMIN ====================

@app.route('/admin/dashboard')
@auth.login_required
@auth.role_required(['admin'])
def dashboard_admin():
    """Dashboard para administradores"""
    # Obtener estadísticas
    conteo_estados = db.contar_funcionarios_por_estado()
    total_funcionarios = sum(conteo_estados.values())
    
    return render_template('dashboard_admin.html',
                         total_funcionarios=total_funcionarios,
                         pendientes=conteo_estados['pendiente'],
                         activos=conteo_estados['activo'])

@app.route('/admin/funcionarios')
@auth.login_required
@auth.role_required(['admin'])
def funcionarios_lista():
    """Lista de funcionarios"""
    funcionarios = db.get_all_funcionarios()
    return render_template('funcionarios_lista.html', funcionarios=funcionarios)

@app.route('/admin/funcionarios/nuevo', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_nuevo():
    """Registrar nuevo funcionario"""
    if request.method == 'POST':
        # Obtener datos del formulario
        datos = {
            'ci': request.form.get('ci'),
            'primer_apellido': request.form.get('primer_apellido'),
            'segundo_apellido': request.form.get('segundo_apellido'),
            'tercer_apellido': request.form.get('tercer_apellido'),
            'primer_nombre': request.form.get('primer_nombre'),
            'segundo_nombre': request.form.get('segundo_nombre'),
            'tercer_nombre': request.form.get('tercer_nombre'),
            'tipo_identificacion': request.form.get('tipo_identificacion')
        }
        
        try:
            # Crear funcionario
            funcionario_id = db.crear_funcionario(datos)
            
            # Crear usuario para el funcionario
            username = f"{datos['primer_nombre'].lower()}.{datos['primer_apellido'].lower()}"
            email = f"{username}@gobierno.talento.bo"
            password_hash = auth.hash_password(datos['ci'])  # Contraseña inicial = CI
            
            # Verificar si el username ya existe
            usuario_existente = db.get_usuario_by_username(username)
            contador = 1
            username_original = username
            
            while usuario_existente:
                if datos.get('segundo_apellido'):
                    inicial = datos['segundo_apellido'][0].lower()
                    username = f"{username_original}.{inicial}"
                else:
                    username = f"{username_original}{contador}"
                    contador += 1
                usuario_existente = db.get_usuario_by_username(username)
            
            # Crear usuario
            user_id = db.crear_usuario(
                ci=datos['ci'],
                username=username,
                email=email,
                password_hash=password_hash,
                rol='funcionario'
            )
            
            flash(f'Funcionario registrado exitosamente. Usuario: {username}, Contraseña: {datos["ci"]}', 'success')
            return redirect(url_for('funcionarios_lista'))
            
        except Exception as e:
            flash(f'Error al registrar funcionario: {str(e)}', 'danger')
    
    return render_template('funcionario_nuevo.html')

# ==================== RUTAS DE FUNCIONARIO ====================

@app.route('/funcionario/dashboard')
@auth.login_required
@auth.role_required(['funcionario'])
def dashboard_funcionario():
    """Dashboard para funcionarios"""
    # Obtener datos del funcionario
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('dashboard_funcionario.html', funcionario=funcionario)

# ==================== RUTAS DE JEFE ====================

@app.route('/jefe/dashboard')
@auth.login_required
@auth.role_required(['jefe'])
def dashboard_jefe():
    """Dashboard para jefes de departamento"""
    return render_template('dashboard_jefe.html')

# ==================== EJECUCIÓN ====================

if __name__ == '__main__':
    print("🚀 Iniciando Sistema Talento Humano...")
    print("🌐 Accede en: http://localhost:5000")
    print("👤 Usuario admin: admin / admin123")
    app.run(debug=True, port=5000)
PASO 5: CREAR TEMPLATES HTML
1. templates/base.html:
html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema Talento Humano{% endblock %}</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-users me-2"></i> Sistema Talento Humano
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if 'user_id' in session %}
                        <li class="nav-item">
                            <a class="nav-link" href="
                                {% if session.rol == 'admin' %}
                                    {{ url_for('dashboard_admin') }}
                                {% elif session.rol == 'funcionario' %}
                                    {{ url_for('dashboard_funcionario') }}
                                {% elif session.rol == 'jefe' %}
                                    {{ url_for('dashboard_jefe') }}
                                {% endif %}
                            ">
                                <i class="fas fa-home"></i> Inicio
                            </a>
                        </li>
                        
                        {% if session.rol == 'admin' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('funcionario_nuevo') }}">
                                    <i class="fas fa-user-plus"></i> Nuevo Funcionario
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('funcionarios_lista') }}">
                                    <i class="fas fa-list"></i> Funcionarios
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    {% if 'user_id' in session %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i>
                                {{ session.username }}
                                <span class="badge bg-light text-dark ms-1">{{ session.rol }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">
                                    <i class="fas fa-user me-2"></i> Mi Perfil
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('login') }}">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mensajes flash -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Contenido principal -->
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-light border-top">
        <div class="container text-center">
            <span class="text-muted">
                <i class="fas fa-copyright"></i> 2025 FICTICIA SRL - Sistema Talento Humano v1.0
            </span>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts personalizados -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
2. templates/index.html:
html
{% extends "base.html" %}

{% block title %}Inicio - Sistema Talento Humano{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="card border-0 shadow-lg">
            <div class="card-body py-5">
                <h1 class="display-4 text-primary mb-4">
                    <i class="fas fa-users"></i> Sistema Talento Humano
                </h1>
                <p class="lead mb-4">
                    Sistema de Gestión de Recursos Humanos<br>
                    <strong>FICTICIA SRL</strong>
                </p>
                
                <div class="row mt-5">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                                <h5>Administradores</h5>
                                <p class="text-muted">Gestión completa del sistema</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <i class="fas fa-user-tie fa-3x text-success mb-3"></i>
                                <h5>Funcionarios</h5>
                                <p class="text-muted">Complete su ficha TALENTO</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <i class="fas fa-user-cog fa-3x text-warning mb-3"></i>
                                <h5>Jefes</h5>
                                <p class="text-muted">Revisión y aprobación</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5">
                    <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
3. templates/login.html:
html
{% extends "base.html" %}

{% block title %}Inicio de Sesión{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-sign-in-alt me-2"></i> Inicio de Sesión
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('login') }}">
                    <div class="mb-3">
                        <label for="tipo_usuario" class="form-label">Tipo de Usuario</label>
                        <select class="form-select" id="tipo_usuario" name="tipo_usuario" required>
                            <option value="">Seleccionar...</option>
                            <option value="admin">Administrador</option>
                            <option value="funcionario">Funcionario</option>
                            <option value="jefe">Jefe de Departamento</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="ci" class="form-label">Carnet de Identidad (CI)</label>
                        <input type="text" class="form-control" id="ci" name="ci" 
                               placeholder="Ej: 1234567" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="username" class="form-label">Nombre de Usuario</label>
                        <input type="text" class="form-control" id="username" name="username" 
                               placeholder="Ingrese su usuario" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" name="password" 
                               placeholder="Ingrese su contraseña" required>
                    </div>
                    
                    <div class="mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <small class="text-muted d-block">Código del Sistema</small>
                                        <h3 class="text-primary mb-0" id="codigo-display">{{ codigo }}</h3>
                                        <small class="text-muted">Copie este código</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="codigo_verificacion" class="form-label">Código de Verificación</label>
                                <input type="text" class="form-control text-center" id="codigo_verificacion" 
                                       name="codigo_verificacion" placeholder="XXXX" maxlength="4" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-2" 
                                        onclick="generarNuevoCodigo()">
                                    <i class="fas fa-sync-alt me-1"></i> Nuevo Código
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                        </button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center text-muted">
                <small>Credenciales demo: admin / admin123</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function generarNuevoCodigo() {
    fetch('{{ url_for("generar_codigo") }}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('codigo-display').textContent = data.codigo;
        });
}
</script>
{% endblock %}
4. templates/dashboard_admin.html:
html
{% extends "base.html" %}

{% block title %}Dashboard Administrador{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-tachometer-alt me-2"></i> Dashboard Administrador
        </h1>
        <p class="text-muted">Panel de control del sistema</p>
    </div>
</div>

<div class="row">
    <div class="col-md-3 mb-4">
        <div class="card border-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Funcionarios</h6>
                        <h3 class="mb-0">{{ total_funcionarios }}</h3>
                    </div>
                    <div class="bg-primary text-white rounded-circle p-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Pendientes</h6>
                        <h3 class="mb-0">{{ pendientes }}</h3>
                    </div>
                    <div class="bg-warning text-white rounded-circle p-3">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Activos</h6>
                        <h3 class="mb-0">{{ activos }}</h3>
                    </div>
                    <div class="bg-success text-white rounded-circle p-3">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-danger">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Inactivos/Baja</h6>
                        <h3 class="mb-0">{{ total_funcionarios - activos - pendientes }}</h3>
                    </div>
                    <div class="bg-danger text-white rounded-circle p-3">
                        <i class="fas fa-user-minus fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i> Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus me-2"></i> Nuevo Funcionario
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('funcionarios_lista') }}" class="btn btn-success w-100">
                            <i class="fas fa-list me-2"></i> Ver Funcionarios
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-warning w-100">
                            <i class="fas fa-file-alt me-2"></i> Generar Reportes
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="#" class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-2"></i> Bajas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
5. templates/dashboard_funcionario.html:
html
{% extends "base.html" %}

{% block title %}Mi Panel - Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-tie me-2"></i> Mi Panel
        </h1>
        <p class="text-muted">Bienvenido al sistema Talento Humano</p>
    </div>
</div>

{% if funcionario and funcionario['estado'] == 'pendiente' %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i> Acción Requerida</h5>
            <p class="mb-0">
                Debe completar su ficha TALENTO dentro de los próximos <strong>5 días hábiles</strong>.
                <a href="#" class="alert-link">Haga clic aquí para completarla</a>.
            </p>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <div class="bg-primary text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-id-card fa-3x"></i>
                </div>
                <h5>Mi Ficha TALENTO</h5>
                <p class="text-muted">Complete su información</p>
                <a href="#" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Completar Ficha
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <div class="bg-success text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-file-upload fa-3x"></i>
                </div>
                <h5>Documentos</h5>
                <p class="text-muted">Suba documentos requeridos</p>
                <a href="#" class="btn btn-success">
                    <i class="fas fa-upload me-1"></i> Subir Documentos
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <div class="bg-info text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-history fa-3x"></i>
                </div>
                <h5>Mis Trámites</h5>
                <p class="text-muted">Revise estado de trámites</p>
                <a href="#" class="btn btn-info">
                    <i class="fas fa-search me-1"></i> Ver Trámites
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
6. templates/dashboard_jefe.html:
html
{% extends "base.html" %}

{% block title %}Dashboard - Jefe{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-cog me-2"></i> Dashboard - Jefe de Departamento
        </h1>
        <p class="text-muted">Panel de revisión y aprobación</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0">
                    <i class="fas fa-clipboard-check me-2"></i> Formularios Pendientes
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Tiene <strong>3</strong> formularios pendientes de revisión.</p>
                <a href="#" class="btn btn-warning">
                    <i class="fas fa-eye me-1"></i> Revisar Pendientes
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i> Documentos por Validar
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Hay <strong>7</strong> documentos esperando validación.</p>
                <a href="#" class="btn btn-info">
                    <i class="fas fa-check-circle me-1"></i> Validar Documentos
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
7. templates/funcionario_nuevo.html:
html
{% extends "base.html" %}

{% block title %}Nuevo Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-plus me-2"></i> Registrar Nuevo Funcionario
        </h1>
        <p class="text-muted">Complete los datos básicos del funcionario</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Datos Personales</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('funcionario_nuevo') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="ci" class="form-label">Número de Identificación *</label>
                            <input type="text" class="form-control" id="ci" name="ci" 
                                   placeholder="Ej: 1234567" maxlength="15" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="tipo_identificacion" class="form-label">Tipo Identificación *</label>
                            <select class="form-select" id="tipo_identificacion" name="tipo_identificacion" required>
                                <option value="CI">Carnet de Identidad (CI)</option>
                                <option value="PASAPORTE">Pasaporte</option>
                                <option value="OTRO">Otro</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                            <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" 
                                   placeholder="Primer apellido" maxlength="30" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
                            <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" 
                                   placeholder="Segundo apellido" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="tercer_apellido" class="form-label">Tercer Apellido</label>
                            <input type="text" class="form-control" id="tercer_apellido" name="tercer_apellido" 
                                   placeholder="Apellido de casada" maxlength="30">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="primer_nombre" class="form-label">Primer Nombre *</label>
                            <input type="text" class="form-control" id="primer_nombre" name="primer_nombre" 
                                   placeholder="Primer nombre" maxlength="30" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                            <input type="text" class="form-control" id="segundo_nombre" name="segundo_nombre" 
                                   placeholder="Segundo nombre" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="tercer_nombre" class="form-label">Tercer Nombre</label>
                            <input type="text" class="form-control" id="tercer_nombre" name="tercer_nombre" 
                                   placeholder="Tercer nombre" maxlength="30">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Registrar Funcionario
                        </button>
                        <a href="{{ url_for('dashboard_admin') }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
8. templates/funcionarios_lista.html:
html
{% extends "base.html" %}

{% block title %}Lista de Funcionarios{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-users me-2"></i> Funcionarios Registrados
                </h1>
                <p class="text-muted">Gestión de funcionarios del sistema</p>
            </div>
            <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary">
                <i class="fas fa-user-plus me-1"></i> Nuevo Funcionario
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {% if funcionarios %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>CI</th>
                                <th>Nombre Completo</th>
                                <th>Tipo ID</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for funcionario in funcionarios %}
                            <tr>
                                <td>{{ funcionario['ci'] }}</td>
                                <td>
                                    {{ funcionario['primer_apellido'] }} 
                                    {% if funcionario['segundo_apellido'] %} {{ funcionario['segundo_apellido'] }}{% endif %}
                                    {% if funcionario['tercer_apellido'] %} {{ funcionario['tercer_apellido'] }}{% endif %}
                                    {{ funcionario['primer_nombre'] }}
                                    {% if funcionario['segundo_nombre'] %} {{ funcionario['segundo_nombre'] }}{% endif %}
                                    {% if funcionario['tercer_nombre'] %} {{ funcionario['tercer_nombre'] }}{% endif %}
                                </td>
                                <td>{{ funcionario['tipo_identificacion'] }}</td>
                                <td>
                                    {% if funcionario['estado'] == 'pendiente' %}
                                        <span class="badge bg-warning">Pendiente</span>
                                    {% elif funcionario['estado'] == 'activo' %}
                                        <span class="badge bg-success">Activo</span>
                                    {% elif funcionario['estado'] == 'inactivo' %}
                                        <span class="badge bg-secondary">Inactivo</span>
                                    {% else %}
                                        <span class="badge bg-danger">Baja</span>
                                    {% endif %}
                                </td>
                                <td>{{ funcionario['fecha_registro'][:10] }}</td>
                                <td>
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-outline-success" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-outline-danger" title="Baja">
                                        <i class="fas fa-user-minus"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-users fa-4x text-muted mb-3"></i>
                    <h5>No hay funcionarios registrados</h5>
                    <p class="text-muted">Comience registrando un nuevo funcionario</p>
                    <a href="{{ url_for('funcionario_nuevo') }}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-1"></i> Registrar Primer Funcionario
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
PASO 6: CREAR ARCHIVOS ESTÁTICOS
1. static/css/style.css:
css
/* Estilos generales */
body {
    background-color: #f8f9fa;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1;
}

/* Cards */
.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: none;
    margin-bottom: 1.5rem;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    font-weight: 600;
}

/* Formularios */
.form-label {
    font-weight: 500;
    color: #495057;
}

.form-control:focus, .form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* Tablas */
.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
}

/* Login */
.login-container {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

/* Dashboard cards */
.dashboard-card {
    transition: transform 0.3s;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
2. static/js/script.js:
javascript
// Scripts generales del sistema

document.addEventListener('DOMContentLoaded', function() {
    // Validación de formularios
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let valid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    valid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!valid) {
                e.preventDefault();
                alert('Por favor complete todos los campos obligatorios.');
            }
        });
    });
    
    // Auto-uppercase para nombres y apellidos
    const textFields = document.querySelectorAll('input[type="text"]');
    textFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (this.name.includes('nombre') || this.name.includes('apellido')) {
                this.value = this.value.toUpperCase();
            }
        });
    });
});
PASO 7: EJECUTAR EL SISTEMA
Crear la estructura de carpetas:

text
talento_humano/
├── app.py
├── database.py
├── auth.py
├── requirements.txt
├── .env
├── .gitignore
└── (las carpetas templates, static, instance, uploads)
Instalar dependencias:

bash
pip install -r requirements.txt
Ejecutar:

bash
python app.py
Acceder:

URL: http://localhost:5000

Admin: admin / admin123

Funcionario: (creado automáticamente al registrar funcionario)

FUNCIONALIDADES INCLUIDAS:
✅ Login con código de verificación
✅ Roles: Admin, Funcionario, Jefe
✅ Registro de funcionarios
✅ Dashboard por rol
✅ Lista de funcionarios
✅ Base de datos SQLite simple
✅ Validaciones básicas
✅ Estructura limpia y organizada

PRÓXIMOS PASOS (cuando esto funcione):
Formulario completo de funcionario (datos personales, resolución, ítem, archivos)

Funcionario completa su ficha TALENTO

Sistema de documentos y validación

Aprobación por jefe de departamento

Reportes y consultas

¿Listo para probar este sistema simplificado?

ok esta lindo pero quiero ingresar con un usuario y nose cual usuario hay en la base de datos, creo que vi que estaba admin pero nose cual es su contraseña
Tienes razón, en el código que te pasé el usuario admin se crea automáticamente con estas credenciales:

USUARIO ADMIN POR DEFECTO:
CI: 0000000

Usuario: admin

Email: admin@gobierno.talento.bo

Contraseña: admin123

Rol: admin

PERO HAY UN PROBLEMA:
En database.py usé un hash simple para desarrollo:

python
# En auth.py - el hash es:
def hash_password(self, password):
    salt = "talento_humano_2025"
    return hashlib.sha256((password + salt).encode()).hexdigest()
Pero en database.py puse un hash fijo en el INSERT:

python
cursor.execute('''
INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
VALUES (?, ?, ?, ?, ?, ?)
''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
      'pbkdf2:sha256:260000$abc123$hash_simple', 'admin', 1))  # <-- ESTE HASH ESTÁ MAL
SOLUCIÓN RÁPIDA:
Opción 1: Modificar database.py para usar hash correcto
Actualiza la función init_db() en database.py:

python
def init_db(self):
    """Inicializar base de datos con tablas necesarias"""
    # Crear directorio instance si no existe
    os.makedirs('instance', exist_ok=True)
    
    conn = self.get_connection()
    cursor = conn.cursor()
    
    # ... (tablas igual) ...
    
    # Insertar usuario admin por defecto
    cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
    if not cursor.fetchone():
        # CALCULAR HASH CORRECTO usando la misma lógica que auth.py
        import hashlib
        salt = "talento_humano_2025"
        password = "admin123"
        password_hash = hashlib.sha256((password + salt).encode()).hexdigest()
        
        cursor.execute('''
        INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
        VALUES (?, ?, ?, ?, ?, ?)
        ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
              password_hash, 'admin', 1))
        print(f"✅ Usuario admin creado. Hash: {password_hash[:20]}...")
    
    conn.commit()
    conn.close()
    print("✅ Base de datos inicializada correctamente")
Opción 2: Más fácil - Crear un script para resetear la contraseña
Crea un archivo reset_admin.py:

python
#!/usr/bin/env python3
import sqlite3
import hashlib

def reset_admin_password():
    """Resetear contraseña del admin a 'admin123'"""
    
    # Conectar a la base de datos
    conn = sqlite3.connect('instance/talento.db')
    cursor = conn.cursor()
    
    # Calcular hash
    salt = "talento_humano_2025"
    password = "admin123"
    password_hash = hashlib.sha256((password + salt).encode()).hexdigest()
    
    # Actualizar contraseña
    cursor.execute('''
    UPDATE usuarios 
    SET password_hash = ?
    WHERE username = 'admin'
    ''', (password_hash,))
    
    if cursor.rowcount > 0:
        print(f"✅ Contraseña de admin actualizada a: {password}")
        print(f"🔑 Hash generado: {password_hash}")
    else:
        print("❌ No se encontró usuario admin")
        # Crearlo si no existe
        cursor.execute('''
        INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
        VALUES (?, ?, ?, ?, ?, ?)
        ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
              password_hash, 'admin', 1))
        print("✅ Usuario admin creado")
    
    conn.commit()
    conn.close()

if __name__ == '__main__':
    reset_admin_password()
Ejecútalo:

bash
python reset_admin.py
Opción 3: La más rápida - Eliminar y recrear la base de datos
bash
# Detén el servidor Flask (Ctrl+C si está corriendo)
# Elimina la base de datos
rm instance/talento.db  # En Linux/Mac
# o
del instance\talento.db  # En Windows PowerShell

# Vuelve a ejecutar
python app.py
Esto recreará la base de datos con el hash correcto.

SI QUIERES VERIFICAR QUÉ USUARIOS HAY EN LA BASE DE DATOS:
Crea un script verificar_usuarios.py:

python
#!/usr/bin/env python3
import sqlite3

def verificar_usuarios():
    """Mostrar todos los usuarios en la base de datos"""
    
    conn = sqlite3.connect('instance/talento.db')
    conn.row_factory = sqlite3.Row  # Para acceso por nombre
    cursor = conn.cursor()
    
    print("📋 USUARIOS EN LA BASE DE DATOS:")
    print("-" * 80)
    
    cursor.execute("SELECT * FROM usuarios")
    usuarios = cursor.fetchall()
    
    if not usuarios:
        print("❌ No hay usuarios registrados")
    else:
        for usuario in usuarios:
            print(f"ID: {usuario['id']}")
            print(f"  CI: {usuario['ci']}")
            print(f"  Usuario: {usuario['username']}")
            print(f"  Email: {usuario['email']}")
            print(f"  Rol: {usuario['rol']}")
            print(f"  Activo: {'Sí' if usuario['activo'] else 'No'}")
            print(f"  Hash contraseña: {usuario['password_hash'][:30]}...")
            print(f"  Creado: {usuario['fecha_creacion']}")
            print("-" * 40)
    
    conn.close()

if __name__ == '__main__':
    verificar_usuarios()
Ejecuta:

bash
python verificar_usuarios.py
RECOMENDACIÓN:
Haz esto paso a paso:

Primero, ejecuta el script de verificación:

bash
python verificar_usuarios.py
Si no ves el admin o el hash está mal, ejecuta el reset:

bash
python reset_admin.py
Luego intenta login con:

Tipo de usuario: Administrador

CI: 0000000

Usuario: admin

Contraseña: admin123

Si sigues con problemas, elimina la base de datos y reinicia:

bash
# En Windows PowerShell:
Remove-Item instance\talento.db -ErrorAction SilentlyContinue

# Luego:
python app.py
PARA CREAR UN FUNCIONARIO DE PRUEBA DESDE EL ADMIN:
Una vez que entres como admin:

Ve a "Nuevo Funcionario"

Registra un funcionario (ej: CI: 1234567, nombres, apellidos)

El sistema te mostrará el usuario y contraseña generados

Luego podrás login como ese funcionario

¿Te funciona ahora?

ahora si, esta lindo todo, pero trabajaremos con contraseñas normales para evitarnos conflictos porfavor, ahora quisiera que sigamos haciendo el sistema, primero la parte de administrador(todo detallado), luego la parte del funcionario y finalmente la parte del jefe okey?, ahora quisiera antes de seguir con las cosas del administrador quisiera que mejoremos esa parte donde se registra nuevo funcionario(que le falta algunas partes): DATOS DE LA RESOLUCION(Nro. Resolucion, fecha resolucion, fecha posesion, numero memorandum designacion), ASIGNACION DEL ITEM(numero de item, administrador, depende de, cargo, direccion oficina, jerarquia, unidad organizacional, puesto, piso/interno), CARGAR ARCHIVOS(firma, foto, huella), DATOS GENERADOS A PARTIR DE LOS DATOS PERSONALES(usuario, clave, correo interno). no agas de nuevo el codigo solo genera lo que quieres que reemplaze y en donde y que parte del codigo ponerlo ok?
¡Perfecto! Voy a agregar las secciones faltantes al formulario de registro de funcionario. Aquí están las partes a modificar:

MODIFICACIONES A REALIZAR:
1. Primero, actualizar la tabla funcionarios en database.py:
python
# En database.py, en la función init_db(), en la creación de la tabla funcionarios:
cursor.execute('''
CREATE TABLE IF NOT EXISTS funcionarios (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    ci TEXT UNIQUE NOT NULL,
    primer_apellido TEXT NOT NULL,
    segundo_apellido TEXT,
    tercer_apellido TEXT,
    primer_nombre TEXT NOT NULL,
    segundo_nombre TEXT,
    tercer_nombre TEXT,
    tipo_identificacion TEXT DEFAULT 'CI',
    
    -- Campos básicos del sistema
    estado TEXT DEFAULT 'pendiente',
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMP,
    
    -- === NUEVOS CAMPOS SEGÚN DOCUMENTO R-100 ===
    -- Datos de resolución
    nro_resolucion TEXT,
    fecha_resolucion DATE,
    fecha_posesion DATE,
    nro_memorandum_designacion TEXT,
    fecha_memorandum DATE,
    
    -- Datos de ítem
    nro_item TEXT,
    administracion TEXT,
    jerarquia TEXT,
    depende_de TEXT,
    unidad_organizacional TEXT,
    cargo TEXT,
    puesto TEXT,
    direccion_oficina TEXT,
    piso_interno TEXT,
    
    -- Archivos (rutas)
    firma_path TEXT,
    foto_path TEXT,
    huella_path TEXT,
    
    -- Datos generados
    usuario_aplicacion TEXT,
    clave_generada TEXT,
    correo_interno TEXT
)
''')
2. Actualizar la función crear_funcionario() en database.py:
python
def crear_funcionario(self, datos):
    """Crear nuevo funcionario según formulario R-100"""
    conn = self.get_connection()
    cursor = conn.cursor()
    
    # Lista completa de campos según el documento
    campos = [
        # Datos personales
        'ci', 'primer_apellido', 'segundo_apellido', 'tercer_apellido',
        'primer_nombre', 'segundo_nombre', 'tercer_nombre', 'tipo_identificacion',
        
        # Datos de resolución
        'nro_resolucion', 'fecha_resolucion', 'fecha_posesion',
        'nro_memorandum_designacion', 'fecha_memorandum',
        
        # Datos de ítem
        'nro_item', 'administracion', 'jerarquia', 'depende_de',
        'unidad_organizacional', 'cargo', 'puesto',
        'direccion_oficina', 'piso_interno',
        
        # Archivos (solo rutas por ahora)
        'firma_path', 'foto_path', 'huella_path',
        
        # Datos generados
        'usuario_aplicacion', 'clave_generada', 'correo_interno'
    ]
    
    # Asegurar que todos los campos existan en el diccionario datos
    valores = [datos.get(campo) for campo in campos]
    
    cursor.execute(f'''
    INSERT INTO funcionarios ({', '.join(campos)})
    VALUES ({', '.join(['?'] * len(campos))})
    ''', valores)
    
    funcionario_id = cursor.lastrowid
    conn.commit()
    conn.close()
    return funcionario_id
3. Actualizar el formulario en templates/funcionario_nuevo.html:
REEMPLAZA TODO el contenido de templates/funcionario_nuevo.html con:

html
{% extends "base.html" %}

{% block title %}Nuevo Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-plus me-2"></i> Registrar Nuevo Funcionario
        </h1>
        <p class="text-muted">Complete todos los datos del funcionario según formulario R-100</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="formTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab">
                            <i class="fas fa-file-contract me-1"></i> Datos de Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignar-item" data-bs-toggle="tab">
                            <i class="fas fa-briefcase me-1"></i> Asignar Ítem
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#archivos" data-bs-toggle="tab">
                            <i class="fas fa-file-upload me-1"></i> Archivos
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('funcionario_nuevo') }}" enctype="multipart/form-data">
                    <div class="tab-content">
                        <!-- Pestaña 1: Datos Personales -->
                        <div class="tab-pane fade show active" id="datos-personales">
                            <h5 class="mb-4">Datos Personales del Funcionario</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="ci" class="form-label">Número de Identificación *</label>
                                    <input type="text" class="form-control" id="ci" name="ci" 
                                           placeholder="Ej: 1234567" maxlength="15" required>
                                    <small class="text-muted">15 caracteres máximo</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="tipo_identificacion" class="form-label">Tipo Identificación *</label>
                                    <select class="form-select" id="tipo_identificacion" name="tipo_identificacion" required>
                                        <option value="CI">Carnet de Identidad (CI)</option>
                                        <option value="PASAPORTE">Pasaporte</option>
                                        <option value="OTRO">Otro</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                                    <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" 
                                           placeholder="Primer apellido" maxlength="30" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
                                    <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" 
                                           placeholder="Segundo apellido" maxlength="30">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tercer_apellido" class="form-label">Tercer Apellido</label>
                                    <input type="text" class="form-control" id="tercer_apellido" name="tercer_apellido" 
                                           placeholder="Apellido de casada" maxlength="30">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="primer_nombre" class="form-label">Primer Nombre *</label>
                                    <input type="text" class="form-control" id="primer_nombre" name="primer_nombre" 
                                           placeholder="Primer nombre" maxlength="30" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                                    <input type="text" class="form-control" id="segundo_nombre" name="segundo_nombre" 
                                           placeholder="Segundo nombre" maxlength="30">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tercer_nombre" class="form-label">Tercer Nombre</label>
                                    <input type="text" class="form-control" id="tercer_nombre" name="tercer_nombre" 
                                           placeholder="Tercer nombre" maxlength="30">
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="nextTab('datos-resolucion')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 2: Datos de Resolución -->
                        <div class="tab-pane fade" id="datos-resolucion">
                            <h5 class="mb-4">Datos de la Resolución</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nro_resolucion" class="form-label">Número de Resolución *</label>
                                    <input type="text" class="form-control" id="nro_resolucion" name="nro_resolucion" 
                                           placeholder="Ej: RES-2025-001" maxlength="20" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_resolucion" class="form-label">Fecha de Resolución *</label>
                                    <input type="date" class="form-control" id="fecha_resolucion" name="fecha_resolucion" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_posesion" class="form-label">Fecha de Posesión *</label>
                                    <input type="date" class="form-control" id="fecha_posesion" name="fecha_posesion" required>
                                    <small class="text-muted">No mayor a la fecha actual</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nro_memorandum_designacion" class="form-label">N° Memorándum Designación</label>
                                    <input type="text" class="form-control" id="nro_memorandum_designacion" name="nro_memorandum_designacion" 
                                           placeholder="Opcional" maxlength="20">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fecha_memorandum" class="form-label">Fecha Memorándum</label>
                                    <input type="date" class="form-control" id="fecha_memorandum" name="fecha_memorandum">
                                    <small class="text-muted">No mayor a la fecha actual ni menor a fecha resolución</small>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('datos-personales')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="nextTab('asignar-item')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 3: Asignar Ítem -->
                        <div class="tab-pane fade" id="asignar-item">
                            <h5 class="mb-4">Asignación del Ítem</h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nro_item" class="form-label">Número del Ítem *</label>
                                    <input type="text" class="form-control" id="nro_item" name="nro_item" 
                                           placeholder="Ej: 278" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="administracion" class="form-label">Administración</label>
                                    <select class="form-select" id="administracion" name="administracion">
                                        <option value="">Seleccionar...</option>
                                        <option value="SISTEMA CENTRAL">Sistema Central</option>
                                        <option value="RRHH">Recursos Humanos</option>
                                        <option value="FINANZAS">Finanzas</option>
                                        <option value="SISTEMAS">Sistemas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="jerarquia" class="form-label">Jerarquía</label>
                                    <select class="form-select" id="jerarquia" name="jerarquia">
                                        <option value="">Seleccionar...</option>
                                        <option value="ALTA DIRECCIÓN">Alta Dirección</option>
                                        <option value="EJECUTIVO">Ejecutivo</option>
                                        <option value="OPERATIVO">Operativo</option>
                                        <option value="ASESORÍA">Asesoría</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="depende_de" class="form-label">Depende de</label>
                                    <input type="text" class="form-control" id="depende_de" name="depende_de" 
                                           placeholder="Jefe inmediato o departamento">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="unidad_organizacional" class="form-label">Unidad Organizacional</label>
                                    <select class="form-select" id="unidad_organizacional" name="unidad_organizacional">
                                        <option value="">Seleccionar...</option>
                                        <option value="DIRECCIÓN GENERAL">Dirección General</option>
                                        <option value="GERENCIA">Gerencia</option>
                                        <option value="DEPARTAMENTO">Departamento</option>
                                        <option value="ÁREA">Área</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cargo" class="form-label">Cargo</label>
                                    <input type="text" class="form-control" id="cargo" name="cargo" 
                                           placeholder="Ej: Analista de Sistemas">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="puesto" class="form-label">Puesto</label>
                                    <input type="text" class="form-control" id="puesto" name="puesto" 
                                           placeholder="Ej: P-045">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="direccion_oficina" class="form-label">Dirección Oficina</label>
                                    <input type="text" class="form-control" id="direccion_oficina" name="direccion_oficina" 
                                           placeholder="Edificio, oficina, etc.">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="piso_interno" class="form-label">Piso / Número Interno</label>
                                    <input type="text" class="form-control" id="piso_interno" name="piso_interno" 
                                           placeholder="Ej: 3er piso, Oficina 301">
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('datos-resolucion')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="nextTab('archivos')">
                                    Siguiente <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pestaña 4: Archivos -->
                        <div class="tab-pane fade" id="archivos">
                            <h5 class="mb-4">Cargar Archivos y Generar Credenciales</h5>
                            
                            <div class="row mb-4">
                                <div class="col-md-4 mb-3">
                                    <label for="firma" class="form-label">Firma (Imagen)</label>
                                    <input type="file" class="form-control" id="firma" name="firma" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="foto" class="form-label">Foto (Imagen)</label>
                                    <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="huella" class="form-label">Huella (Imagen)</label>
                                    <input type="file" class="form-control" id="huella" name="huella" accept="image/*">
                                    <small class="text-muted">Formato: JPG, PNG</small>
                                </div>
                            </div>
                            
                            <div class="card bg-light mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-key me-2"></i> Datos Generados Automáticamente</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Usuario Aplicación</label>
                                            <input type="text" class="form-control" id="usuario_generado" readonly
                                                   placeholder="Se generará automáticamente">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Clave Temporal</label>
                                            <input type="text" class="form-control" id="clave_generada" readonly
                                                   placeholder="Se generará automáticamente" value="CI del funcionario">
                                            <small class="text-muted">La contraseña inicial será el número de CI</small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Correo Institucional</label>
                                            <input type="text" class="form-control" id="correo_interno" readonly
                                                   placeholder="Se generará automáticamente">
                                        </div>
                                    </div>
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="fas fa-info-circle me-1"></i>
                                            Estos datos se generarán automáticamente al guardar. 
                                            El usuario se crea concatenando primer nombre y primer apellido.
                                            El correo será: usuario@gobierno.talento.bo
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" onclick="prevTab('asignar-item')">
                                    <i class="fas fa-arrow-left me-1"></i> Anterior
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Registrar Funcionario
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Navegación entre pestañas
function nextTab(nextTabId) {
    // Validar pestaña actual antes de avanzar
    const currentTab = document.querySelector('#formTabs .nav-link.active').getAttribute('href').substring(1);
    
    if (currentTab === 'datos-personales') {
        if (!validarDatosPersonales()) return;
    } else if (currentTab === 'datos-resolucion') {
        if (!validarDatosResolucion()) return;
    } else if (currentTab === 'asignar-item') {
        if (!validarAsignarItem()) return;
    }
    
    // Cambiar a siguiente pestaña
    const nextTabElement = new bootstrap.Tab(document.querySelector(`a[href="#${nextTabId}"]`));
    nextTabElement.show();
}

function prevTab(prevTabId) {
    const prevTabElement = new bootstrap.Tab(document.querySelector(`a[href="#${prevTabId}"]`));
    prevTabElement.show();
}

// Validaciones
function validarDatosPersonales() {
    const ci = document.getElementById('ci').value.trim();
    const primerApellido = document.getElementById('primer_apellido').value.trim();
    const primerNombre = document.getElementById('primer_nombre').value.trim();
    
    if (!ci || !primerApellido || !primerNombre) {
        alert('Por favor complete los campos obligatorios de Datos Personales');
        return false;
    }
    return true;
}

function validarDatosResolucion() {
    const nroResolucion = document.getElementById('nro_resolucion').value.trim();
    const fechaResolucion = document.getElementById('fecha_resolucion').value;
    const fechaPosesion = document.getElementById('fecha_posesion').value;
    
    if (!nroResolucion || !fechaResolucion || !fechaPosesion) {
        alert('Por favor complete los campos obligatorios de Datos de Resolución');
        return false;
    }
    
    // Validar que fecha posesión no sea mayor a hoy
    const hoy = new Date().toISOString().split('T')[0];
    if (fechaPosesion > hoy) {
        alert('La fecha de posesión no puede ser mayor a la fecha actual');
        return false;
    }
    
    return true;
}

function validarAsignarItem() {
    const nroItem = document.getElementById('nro_item').value.trim();
    
    if (!nroItem) {
        alert('El número de ítem es obligatorio');
        return false;
    }
    return true;
}

// Generar vista previa de usuario y correo
document.getElementById('primer_nombre').addEventListener('blur', generarUsuarioPreview);
document.getElementById('primer_apellido').addEventListener('blur', generarUsuarioPreview);

function generarUsuarioPreview() {
    const primerNombre = document.getElementById('primer_nombre').value.trim().toLowerCase();
    const primerApellido = document.getElementById('primer_apellido').value.trim().toLowerCase();
    
    if (primerNombre && primerApellido) {
        const usuario = `${primerNombre}.${primerApellido}`;
        document.getElementById('usuario_generado').value = usuario;
        document.getElementById('correo_interno').value = `${usuario}@gobierno.talento.bo`;
    }
}

// Setear fecha máxima a hoy en campos de fecha
document.addEventListener('DOMContentLoaded', function() {
    const hoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_resolucion').max = hoy;
    document.getElementById('fecha_posesion').max = hoy;
    document.getElementById('fecha_memorandum').max = hoy;
});
</script>
{% endblock %}
4. Actualizar la función funcionario_nuevo() en app.py:
python
@app.route('/admin/funcionarios/nuevo', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_nuevo():
    """Registrar nuevo funcionario - COMPLETO"""
    if request.method == 'POST':
        try:
            # Obtener todos los datos del formulario
            datos = {
                # Datos personales
                'ci': request.form.get('ci'),
                'primer_apellido': request.form.get('primer_apellido'),
                'segundo_apellido': request.form.get('segundo_apellido'),
                'tercer_apellido': request.form.get('tercer_apellido'),
                'primer_nombre': request.form.get('primer_nombre'),
                'segundo_nombre': request.form.get('segundo_nombre'),
                'tercer_nombre': request.form.get('tercer_nombre'),
                'tipo_identificacion': request.form.get('tipo_identificacion'),
                
                # Datos de resolución
                'nro_resolucion': request.form.get('nro_resolucion'),
                'fecha_resolucion': request.form.get('fecha_resolucion'),
                'fecha_posesion': request.form.get('fecha_posesion'),
                'nro_memorandum_designacion': request.form.get('nro_memorandum_designacion'),
                'fecha_memorandum': request.form.get('fecha_memorandum'),
                
                # Datos de ítem
                'nro_item': request.form.get('nro_item'),
                'administracion': request.form.get('administracion'),
                'jerarquia': request.form.get('jerarquia'),
                'depende_de': request.form.get('depende_de'),
                'unidad_organizacional': request.form.get('unidad_organizacional'),
                'cargo': request.form.get('cargo'),
                'puesto': request.form.get('puesto'),
                'direccion_oficina': request.form.get('direccion_oficina'),
                'piso_interno': request.form.get('piso_interno'),
                
                # Archivos (por ahora solo nombres)
                'firma_path': '',  # Aquí irían las rutas si subimos archivos
                'foto_path': '',
                'huella_path': '',
            }
            
            # Generar usuario y datos automáticos
            primer_nombre = datos['primer_nombre'].lower()
            primer_apellido = datos['primer_apellido'].lower()
            username_base = f"{primer_nombre}.{primer_apellido}"
            
            # Verificar si el username ya existe
            usuario_existente = db.get_usuario_by_username(username_base)
            contador = 1
            username_final = username_base
            
            while usuario_existente:
                if datos.get('segundo_apellido'):
                    inicial = datos['segundo_apellido'][0].lower()
                    username_final = f"{username_base}.{inicial}"
                else:
                    username_final = f"{username_base}{contador}"
                    contador += 1
                usuario_existente = db.get_usuario_by_username(username_final)
            
            # Agregar datos generados al diccionario
            datos['usuario_aplicacion'] = username_final
            datos['clave_generada'] = datos['ci']  # Contraseña inicial = CI
            datos['correo_interno'] = f"{username_final}@gobierno.talento.bo"
            
            # Crear funcionario
            funcionario_id = db.crear_funcionario(datos)
            
            # Crear usuario para el funcionario
            password_hash = auth.hash_password(datos['ci'])
            user_id = db.crear_usuario(
                ci=datos['ci'],
                username=username_final,
                email=datos['correo_interno'],
                password_hash=password_hash,
                rol='funcionario'
            )
            
            flash(f'✅ Funcionario registrado exitosamente!', 'success')
            flash(f'📋 Usuario: {username_final}', 'info')
            flash(f'🔑 Contraseña: {datos["ci"]} (CI del funcionario)', 'info')
            flash(f'📧 Correo: {datos["correo_interno"]}', 'info')
            
            return redirect(url_for('funcionarios_lista'))
            
        except Exception as e:
            flash(f'❌ Error al registrar funcionario: {str(e)}', 'danger')
    
    return render_template('funcionario_nuevo.html')
5. Actualizar la vista de lista para mostrar más datos:
En templates/funcionarios_lista.html, actualiza la tabla:

html
<!-- En la tabla, cambia las columnas: -->
<thead>
    <tr>
        <th>CI</th>
        <th>Nombre Completo</th>
        <th>Cargo</th>
        <th>Unidad</th>
        <th>Usuario</th>
        <th>Estado</th>
        <th>Fecha Registro</th>
        <th>Acciones</th>
    </tr>
</thead>
<tbody>
    {% for funcionario in funcionarios %}
    <tr>
        <td>{{ funcionario['ci'] }}</td>
        <td>
            {{ funcionario['primer_apellido'] }} 
            {% if funcionario['segundo_apellido'] %} {{ funcionario['segundo_apellido'] }}{% endif %}
            {{ funcionario['primer_nombre'] }}
        </td>
        <td>{{ funcionario['cargo'] or 'Sin asignar' }}</td>
        <td>{{ funcionario['unidad_organizacional'] or 'Sin asignar' }}</td>
        <td>
            {% if funcionario['usuario_aplicacion'] %}
                <span class="badge bg-info">{{ funcionario['usuario_aplicacion'] }}</span>
            {% else %}
                <span class="badge bg-secondary">No generado</span>
            {% endif %}
        </td>
        <td>
            {% if funcionario['estado'] == 'pendiente' %}
                <span class="badge bg-warning">Pendiente</span>
            {% elif funcionario['estado'] == 'activo' %}
                <span class="badge bg-success">Activo</span>
            {% else %}
                <span class="badge bg-danger">{{ funcionario['estado'] }}</span>
            {% endif %}
        </td>
        <td>{{ funcionario['fecha_registro'][:10] }}</td>
        <td>
            <a href="#" class="btn btn-sm btn-outline-primary" title="Ver">
                <i class="fas fa-eye"></i>
            </a>
            <a href="#" class="btn btn-sm btn-outline-success" title="Editar">
                <i class="fas fa-edit"></i>
            </a>
            <a href="#" class="btn btn-sm btn-outline-danger" title="Baja">
                <i class="fas fa-user-minus"></i>
            </a>
        </td>
    </tr>
    {% endfor %}
</tbody>
RESUMEN DE CAMBIOS:
Base de datos: Agregué todos los campos nuevos a la tabla funcionarios

Formulario: Convertí a pestañas con todas las secciones del documento R-100

Validaciones: JavaScript para validar cada pestaña antes de avanzar

Generación automática: Usuario, contraseña y correo se generan automáticamente

Procesamiento: La función funcionario_nuevo() ahora maneja todos los campos

NEXT STEPS:
Subida de archivos (firma, foto, huella)

Validaciones más complejas (fechas, formatos)

Edición de funcionarios

Vista detallada de funcionario

Sistema de bajas

¿Quieres que implemente la subida de archivos ahora o continuamos con otra funcionalidad?

continuaremos con otra funcionalidad, pero antes cuando queria registrar un funcionario y llene todos los campos me salio esto arriba "❌ Error al registrar funcionario: table funcionarios has no column named nro_memorandum_designacion"
El error indica que la tabla funcionarios en la base de datos no tiene la columna nro_memorandum_designacion. Esto es porque modificamos el código Python pero la base de datos SQLite ya existente no se actualizó automáticamente.

SOLUCIÓN:
Opción 1: La más fácil - Eliminar y recrear la base de datos
Detén el servidor Flask (Ctrl+C)

Elimina la base de datos existente:

bash
# En Windows PowerShell:
Remove-Item instance\talento.db -ErrorAction SilentlyContinue

# O en CMD:
# del instance\talento.db
Vuelve a ejecutar:

bash
python app.py
Esto creará una nueva base de datos con todas las columnas actualizadas.

Opción 2: Actualizar la base de datos existente
Si quieres mantener los datos existentes, podemos agregar las columnas faltantes:

Crea un archivo actualizar_db.py:

python
#!/usr/bin/env python3
import sqlite3
import sys

def actualizar_tabla_funcionarios():
    """Agregar columnas faltantes a la tabla funcionarios"""
    
    conn = sqlite3.connect('instance/talento.db')
    cursor = conn.cursor()
    
    # Lista de columnas nuevas que necesitamos agregar
    columnas_nuevas = [
        'nro_memorandum_designacion',
        'fecha_memorandum',
        'nro_item',
        'administracion',
        'jerarquia',
        'depende_de',
        'unidad_organizacional',
        'cargo',
        'puesto',
        'direccion_oficina',
        'piso_interno',
        'firma_path',
        'foto_path',
        'huella_path',
        'usuario_aplicacion',
        'clave_generada',
        'correo_interno'
    ]
    
    try:
        # Verificar qué columnas ya existen
        cursor.execute("PRAGMA table_info(funcionarios)")
        columnas_existentes = [col[1] for col in cursor.fetchall()]
        print("Columnas existentes:", columnas_existentes)
        
        # Agregar columnas faltantes
        for columna in columnas_nuevas:
            if columna not in columnas_existentes:
                if columna.endswith('_path') or columna in ['usuario_aplicacion', 'clave_generada', 'correo_interno']:
                    tipo = 'TEXT'
                elif columna.startswith('fecha_'):
                    tipo = 'DATE'
                else:
                    tipo = 'TEXT'
                
                cursor.execute(f"ALTER TABLE funcionarios ADD COLUMN {columna} {type}")
                print(f"✅ Columna agregada: {columna} ({tipo})")
            else:
                print(f"ℹ️ Columna ya existe: {columna}")
        
        conn.commit()
        print("\n🎉 Base de datos actualizada correctamente!")
        
    except sqlite3.Error as e:
        print(f"❌ Error: {e}")
        conn.rollback()
    
    finally:
        conn.close()

if __name__ == '__main__':
    print("🔄 Actualizando estructura de la base de datos...")
    actualizar_tabla_funcionarios()
Ejecútalo:

bash
python actualizar_db.py
Opción 3: Solución directa en el código
Podemos modificar app.py para que al iniciar verifique y actualice la estructura:

Agrega esto en app.py, después de crear la aplicación y antes de las rutas:

python
# En app.py, después de: app = Flask(__name__)

def verificar_estructura_db():
    """Verificar y actualizar estructura de la base de datos si es necesario"""
    try:
        conn = sqlite3.connect('instance/talento.db')
        cursor = conn.cursor()
        
        # Verificar columnas existentes
        cursor.execute("PRAGMA table_info(funcionarios)")
        columnas_existentes = [col[1] for col in cursor.fetchall()]
        
        # Columnas requeridas según el documento R-100
        columnas_requeridas = [
            'nro_memorandum_designacion', 'fecha_memorandum',
            'nro_item', 'administracion', 'jerarquia', 'depende_de',
            'unidad_organizacional', 'cargo', 'puesto', 'direccion_oficina',
            'piso_interno', 'firma_path', 'foto_path', 'huella_path',
            'usuario_aplicacion', 'clave_generada', 'correo_interno'
        ]
        
        # Agregar columnas faltantes
        for columna in columnas_requeridas:
            if columna not in columnas_existentes:
                if columna.endswith('_path') or columna in ['usuario_aplicacion', 'clave_generada', 'correo_interno']:
                    tipo = 'TEXT'
                elif columna.startswith('fecha_'):
                    tipo = 'DATE'
                else:
                    tipo = 'TEXT'
                
                cursor.execute(f"ALTER TABLE funcionarios ADD COLUMN {columna} {tipo}")
                print(f"➕ Columna agregada: {columna}")
        
        conn.commit()
        conn.close()
        print("✅ Estructura de base de datos verificada y actualizada")
        
    except Exception as e:
        print(f"⚠️ Error al verificar estructura: {e}")

# Llamar la función al iniciar
verificar_estructura_db()
Pero necesitas importar sqlite3 al inicio:

python
import os
import sqlite3  # <-- AÑADE ESTO
from flask import Flask, render_template, request, redirect, url_for, flash, session
from dotenv import load_dotenv
RECOMENDACIÓN:
Usa la Opción 1 (eliminar y recrear) si no te importa perder los datos de prueba. Es la más limpia.

Usa la Opción 2 si ya tienes datos importantes que quieres conservar.

Pasos con Opción 1:

Ctrl+C para detener Flask

del instance\talento.db

python app.py

Login con admin/admin123

Intentar registrar funcionario de nuevo

¿Qué prefieres hacer? Yo recomiendo Opción 1 para empezar limpio.

bueno me dio error en aqui de database.py:
import sqlite3
import os
from datetime import datetime

class Database:
    def __init__(self, db_path='instance/talento.db'):
        self.db_path = db_path
        self.init_db()
    
    def get_connection(self):
        """Obtener conexión a la base de datos"""
        conn = sqlite3.connect(self.db_path)
        conn.row_factory = sqlite3.Row  # Para acceso por nombre de columna
        return conn
    
    def init_db(self):
        """Inicializar base de datos con tablas necesarias"""
        # Crear directorio instance si no existe
        os.makedirs('instance', exist_ok=True)
        
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Tabla de usuarios
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS usuarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            username TEXT UNIQUE NOT NULL,
            email TEXT UNIQUE NOT NULL,
            password_hash TEXT NOT NULL,
            rol TEXT NOT NULL DEFAULT 'funcionario',
            activo INTEGER DEFAULT 1,
            fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            ultimo_acceso TIMESTAMP
        )
        ''')
        
        # Tabla de funcionarios (según documento R-100)
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS funcionarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            primer_apellido TEXT NOT NULL,
            segundo_apellido TEXT,
            tercer_apellido TEXT,
            primer_nombre TEXT NOT NULL,
            segundo_nombre TEXT,
            tercer_nombre TEXT,
            tipo_identificacion TEXT DEFAULT 'CI',
            
            -- Campos básicos del sistema
    estado TEXT DEFAULT 'pendiente',
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMP,
    
    -- === NUEVOS CAMPOS SEGÚN DOCUMENTO R-100 ===
    -- Datos de resolución
    nro_resolucion TEXT,
    fecha_resolucion DATE,
    fecha_posesion DATE,
    nro_memorandum_designacion TEXT,
    fecha_memorandum DATE,
    
    -- Datos de ítem
    nro_item TEXT,
    administracion TEXT,
    jerarquia TEXT,
    depende_de TEXT,
    unidad_organizacional TEXT,
    cargo TEXT,
    puesto TEXT,
    direccion_oficina TEXT,
    piso_interno TEXT,
    
    -- Archivos (rutas)
    firma_path TEXT,
    foto_path TEXT,
    huella_path TEXT,
    
    -- Datos generados
    usuario_aplicacion TEXT,
    clave_generada TEXT,
    correo_interno TEXT
)
''')
        
        # Tabla para documentos de respaldo
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS documentos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            funcionario_id INTEGER NOT NULL,
            tipo_documento TEXT NOT NULL,
            nombre_archivo TEXT NOT NULL,
            ruta_archivo TEXT NOT NULL,
            fecha_subida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
        )
        ''')
        
        # Insertar usuario admin por defecto
        cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
        if not cursor.fetchone():
            # Contraseña: admin123 (hasheada simple para desarrollo)
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password, rol, activo)
            VALUES (?, ?, ?, ?, ?, ?)
            ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
                  'admin123', 'admin', 1))
        
        conn.commit()
        conn.close()
        print("✅ Base de datos inicializada correctamente")
    
    # Métodos CRUD para usuarios
    def get_usuario_by_username(self, username):
        """Obtener usuario por nombre de usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE username = ? AND activo = 1", (username,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def get_usuario_by_ci(self, ci):
        """Obtener usuario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE ci = ? AND activo = 1", (ci,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def crear_usuario(self, ci, username, email, password_hash, rol='funcionario'):
        """Crear nuevo usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        try:
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol)
            VALUES (?, ?, ?, ?, ?)
            ''', (ci, username, email, password_hash, rol))
            conn.commit()
            user_id = cursor.lastrowid
            conn.close()
            return user_id
        except sqlite3.IntegrityError as e:
            conn.close()
            raise Exception(f"Error al crear usuario: {str(e)}")
    
    # Métodos CRUD para funcionarios
    def crear_funcionario(self, datos):
        """Crear nuevo funcionario según formulario R-100"""
        conn = self.get_connection()
        cursor = conn.cursor()
    
    # Lista completa de campos según el documento
        campos = [
        # Datos personales
        'ci', 'primer_apellido', 'segundo_apellido', 'tercer_apellido',
        'primer_nombre', 'segundo_nombre', 'tercer_nombre', 'tipo_identificacion',
        
        # Datos de resolución
        'nro_resolucion', 'fecha_resolucion', 'fecha_posesion',
        'nro_memorandum_designacion', 'fecha_memorandum',
        
        # Datos de ítem
        'nro_item', 'administracion', 'jerarquia', 'depende_de',
        'unidad_organizacional', 'cargo', 'puesto',
        'direccion_oficina', 'piso_interno',
        
        # Archivos (solo rutas por ahora)
        'firma_path', 'foto_path', 'huella_path',
        
        # Datos generados
        'usuario_aplicacion', 'clave_generada', 'correo_interno'
    ]
    
    # Asegurar que todos los campos existan en el diccionario datos
        valores = [datos.get(campo) for campo in campos]
    
        cursor.execute(f'''
    INSERT INTO funcionarios ({', '.join(campos)})
    VALUES ({', '.join(['?'] * len(campos))})
    ''', valores)
    
        funcionario_id = cursor.lastrowid
        conn.commit()
        conn.close()
        return funcionario_id
    
    def get_funcionario_by_ci(self, ci):
        """Obtener funcionario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios WHERE ci = ?", (ci,))
        funcionario = cursor.fetchone()
        conn.close()
        return funcionario
    
    def get_all_funcionarios(self):
        """Obtener todos los funcionarios"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios ORDER BY fecha_registro DESC")
        funcionarios = cursor.fetchall()
        conn.close()
        return funcionarios
    
    def contar_funcionarios_por_estado(self):
        """Contar funcionarios por estado"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        cursor.execute("SELECT estado, COUNT(*) as cantidad FROM funcionarios GROUP BY estado")
        resultados = cursor.fetchall()
        
        # Crear diccionario con todos los estados
        conteo = {
            'pendiente': 0,
            'activo': 0,
            'inactivo': 0,
            'baja': 0
        }
        
        for row in resultados:
            estado = row['estado']
            if estado in conteo:
                conteo[estado] = row['cantidad']
        
        conn.close()
        return conteo
    
    def actualizar_ultimo_acceso(self, user_id):
        """Actualizar último acceso del usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("UPDATE usuarios SET ultimo_acceso = CURRENT_TIMESTAMP WHERE id = ?", (user_id,))
        conn.commit()
        conn.close()


este error sale:
PS C:\xampp\htdocs\prototipo2\talento_humano> python app.py
Traceback (most recent call last):
  File "C:\xampp\htdocs\prototipo2\talento_humano\app.py", line 19, in <module>
    db = Database()
  File "C:\xampp\htdocs\prototipo2\talento_humano\database.py", line 8, in __init__
    self.init_db()
    ~~~~~~~~~~~~^^
  File "C:\xampp\htdocs\prototipo2\talento_humano\database.py", line 105, in init_db
    cursor.execute('''
    ~~~~~~~~~~~~~~^^^^
    INSERT INTO usuarios (ci, username, email, password, rol, activo)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    VALUES (?, ?, ?, ?, ?, ?)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ''', ('0000000', 'admin', 'admin@gobierno.talento.bo',
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          'admin123', 'admin', 1))
          ^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: table usuarios has no column named password
El error es porque en la tabla usuarios tienes una columna llamada password_hash, pero en el INSERT estás intentando insertar en una columna llamada password.

CORRECCIÓN EN database.py:
En la línea 105 de database.py, cambia esto:
python
# ESTÁ MAL:
cursor.execute('''
INSERT INTO usuarios (ci, username, email, password, rol, activo)
VALUES (?, ?, ?, ?, ?, ?)
''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
      'admin123', 'admin', 1))
POR ESTO (corregido):
python
# DEBE SER:
# Calcular hash de la contraseña
import hashlib
salt = "talento_humano_2025"
password = "admin123"
password_hash = hashlib.sha256((password + salt).encode()).hexdigest()

cursor.execute('''
INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
VALUES (?, ?, ?, ?, ?, ?)
''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
      password_hash, 'admin', 1))
PERO HAY UN PROBLEMA MÁS:
Necesitas importar hashlib al inicio del archivo y mover la lógica del hash a un lugar apropiado. Aquí está el database.py completo corregido:

python
import sqlite3
import os
import hashlib  # <-- AÑADE ESTO
from datetime import datetime

class Database:
    def __init__(self, db_path='instance/talento.db'):
        self.db_path = db_path
        self.init_db()
    
    def get_connection(self):
        """Obtener conexión a la base de datos"""
        conn = sqlite3.connect(self.db_path)
        conn.row_factory = sqlite3.Row  # Para acceso por nombre de columna
        return conn
    
    def hash_password(self, password):
        """Función para hashear contraseñas"""
        salt = "talento_humano_2025"
        return hashlib.sha256((password + salt).encode()).hexdigest()
    
    def init_db(self):
        """Inicializar base de datos con tablas necesarias"""
        # Crear directorio instance si no existe
        os.makedirs('instance', exist_ok=True)
        
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Tabla de usuarios
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS usuarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            username TEXT UNIQUE NOT NULL,
            email TEXT UNIQUE NOT NULL,
            password_hash TEXT NOT NULL,
            rol TEXT NOT NULL DEFAULT 'funcionario',
            activo INTEGER DEFAULT 1,
            fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            ultimo_acceso TIMESTAMP
        )
        ''')
        
        # Tabla de funcionarios (según documento R-100)
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS funcionarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ci TEXT UNIQUE NOT NULL,
            primer_apellido TEXT NOT NULL,
            segundo_apellido TEXT,
            tercer_apellido TEXT,
            primer_nombre TEXT NOT NULL,
            segundo_nombre TEXT,
            tercer_nombre TEXT,
            tipo_identificacion TEXT DEFAULT 'CI',
            
            -- Campos básicos del sistema
            estado TEXT DEFAULT 'pendiente',
            fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            fecha_actualizacion TIMESTAMP,
            
            -- === NUEVOS CAMPOS SEGÚN DOCUMENTO R-100 ===
            -- Datos de resolución
            nro_resolucion TEXT,
            fecha_resolucion DATE,
            fecha_posesion DATE,
            nro_memorandum_designacion TEXT,
            fecha_memorandum DATE,
            
            -- Datos de ítem
            nro_item TEXT,
            administracion TEXT,
            jerarquia TEXT,
            depende_de TEXT,
            unidad_organizacional TEXT,
            cargo TEXT,
            puesto TEXT,
            direccion_oficina TEXT,
            piso_interno TEXT,
            
            -- Archivos (rutas)
            firma_path TEXT,
            foto_path TEXT,
            huella_path TEXT,
            
            -- Datos generados
            usuario_aplicacion TEXT,
            clave_generada TEXT,
            correo_interno TEXT
        )
        ''')
        
        # Tabla para documentos de respaldo
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS documentos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            funcionario_id INTEGER NOT NULL,
            tipo_documento TEXT NOT NULL,
            nombre_archivo TEXT NOT NULL,
            ruta_archivo TEXT NOT NULL,
            fecha_subida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
        )
        ''')
        
        # Insertar usuario admin por defecto
        cursor.execute("SELECT * FROM usuarios WHERE username = 'admin'")
        if not cursor.fetchone():
            # Calcular hash de la contraseña
            password_hash = self.hash_password("admin123")
            
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol, activo)
            VALUES (?, ?, ?, ?, ?, ?)
            ''', ('0000000', 'admin', 'admin@gobierno.talento.bo', 
                  password_hash, 'admin', 1))
            print(f"✅ Usuario admin creado con hash: {password_hash[:20]}...")
        
        conn.commit()
        conn.close()
        print("✅ Base de datos inicializada correctamente")
    
    # Métodos CRUD para usuarios
    def get_usuario_by_username(self, username):
        """Obtener usuario por nombre de usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE username = ? AND activo = 1", (username,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def get_usuario_by_ci(self, ci):
        """Obtener usuario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM usuarios WHERE ci = ? AND activo = 1", (ci,))
        usuario = cursor.fetchone()
        conn.close()
        return usuario
    
    def crear_usuario(self, ci, username, email, password_hash, rol='funcionario'):
        """Crear nuevo usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        try:
            cursor.execute('''
            INSERT INTO usuarios (ci, username, email, password_hash, rol)
            VALUES (?, ?, ?, ?, ?)
            ''', (ci, username, email, password_hash, rol))
            conn.commit()
            user_id = cursor.lastrowid
            conn.close()
            return user_id
        except sqlite3.IntegrityError as e:
            conn.close()
            raise Exception(f"Error al crear usuario: {str(e)}")
    
    # Métodos CRUD para funcionarios
    def crear_funcionario(self, datos):
        """Crear nuevo funcionario según formulario R-100"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        # Lista completa de campos según el documento
        campos = [
            # Datos personales
            'ci', 'primer_apellido', 'segundo_apellido', 'tercer_apellido',
            'primer_nombre', 'segundo_nombre', 'tercer_nombre', 'tipo_identificacion',
            
            # Datos de resolución
            'nro_resolucion', 'fecha_resolucion', 'fecha_posesion',
            'nro_memorandum_designacion', 'fecha_memorandum',
            
            # Datos de ítem
            'nro_item', 'administracion', 'jerarquia', 'depende_de',
            'unidad_organizacional', 'cargo', 'puesto',
            'direccion_oficina', 'piso_interno',
            
            # Archivos (solo rutas por ahora)
            'firma_path', 'foto_path', 'huella_path',
            
            # Datos generados
            'usuario_aplicacion', 'clave_generada', 'correo_interno'
        ]
        
        # Asegurar que todos los campos existan en el diccionario datos
        valores = [datos.get(campo) for campo in campos]
        
        cursor.execute(f'''
        INSERT INTO funcionarios ({', '.join(campos)})
        VALUES ({', '.join(['?'] * len(campos))})
        ''', valores)
        
        funcionario_id = cursor.lastrowid
        conn.commit()
        conn.close()
        return funcionario_id
    
    def get_funcionario_by_ci(self, ci):
        """Obtener funcionario por CI"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios WHERE ci = ?", (ci,))
        funcionario = cursor.fetchone()
        conn.close()
        return funcionario
    
    def get_all_funcionarios(self):
        """Obtener todos los funcionarios"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM funcionarios ORDER BY fecha_registro DESC")
        funcionarios = cursor.fetchall()
        conn.close()
        return funcionarios
    
    def contar_funcionarios_por_estado(self):
        """Contar funcionarios por estado"""
        conn = self.get_connection()
        cursor = conn.cursor()
        
        cursor.execute("SELECT estado, COUNT(*) as cantidad FROM funcionarios GROUP BY estado")
        resultados = cursor.fetchall()
        
        # Crear diccionario con todos los estados
        conteo = {
            'pendiente': 0,
            'activo': 0,
            'inactivo': 0,
            'baja': 0
        }
        
        for row in resultados:
            estado = row['estado']
            if estado in conteo:
                conteo[estado] = row['cantidad']
        
        conn.close()
        return conteo
    
    def actualizar_ultimo_acceso(self, user_id):
        """Actualizar último acceso del usuario"""
        conn = self.get_connection()
        cursor = conn.cursor()
        cursor.execute("UPDATE usuarios SET ultimo_acceso = CURRENT_TIMESTAMP WHERE id = ?", (user_id,))
        conn.commit()
        conn.close()
PASOS PARA SOLUCIONAR:
Detén el servidor Flask (Ctrl+C)

Elimina la base de datos antigua:

bash
del instance\talento.db
Reemplaza database.py con el código corregido arriba

Vuelve a ejecutar:

bash
python app.py
CAMBIOS PRINCIPALES:
Añadí import hashlib al inicio

Añadí el método hash_password() en la clase Database

Corregí el INSERT del admin para usar password_hash en lugar de password

Usé self.hash_password() para generar el hash correcto

Ahora debería funcionar. El sistema creará:

Usuario admin: admin / admin123

Tabla funcionarios con todas las columnas nuevas

Tabla documentos para archivos

¿Probar ahora?

ok ahora si esta mejor, proseguiremos con la parte de donde se lista los funcionarios, aremos funcionar los botones de cada registro "ver, baja y editar"
¡Excelente! Vamos a implementar las funciones de Ver, Editar y Baja para los funcionarios.

PASO 1: CREAR LAS RUTAS EN app.py
Agrega estas rutas después de la función funcionario_nuevo():

python
# ==================== RUTAS PARA GESTIÓN DE FUNCIONARIOS ====================

@app.route('/admin/funcionarios/ver/<ci>')
@auth.login_required
@auth.role_required(['admin'])
def funcionario_ver(ci):
    """Ver detalles de un funcionario"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    return render_template('funcionario_ver.html', funcionario=funcionario)

@app.route('/admin/funcionarios/editar/<ci>', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_editar(ci):
    """Editar funcionario existente"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    if request.method == 'POST':
        try:
            # Actualizar los datos (simplificado por ahora)
            conn = db.get_connection()
            cursor = conn.cursor()
            
            # Datos actualizables (excluyendo CI y campos generados)
            campos_actualizables = [
                'primer_apellido', 'segundo_apellido', 'tercer_apellido',
                'primer_nombre', 'segundo_nombre', 'tercer_nombre',
                'tipo_identificacion', 'nro_resolucion', 'fecha_resolucion',
                'fecha_posesion', 'nro_memorandum_designacion', 'fecha_memorandum',
                'nro_item', 'administracion', 'jerarquia', 'depende_de',
                'unidad_organizacional', 'cargo', 'puesto', 'direccion_oficina',
                'piso_interno', 'estado'
            ]
            
            # Construir query de actualización
            set_clause = []
            valores = []
            
            for campo in campos_actualizables:
                valor = request.form.get(campo)
                if valor is not None:
                    set_clause.append(f"{campo} = ?")
                    valores.append(valor)
            
            # Agregar fecha de actualización
            set_clause.append("fecha_actualizacion = CURRENT_TIMESTAMP")
            
            # Agregar CI al final para WHERE
            valores.append(ci)
            
            query = f"UPDATE funcionarios SET {', '.join(set_clause)} WHERE ci = ?"
            cursor.execute(query, valores)
            conn.commit()
            conn.close()
            
            flash('✅ Funcionario actualizado correctamente', 'success')
            return redirect(url_for('funcionario_ver', ci=ci))
            
        except Exception as e:
            flash(f'❌ Error al actualizar funcionario: {str(e)}', 'danger')
    
    return render_template('funcionario_editar.html', funcionario=funcionario)

@app.route('/admin/funcionarios/baja/<ci>', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_baja(ci):
    """Dar de baja a un funcionario"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    if request.method == 'POST':
        try:
            motivo = request.form.get('motivo_baja')
            nro_memorandum = request.form.get('nro_memorandum_retiro')
            fecha_retiro = request.form.get('fecha_retiro')
            
            # Actualizar estado del funcionario
            conn = db.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('''
            UPDATE funcionarios 
            SET estado = 'baja', 
                fecha_actualizacion = CURRENT_TIMESTAMP
            WHERE ci = ?
            ''', (ci,))
            
            # También desactivar usuario asociado
            cursor.execute('''
            UPDATE usuarios 
            SET activo = 0 
            WHERE ci = ?
            ''', (ci,))
            
            conn.commit()
            conn.close()
            
            flash(f'✅ Funcionario {funcionario["primer_nombre"]} {funcionario["primer_apellido"]} dado de baja', 'success')
            return redirect(url_for('funcionarios_lista'))
            
        except Exception as e:
            flash(f'❌ Error al dar de baja: {str(e)}', 'danger')
    
    return render_template('funcionario_baja.html', funcionario=funcionario)

@app.route('/admin/funcionarios/activar/<ci>')
@auth.login_required
@auth.role_required(['admin'])
def funcionario_activar(ci):
    """Reactivar un funcionario dado de baja"""
    try:
        conn = db.get_connection()
        cursor = conn.cursor()
        
        cursor.execute('''
        UPDATE funcionarios 
        SET estado = 'activo', 
            fecha_actualizacion = CURRENT_TIMESTAMP
        WHERE ci = ?
        ''', (ci,))
        
        # Reactivar usuario asociado
        cursor.execute('''
        UPDATE usuarios 
        SET activo = 1 
        WHERE ci = ?
        ''', (ci,))
        
        conn.commit()
        conn.close()
        
        flash('✅ Funcionario reactivado correctamente', 'success')
        
    except Exception as e:
        flash(f'❌ Error al reactivar: {str(e)}', 'danger')
    
    return redirect(url_for('funcionarios_lista'))
PASO 2: ACTUALIZAR templates/funcionarios_lista.html
Actualiza la sección de botones de acciones:

html
<!-- En la tabla, actualiza la columna de Acciones: -->
<td>
    <!-- Botón Ver -->
    <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" 
       class="btn btn-sm btn-outline-primary" title="Ver detalles">
        <i class="fas fa-eye"></i>
    </a>
    
    <!-- Botón Editar -->
    <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" 
       class="btn btn-sm btn-outline-success" title="Editar">
        <i class="fas fa-edit"></i>
    </a>
    
    <!-- Botón Baja/Activar según estado -->
    {% if funcionario['estado'] == 'baja' %}
        <a href="{{ url_for('funcionario_activar', ci=funcionario['ci']) }}" 
           class="btn btn-sm btn-outline-warning" title="Reactivar"
           onclick="return confirm('¿Está seguro de reactivar este funcionario?')">
            <i class="fas fa-user-check"></i>
        </a>
    {% else %}
        <a href="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}" 
           class="btn btn-sm btn-outline-danger" title="Dar de baja">
            <i class="fas fa-user-minus"></i>
        </a>
    {% endif %}
</td>
PASO 3: CREAR TEMPLATE funcionario_ver.html
Crea templates/funcionario_ver.html:

html
{% extends "base.html" %}

{% block title %}Ver Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user me-2"></i> 
                    {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }} | 
                    Estado: 
                    {% if funcionario['estado'] == 'pendiente' %}
                        <span class="badge bg-warning">Pendiente</span>
                    {% elif funcionario['estado'] == 'activo' %}
                        <span class="badge bg-success">Activo</span>
                    {% elif funcionario['estado'] == 'baja' %}
                        <span class="badge bg-danger">Baja</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ funcionario['estado'] }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <a href="{{ url_for('funcionarios_lista') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
                <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Editar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <!-- Pestañas de información -->
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="infoTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab">
                            <i class="fas fa-file-contract me-1"></i> Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignacion-item" data-bs-toggle="tab">
                            <i class="fas fa-briefcase me-1"></i> Asignación
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#credenciales" data-bs-toggle="tab">
                            <i class="fas fa-key me-1"></i> Credenciales
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Pestaña 1: Datos Personales -->
                    <div class="tab-pane fade show active" id="datos-personales">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información Personal</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">CI/Número Identificación:</th>
                                        <td>{{ funcionario['ci'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Tipo Identificación:</th>
                                        <td>{{ funcionario['tipo_identificacion'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Nombre Completo:</th>
                                        <td>
                                            {{ funcionario['primer_apellido'] }} 
                                            {{ funcionario['segundo_apellido'] or '' }} 
                                            {{ funcionario['tercer_apellido'] or '' }}
                                            {{ funcionario['primer_nombre'] }}
                                            {{ funcionario['segundo_nombre'] or '' }}
                                            {{ funcionario['tercer_nombre'] or '' }}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información del Sistema</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Estado:</th>
                                        <td>
                                            {% if funcionario['estado'] == 'pendiente' %}
                                                <span class="badge bg-warning">Pendiente</span>
                                            {% elif funcionario['estado'] == 'activo' %}
                                                <span class="badge bg-success">Activo</span>
                                            {% elif funcionario['estado'] == 'baja' %}
                                                <span class="badge bg-danger">Baja</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Registro:</th>
                                        <td>{{ funcionario['fecha_registro'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Última Actualización:</th>
                                        <td>{{ funcionario['fecha_actualizacion'] or 'Sin actualizar' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 2: Datos de Resolución -->
                    <div class="tab-pane fade" id="datos-resolucion">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Resolución:</th>
                                        <td>{{ funcionario['nro_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Resolución:</th>
                                        <td>{{ funcionario['fecha_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Posesión:</th>
                                        <td>{{ funcionario['fecha_posesion'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Memorándum:</th>
                                        <td>{{ funcionario['nro_memorandum_designacion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Memorándum:</th>
                                        <td>{{ funcionario['fecha_memorandum'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 3: Asignación de Ítem -->
                    <div class="tab-pane fade" id="asignacion-item">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Ítem:</th>
                                        <td>{{ funcionario['nro_item'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Administración:</th>
                                        <td>{{ funcionario['administracion'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Jerarquía:</th>
                                        <td>{{ funcionario['jerarquia'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Depende de:</th>
                                        <td>{{ funcionario['depende_de'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Unidad Organizacional:</th>
                                        <td>{{ funcionario['unidad_organizacional'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Cargo:</th>
                                        <td>{{ funcionario['cargo'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Puesto:</th>
                                        <td>{{ funcionario['puesto'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Dirección Oficina:</th>
                                        <td>{{ funcionario['direccion_oficina'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Piso/Interno:</th>
                                        <td>{{ funcionario['piso_interno'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 4: Credenciales -->
                    <div class="tab-pane fade" id="credenciales">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-muted mb-3">Credenciales del Sistema</h6>
                                        <table class="table table-sm">
                                            <tr>
                                                <th width="40%">Usuario Aplicación:</th>
                                                <td>
                                                    {% if funcionario['usuario_aplicacion'] %}
                                                        <code>{{ funcionario['usuario_aplicacion'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Clave Temporal:</th>
                                                <td>
                                                    {% if funcionario['clave_generada'] %}
                                                        <code>{{ funcionario['clave_generada'] }}</code>
                                                        <small class="text-muted d-block">(CI del funcionario)</small>
                                                    {% else %}
                                                        <span class="text-muted">No generada</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Correo Institucional:</th>
                                                <td>
                                                    {% if funcionario['correo_interno'] %}
                                                        <code>{{ funcionario['correo_interno'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Estado Usuario:</th>
                                                <td>
                                                    {% if funcionario['estado'] == 'baja' %}
                                                        <span class="badge bg-danger">Usuario Inactivo</span>
                                                    {% else %}
                                                        <span class="badge bg-success">Usuario Activo</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-cogs me-2"></i> Acciones Disponibles</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" 
                           class="btn btn-primary w-100">
                            <i class="fas fa-edit me-1"></i> Editar Datos
                        </a>
                    </div>
                    {% if funcionario['estado'] == 'baja' %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_activar', ci=funcionario['ci']) }}" 
                           class="btn btn-success w-100"
                           onclick="return confirm('¿Está seguro de reactivar este funcionario?')">
                            <i class="fas fa-user-check me-1"></i> Reactivar
                        </a>
                    </div>
                    {% else %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}" 
                           class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-1"></i> Dar de Baja
                        </a>
                    </div>
                    {% endif %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionarios_lista') }}" 
                           class="btn btn-secondary w-100">
                            <i class="fas fa-list me-1"></i> Volver a Lista
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-info w-100" onclick="window.print()">
                            <i class="fas fa-print me-1"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
PASO 4: CREAR TEMPLATE funcionario_editar.html
Crea templates/funcionario_editar.html:

html
{% extends "base.html" %}

{% block title %}Editar Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-edit me-2"></i> 
                    Editar Funcionario: {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }}</p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                    <i class="fas fa-times me-1"></i> Cancelar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}">
                    <!-- Pestañas igual que en registro pero con datos cargados -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                            <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" 
                                   value="{{ funcionario['primer_apellido'] or '' }}" maxlength="30" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="primer_nombre" class="form-label">Primer Nombre *</label>
                            <input type="text" class="form-control" id="primer_nombre" name="primer_nombre" 
                                   value="{{ funcionario['primer_nombre'] or '' }}" maxlength="30" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
                            <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" 
                                   value="{{ funcionario['segundo_apellido'] or '' }}" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                            <input type="text" class="form-control" id="segundo_nombre" name="segundo_nombre" 
                                   value="{{ funcionario['segundo_nombre'] or '' }}" maxlength="30">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-select" id="estado" name="estado">
                                <option value="pendiente" {% if funcionario['estado'] == 'pendiente' %}selected{% endif %}>Pendiente</option>
                                <option value="activo" {% if funcionario['estado'] == 'activo' %}selected{% endif %}>Activo</option>
                                <option value="inactivo" {% if funcionario['estado'] == 'inactivo' %}selected{% endif %}>Inactivo</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nro_resolucion" class="form-label">Número de Resolución</label>
                            <input type="text" class="form-control" id="nro_resolucion" name="nro_resolucion" 
                                   value="{{ funcionario['nro_resolucion'] or '' }}" maxlength="20">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="fecha_resolucion" class="form-label">Fecha Resolución</label>
                            <input type="date" class="form-control" id="fecha_resolucion" name="fecha_resolucion" 
                                   value="{{ funcionario['fecha_resolucion'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fecha_posesion" class="form-label">Fecha Posesión</label>
                            <input type="date" class="form-control" id="fecha_posesion" name="fecha_posesion" 
                                   value="{{ funcionario['fecha_posesion'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nro_item" class="form-label">Número del Ítem</label>
                            <input type="text" class="form-control" id="nro_item" name="nro_item" 
                                   value="{{ funcionario['nro_item'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="administracion" class="form-label">Administración</label>
                            <select class="form-select" id="administracion" name="administracion">
                                <option value="">Seleccionar...</option>
                                <option value="SISTEMA CENTRAL" {% if funcionario['administracion'] == 'SISTEMA CENTRAL' %}selected{% endif %}>Sistema Central</option>
                                <option value="RRHH" {% if funcionario['administracion'] == 'RRHH' %}selected{% endif %}>Recursos Humanos</option>
                                <option value="FINANZAS" {% if funcionario['administracion'] == 'FINANZAS' %}selected{% endif %}>Finanzas</option>
                                <option value="SISTEMAS" {% if funcionario['administracion'] == 'SISTEMAS' %}selected{% endif %}>Sistemas</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="unidad_organizacional" class="form-label">Unidad Organizacional</label>
                            <select class="form-select" id="unidad_organizacional" name="unidad_organizacional">
                                <option value="">Seleccionar...</option>
                                <option value="DIRECCIÓN GENERAL" {% if funcionario['unidad_organizacional'] == 'DIRECCIÓN GENERAL' %}selected{% endif %}>Dirección General</option>
                                <option value="GERENCIA" {% if funcionario['unidad_organizacional'] == 'GERENCIA' %}selected{% endif %}>Gerencia</option>
                                <option value="DEPARTAMENTO" {% if funcionario['unidad_organizacional'] == 'DEPARTAMENTO' %}selected{% endif %}>Departamento</option>
                                <option value="ÁREA" {% if funcionario['unidad_organizacional'] == 'ÁREA' %}selected{% endif %}>Área</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cargo" class="form-label">Cargo</label>
                            <input type="text" class="form-control" id="cargo" name="cargo" 
                                   value="{{ funcionario['cargo'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="puesto" class="form-label">Puesto</label>
                            <input type="text" class="form-control" id="puesto" name="puesto" 
                                   value="{{ funcionario['puesto'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="direccion_oficina" class="form-label">Dirección Oficina</label>
                            <input type="text" class="form-control" id="direccion_oficina" name="direccion_oficina" 
                                   value="{{ funcionario['direccion_oficina'] or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="piso_interno" class="form-label">Piso / Interno</label>
                            <input type="text" class="form-control" id="piso_interno" name="piso_interno" 
                                   value="{{ funcionario['piso_interno'] or '' }}">
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
PASO 5: CREAR TEMPLATE funcionario_baja.html
Crea templates/funcionario_baja.html:

html
{% extends "base.html" %}

{% block title %}Baja de Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user-minus me-2 text-danger"></i> 
                    Dar de Baja Funcionario
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }}</p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                    <i class="fas fa-times me-1"></i> Cancelar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i> Confirmar Baja
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h6><i class="fas fa-warning me-2"></i> ¡Atención!</h6>
                    <p class="mb-0">
                        Está a punto de dar de baja al funcionario:
                        <strong>{{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}</strong>
                    </p>
                </div>
                
                <div class="mb-4">
                    <h6>Información del Funcionario:</h6>
                    <table class="table table-sm">
                        <tr>
                            <th width="40%">Nombre Completo:</th>
                            <td>{{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}</td>
                        </tr>
                        <tr>
                            <th>CI:</th>
                            <td>{{ funcionario['ci'] }}</td>
                        </tr>
                        <tr>
                            <th>Cargo:</th>
                            <td>{{ funcionario['cargo'] or 'No asignado' }}</td>
                        </tr>
                        <tr>
                            <th>Unidad:</th>
                            <td>{{ funcionario['unidad_organizacional'] or 'No asignada' }}</td>
                        </tr>
                        <tr>
                            <th>Usuario Sistema:</th>
                            <td>{{ funcionario['usuario_aplicacion'] or 'No generado' }}</td>
                        </tr>
                    </table>
                </div>
                
                <form method="POST" action="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}">
                    <div class="mb-3">
                        <label for="motivo_baja" class="form-label">Motivo de la Baja *</label>
                        <select class="form-select" id="motivo_baja" name="motivo_baja" required>
                            <option value="">Seleccionar motivo...</option>
                            <option value="RENUNCIA">Renuncia Voluntaria</option>
                            <option value="DESPIDO">Despido</option>
                            <option value="JUBILACION">Jubilación</option>
                            <option value="FIN_CONTRATO">Fin de Contrato</option>
                            <option value="OTRO">Otro</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="nro_memorandum_retiro" class="form-label">N° Memorándum de Retiro</label>
                        <input type="text" class="form-control" id="nro_memorandum_retiro" name="nro_memorandum_retiro" 
                               placeholder="Ej: MEM-RET-2025-001">
                    </div>
                    
                    <div class="mb-3">
                        <label for="fecha_retiro" class="form-label">Fecha de Retiro *</label>
                        <input type="date" class="form-control" id="fecha_retiro" name="fecha_retiro" 
                               value="{{ hoy }}" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="observaciones" class="form-label">Observaciones</label>
                        <textarea class="form-control" id="observaciones" name="observaciones" 
                                  rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('funcionario_ver', ci=funcionario['ci']) }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-danger" 
                                onclick="return confirm('¿ESTÁ SEGURO de dar de baja a este funcionario? Esta acción NO se puede deshacer fácilmente.')">
                            <i class="fas fa-user-minus me-1"></i> Confirmar Baja
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Establecer fecha actual como fecha de retiro por defecto
    const hoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_retiro').value = hoy;
    document.getElementById('fecha_retiro').max = hoy;
});
</script>
{% endblock %}
PASO 6: AGREGAR FECHA HOY AL CONTEXTO
En app.py, en la función funcionario_baja(), actualiza el render_template:

python
@app.route('/admin/funcionarios/baja/<ci>', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['admin'])
def funcionario_baja(ci):
    """Dar de baja a un funcionario"""
    funcionario = db.get_funcionario_by_ci(ci)
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('funcionarios_lista'))
    
    # Obtener fecha actual
    from datetime import datetime
    hoy = datetime.now().strftime('%Y-%m-%d')
    
    if request.method == 'POST':
        # ... (código existente) ...
    
    return render_template('funcionario_baja.html', funcionario=funcionario, hoy=hoy)
RESUMEN:
Agregamos 4 nuevas rutas: funcionario_ver, funcionario_editar, funcionario_baja, funcionario_activar

Actualizamos los botones en la lista de funcionarios

Creamos 3 templates nuevos: ver, editar y baja

Funcionalidades incluidas:

✅ Ver todos los datos del funcionario en pestañas

✅ Editar información básica y laboral

✅ Dar de baja con formulario y validación

✅ Reactivar funcionarios dados de baja

✅ Confirmaciones antes de acciones críticas

PRÓXIMOS PASOS:
Probar las nuevas funcionalidades

Agregar validaciones más robustas

Implementar búsqueda/filtros en la lista

Exportar a PDF/Excel

¿Probar ahora las nuevas funcionalidades? Primero registra un funcionario, luego prueba los botones de Ver, Editar y Baja.

podemos seguir con los siguientes pasos, como ya esta el rol de administrador, seguirrmos con los demas roles y sus funcionalidades respectivas para cada uno segun el documento que te pase, ahora con que continuamos? guiame
¡Perfecto! Sigamos con la implementación de los roles según el documento R-100. Vamos por partes:

📋 PLAN SEGÚN EL DOCUMENTO R-100:
Basándome en el PDF, los roles tienen estas funcionalidades:

1. ADMINISTRADOR (ya tenemos bastante)
✅ Registrar información básica del funcionario

✅ Generar usuario/clave automático

✅ Revisar formulario TALENTO

✅ Revisión de documentos

✅ Baja de funcionarios

❌ FALTAN: Migración de datos, Pantallas web para datos migrados

2. FUNCIONARIO (fase 1 - según página 6)
✅ Ingreso a oficina virtual (login)

❌ Registrar información personal (completar ficha)

❌ Registrar formación y conocimiento

❌ Registrar seguro social

❌ Registrar experiencia laboral y capacitación

❌ Desplegar formulario y documentos de soporte

❌ Imprimir formulario

❌ Visualizar número trámite

❌ Imprimir número trámite

3. JEFE DE DEPARTAMENTO
❌ Visualizar formulario por el Jefe

❌ Revisar documentos por el jefe

❌ Aprobar documento por el Jefe

🎯 SIGUIENTE PASO RECOMENDADO: FUNCIONARIO
Vamos a implementar que el funcionario pueda completar su ficha TALENTO según las actividades 5-12 del documento:

PRIMERO: ACTUALIZAR ESTRUCTURA DE DATOS
Necesitamos crear las tablas para almacenar toda la información que el funcionario va a completar:

Agrega esto en database.py, en la función init_db():

python
# Después de crear la tabla 'documentos', agrega:

# Tabla para datos adicionales del funcionario
cursor.execute('''
CREATE TABLE IF NOT EXISTS datos_adicionales (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    genero TEXT,
    expedido_en TEXT,
    fecha_nacimiento DATE,
    pais_nacimiento TEXT,
    depto_nacimiento TEXT,
    provincia_nacimiento TEXT,
    lugar_nacimiento TEXT,
    nro_libreta_militar TEXT,
    afp TEXT,
    nro_nua TEXT,
    tipo_sangre TEXT,
    fecha_caducidad_ci DATE,
    estado_civil TEXT,
    nro_hijos INTEGER DEFAULT 0,
    nro_dependientes INTEGER DEFAULT 0,
    direccion_domicilio TEXT,
    nro_domicilio TEXT,
    zona_domicilio TEXT,
    ciudad_localidad TEXT,
    tipo_vivienda TEXT,
    nombre_tipo_vivienda TEXT,
    piso TEXT,
    depto TEXT,
    casilla TEXT,
    correo_electronico1 TEXT,
    correo_electronico2 TEXT,
    telefono_fijo1 TEXT,
    telefono_fijo2 TEXT,
    telefono_celular1 TEXT,
    telefono_celular2 TEXT,
    nro_carrera_administrativa TEXT,
    fecha_cas DATE,
    anos_cas INTEGER,
    meses_cas INTEGER,
    dias_cas INTEGER,
    licencia_conducir TEXT,
    categoria_licencia TEXT,
    emergencia_contacto TEXT,
    nro_declaracion_jurada TEXT,
    fecha_declaracion_jurada DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para parientes
cursor.execute('''
CREATE TABLE IF NOT EXISTS parientes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    parentesco TEXT,
    primer_apellido TEXT,
    segundo_apellido TEXT,
    nombres TEXT,
    nacionalidad TEXT,
    telefono TEXT,
    genero TEXT,
    fecha_nacimiento DATE,
    tipo_identificacion TEXT,
    numero_identificacion TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para formación académica
cursor.execute('''
CREATE TABLE IF NOT EXISTS formacion_academica (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    pais_estudio TEXT,
    estado_instruccion TEXT,
    nivel_instruccion TEXT,
    area TEXT,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nombre_institucion TEXT,
    carrera TEXT,
    titulado TEXT,
    documento_respaldo TEXT,
    detalle_documento TEXT,
    fecha_inicio DATE,
    fecha_final DATE,
    nro_titulo_academico TEXT,
    fecha_emision_titulo DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para bachillerato
cursor.execute('''
CREATE TABLE IF NOT EXISTS bachillerato (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    es_bachiller TEXT,
    ano INTEGER,
    unidad_educativa TEXT,
    ultimo_curso_vencido TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para cursos
cursor.execute('''
CREATE TABLE IF NOT EXISTS cursos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    nivel_instruccion TEXT,
    area TEXT,
    nombre_curso TEXT,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nro_horas INTEGER,
    fecha_inicio DATE,
    fecha_final DATE,
    documento_respaldo TEXT,
    detalle_documento TEXT,
    pais_estudio TEXT,
    depto_estudio TEXT,
    capacitacion TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para idiomas
cursor.execute('''
CREATE TABLE IF NOT EXISTS idiomas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    idioma TEXT,
    habla TEXT,
    escribe TEXT,
    lee TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para experiencia laboral
cursor.execute('''
CREATE TABLE IF NOT EXISTS experiencia_laboral (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    entidad_empresa TEXT,
    area_departamento TEXT,
    tipo_entidad TEXT,
    puesto TEXT,
    jerarquia TEXT,
    cargo_mando TEXT,
    nro_dependientes INTEGER,
    fecha_inicio DATE,
    fecha_final DATE,
    forma_ingreso TEXT,
    causa_retiro TEXT,
    nit_empresa TEXT,
    haber_basico REAL,
    pais TEXT,
    descripcion_labores TEXT,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

# Tabla para capacitaciones impartidas
cursor.execute('''
CREATE TABLE IF NOT EXISTS capacitaciones_impartidas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    funcionario_id INTEGER NOT NULL,
    tipo_entidad_academica TEXT,
    institucion_academica TEXT,
    nombre_institucion TEXT,
    tipo_capacitacion TEXT,
    carrera TEXT,
    asignatura_tema TEXT,
    nro_horas INTEGER,
    fecha_desde DATE,
    fecha_hasta DATE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionarios(id)
)
''')

print("✅ Tablas de datos de funcionario creadas")
SEGUNDO: CREAR DASHBOARD PARA FUNCIONARIO CON PROGRESO
Actualiza templates/dashboard_funcionario.html:

html
{% extends "base.html" %}

{% block title %}Mi Panel - Funcionario{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-user-tie me-2"></i> Mi Panel - {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
        </h1>
        <p class="text-muted">Bienvenido al sistema Talento Humano</p>
    </div>
</div>

{% if funcionario and funcionario['estado'] == 'pendiente' %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i> Acción Requerida</h5>
            <p class="mb-0">
                Debe completar su ficha TALENTO dentro de los próximos <strong>5 días hábiles</strong>.
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="alert-link">Haga clic aquí para completarla</a>.
            </p>
        </div>
    </div>
</div>
{% endif %}

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i> Progreso de mi Ficha TALENTO</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" 
                         style="width: {{ progreso }}%;" aria-valuenow="{{ progreso }}" 
                         aria-valuemin="0" aria-valuemax="100">
                        {{ progreso }}% Completado
                    </div>
                </div>
                
                <div class="row text-center">
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.datos_personales else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-user fa-2x mb-2 text-{{ 'success' if secciones.datos_personales else 'secondary' }}"></i>
                                <h6>Datos Personales</h6>
                                <small class="text-{{ 'success' if secciones.datos_personales else 'secondary' }}">
                                    {% if secciones.datos_personales %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.formacion else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-graduation-cap fa-2x mb-2 text-{{ 'success' if secciones.formacion else 'secondary' }}"></i>
                                <h6>Formación Académica</h6>
                                <small class="text-{{ 'success' if secciones.formacion else 'secondary' }}">
                                    {% if secciones.formacion %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.seguro_social else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-heartbeat fa-2x mb-2 text-{{ 'success' if secciones.seguro_social else 'secondary' }}"></i>
                                <h6>Seguro Social</h6>
                                <small class="text-{{ 'success' if secciones.seguro_social else 'secondary' }}">
                                    {% if secciones.seguro_social %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-2">
                        <div class="card border-{{ 'success' if secciones.experiencia else 'secondary' }}">
                            <div class="card-body py-2">
                                <i class="fas fa-briefcase fa-2x mb-2 text-{{ 'success' if secciones.experiencia else 'secondary' }}"></i>
                                <h6>Experiencia Laboral</h6>
                                <small class="text-{{ 'success' if secciones.experiencia else 'secondary' }}">
                                    {% if secciones.experiencia %}✅ Completado{% else %}❌ Pendiente{% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-primary text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-id-card fa-3x"></i>
                </div>
                <h5>Completar Ficha TALENTO</h5>
                <p class="text-muted">Complete todos los datos requeridos</p>
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Continuar Ficha
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-success text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-file-upload fa-3x"></i>
                </div>
                <h5>Documentos de Soporte</h5>
                <p class="text-muted">Suba los documentos requeridos</p>
                <a href="{{ url_for('funcionario_documentos') }}" class="btn btn-success">
                    <i class="fas fa-upload me-1"></i> Subir Documentos
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="bg-info text-white rounded-circle p-4 d-inline-block mb-3">
                    <i class="fas fa-history fa-3x"></i>
                </div>
                <h5>Estado de mi Trámite</h5>
                <p class="text-muted">Revise el estado de su registro</p>
                <a href="{{ url_for('funcionario_tramite') }}" class="btn btn-info">
                    <i class="fas fa-search me-1"></i> Ver Estado
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i> Información Importante</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>Tiene <strong>5 días hábiles</strong> para completar su ficha TALENTO.</li>
                    <li>Los documentos deben ser escaneados en formato PDF o imagen.</li>
                    <li>Para consultas, contacte al departamento de Recursos Humanos.</li>
                    <li>Guarde su número de trámite una vez generado.</li>
                    <li>Puede guardar su progreso y continuar después.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
TERCERO: CREAR RUTAS PARA FUNCIONARIO EN app.py
Agrega estas rutas después de las rutas del admin:

python
# ==================== RUTAS PARA FUNCIONARIO ====================

@app.route('/funcionario/completar-ficha')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_completar_ficha():
    """Página principal para completar la ficha TALENTO"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    # Calcular progreso (simulado por ahora)
    progreso = 25
    secciones = {
        'datos_personales': False,
        'formacion': False,
        'seguro_social': False,
        'experiencia': False
    }
    
    return render_template('funcionario/completar_ficha.html', 
                         funcionario=funcionario,
                         progreso=progreso,
                         secciones=secciones)

@app.route('/funcionario/datos-personales', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_datos_personales():
    """Funcionario completa sus datos personales (Actividad 5)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        # Aquí procesaríamos los datos del formulario
        flash('Datos personales guardados correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/datos_personales.html', funcionario=funcionario)

@app.route('/funcionario/formacion-academica', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_formacion_academica():
    """Funcionario completa formación académica (Actividad 6)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Formación académica guardada correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/formacion_academica.html', funcionario=funcionario)

@app.route('/funcionario/seguro-social', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_seguro_social():
    """Funcionario completa seguro social (Actividad 7)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Seguro social guardado correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/seguro_social.html', funcionario=funcionario)

@app.route('/funcionario/experiencia-laboral', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_experiencia_laboral():
    """Funcionario completa experiencia laboral (Actividad 8)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if request.method == 'POST':
        flash('Experiencia laboral guardada correctamente', 'success')
        return redirect(url_for('funcionario_completar_ficha'))
    
    return render_template('funcionario/experiencia_laboral.html', funcionario=funcionario)

@app.route('/funcionario/documentos')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_documentos():
    """Funcionario sube documentos de soporte"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/documentos.html', funcionario=funcionario)

@app.route('/funcionario/revisar-formulario')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_revisar_formulario():
    """Funcionario revisa formulario completo (Actividad 9)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/revisar_formulario.html', funcionario=funcionario)

@app.route('/funcionario/imprimir-formulario')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_imprimir_formulario():
    """Funcionario imprime formulario (Actividad 10)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    return render_template('funcionario/imprimir_formulario.html', funcionario=funcionario)

@app.route('/funcionario/ver-tramite')
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_tramite():
    """Funcionario ve número de trámite (Actividad 11)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    # Generar número de trámite ficticio
    import random
    nro_tramite = f"TAL-{random.randint(1000, 9999)}-2025"
    
    return render_template('funcionario/ver_tramite.html', 
                         funcionario=funcionario,
                         nro_tramite=nro_tramite)

# Actualizar el dashboard del funcionario para pasar datos de progreso
@app.route('/funcionario/dashboard')
@auth.login_required
@auth.role_required(['funcionario'])
def dashboard_funcionario():
    """Dashboard para funcionarios"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    # Calcular progreso (simulado por ahora)
    progreso = 25
    secciones = {
        'datos_personales': False,
        'formacion': False,
        'seguro_social': False,
        'experiencia': False
    }
    
    return render_template('dashboard_funcionario.html', 
                         funcionario=funcionario,
                         progreso=progreso,
                         secciones=secciones)
CUARTO: CREAR TEMPLATES PARA FUNCIONARIO
Crea esta estructura de carpetas:

text
templates/funcionario/
├── completar_ficha.html
├── datos_personales.html
├── formacion_academica.html
├── seguro_social.html
├── experiencia_laboral.html
├── documentos.html
├── revisar_formulario.html
├── imprimir_formulario.html
└── ver_tramite.html
1. templates/funcionario/completar_ficha.html:
html
{% extends "base.html" %}

{% block title %}Completar Ficha TALENTO{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0">
            <i class="fas fa-id-card me-2"></i> Completar Ficha TALENTO
        </h1>
        <p class="text-muted">Complete todas las secciones requeridas de su ficha</p>
    </div>
</div>

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" 
                         style="width: {{ progreso }}%;" aria-valuenow="{{ progreso }}" 
                         aria-valuemin="0" aria-valuemax="100">
                        {{ progreso }}% Completado
                    </div>
                </div>
                <p class="mb-0 text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Complete todas las secciones marcadas como obligatorias. Puede guardar y continuar después.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Tarjetas de secciones -->
<div class="row">
    <!-- Sección 1: Datos Personales -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.datos_personales else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.datos_personales else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-user fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">1. Datos Personales</h5>
                        <p class="text-muted mb-0">Información personal y de contacto</p>
                    </div>
                </div>
                <p>Complete sus datos personales, información adicional y parientes.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.datos_personales else 'warning' }}">
                        {% if secciones.datos_personales %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_datos_personales') }}" 
                       class="btn btn-{{ 'success' if secciones.datos_personales else 'primary' }} btn-sm">
                        {% if secciones.datos_personales %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 2: Formación Académica -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.formacion else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.formacion else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-graduation-cap fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">2. Formación Académica</h5>
                        <p class="text-muted mb-0">Estudios, cursos, idiomas</p>
                    </div>
                </div>
                <p>Registre su formación: bachillerato, estudios superiores, cursos e idiomas.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.formacion else 'warning' }}">
                        {% if secciones.formacion %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_formacion_academica') }}" 
                       class="btn btn-{{ 'success' if secciones.formacion else 'primary' }} btn-sm">
                        {% if secciones.formacion %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 3: Seguro Social -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.seguro_social else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.seguro_social else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-heartbeat fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">3. Seguro Social</h5>
                        <p class="text-muted mb-0">Afiliación a caja de salud</p>
                    </div>
                </div>
                <p>Registre su información de afiliación al seguro médico.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.seguro_social else 'warning' }}">
                        {% if secciones.seguro_social %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_seguro_social') }}" 
                       class="btn btn-{{ 'success' if secciones.seguro_social else 'primary' }} btn-sm">
                        {% if secciones.seguro_social %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sección 4: Experiencia Laboral -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 {{ 'border-success' if secciones.experiencia else 'border-primary' }}">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-{{ 'success' if secciones.experiencia else 'primary' }} text-white rounded-circle p-3 me-3">
                        <i class="fas fa-briefcase fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">4. Experiencia Laboral</h5>
                        <p class="text-muted mb-0">Historial laboral y capacitaciones</p>
                    </div>
                </div>
                <p>Registre su experiencia laboral previa y capacitaciones impartidas.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-{{ 'success' if secciones.experiencia else 'warning' }}">
                        {% if secciones.experiencia %}✅ Completado{% else %}⚠️ Pendiente{% endif %}
                    </span>
                    <a href="{{ url_for('funcionario_experiencia_laboral') }}" 
                       class="btn btn-{{ 'success' if secciones.experiencia else 'primary' }} btn-sm">
                        {% if secciones.experiencia %}
                            <i class="fas fa-edit me-1"></i> Editar
                        {% else %}
                            <i class="fas fa-play me-1"></i> Comenzar
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-forward me-2"></i> Próximos Pasos</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                                <h6>Revisar Formulario</h6>
                                <p class="small text-muted">Revise todos los datos antes de enviar</p>
                                <a href="{{ url_for('funcionario_revisar_formulario') }}" 
                                   class="btn btn-outline-primary btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-print fa-2x text-success mb-2"></i>
                                <h6>Imprimir Formulario</h6>
                                <p class="small text-muted">Genere PDF para presentación</p>
                                <a href="{{ url_for('funcionario_imprimir_formulario') }}" 
                                   class="btn btn-outline-success btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-file-contract fa-2x text-info mb-2"></i>
                                <h6>Ver N° Trámite</h6>
                                <p class="small text-muted">Obtenga su número de trámite</p>
                                <a href="{{ url_for('funcionario_tramite') }}" 
                                   class="btn btn-outline-info btn-sm" disabled>
                                    Próximamente
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6><i class="fas fa-clock me-2"></i> Plazo de Completado</h6>
            <p class="mb-0">
                Recuerde que tiene <strong>5 días hábiles</strong> para completar toda su ficha TALENTO.
                Puede guardar su progreso en cualquier momento y continuar después.
            </p>
        </div>
    </div>
</div>
{% endblock %}
QUINTO: ACTUALIZAR dashboard_funcionario EN app.py
Necesitamos actualizar la función para calcular progreso real:

python
# Agrega este método en database.py para calcular progreso
def calcular_progreso_funcionario(self, funcionario_id):
    """Calcular progreso de completado de ficha TALENTO"""
    conn = self.get_connection()
    cursor = conn.cursor()
    
    # Verificar qué tablas tienen datos
    secciones = {
        'datos_personales': False,
        'formacion': False,
        'seguro_social': False,
        'experiencia': False
    }
    
    # Verificar datos personales
    cursor.execute("SELECT COUNT(*) FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
    if cursor.fetchone()[0] > 0:
        secciones['datos_personales'] = True
    
    # Verificar formación académica
    cursor.execute("SELECT COUNT(*) FROM formacion_academica WHERE funcionario_id = ?", (funcionario_id,))
    if cursor.fetchone()[0] > 0:
        secciones['formacion'] = True
    
    # Verificar seguro social
    # Nota: Necesitaríamos una tabla específica o campo en funcionarios
    
    # Verificar experiencia laboral
    cursor.execute("SELECT COUNT(*) FROM experiencia_laboral WHERE funcionario_id = ?", (funcionario_id,))
    if cursor.fetchone()[0] > 0:
        secciones['experiencia'] = True
    
    conn.close()
    
    # Calcular porcentaje
    completadas = sum(1 for sec in secciones.values() if sec)
    total = len(secciones)
    progreso = int((completadas / total) * 100) if total > 0 else 0
    
    return progreso, secciones

# Luego actualiza el dashboard del funcionario:
@app.route('/funcionario/dashboard')
@auth.login_required
@auth.role_required(['funcionario'])
def dashboard_funcionario():
    """Dashboard para funcionarios"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('logout'))
    
    # Calcular progreso real
    progreso, secciones = db.calcular_progreso_funcionario(funcionario['id'])
    
    return render_template('dashboard_funcionario.html', 
                         funcionario=funcionario,
                         progreso=progreso,
                         secciones=secciones)
🎯 ¿QUÉ SIGUE?
Te propongo este orden de implementación:

Primero: Implementar el formulario de Datos Personales (Actividad 5)

Luego: Formación Académica (Actividad 6)

Después: Seguro Social (Actividad 7)

Luego: Experiencia Laboral (Actividad 8)

Finalmente: Revisión, impresión y trámite (Actividades 9-12)

¿Quieres que implementemos primero el formulario de Datos Personales del funcionario? Sería la sección más compleja pero fundamental, con todos los campos del documento R-100 (páginas 10-12).

¿O prefieres algo más simple primero? Podríamos empezar con Seguro Social que es más sencillo.

claro seguire el orden de tus implementaciones como tu me guies asi para no fallar ni olvidar cosas al sistema
¡Excelente! Vamos paso a paso. Comenzaremos con la implementación más importante y compleja: el formulario de Datos Personales del Funcionario (Actividad 5 del documento R-100).

🎯 PASO 1: FORMULARIO DE DATOS PERSONALES DEL FUNCIONARIO
1. Primero, necesitamos tablas de parámetros (catálogos)
Agrega en database.py, después de las otras tablas:

python
# Tablas de parámetros (catálogos)
cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_genero (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_departamentos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_paises (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_estado_civil (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_tipo_sangre (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_gestora (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_parentesco (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS parametros_nacionalidad (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo TEXT UNIQUE NOT NULL,
    nombre TEXT NOT NULL,
    activo INTEGER DEFAULT 1
)
''')

# Insertar datos básicos en parámetros
parametros_basicos = {
    'genero': [
        ('M', 'MASCULINO'),
        ('F', 'FEMENINO')
    ],
    'departamentos': [
        ('LP', 'LA PAZ'),
        ('CB', 'COCHABAMBA'),
        ('SC', 'SANTA CRUZ'),
        ('OR', 'ORURO'),
        ('PT', 'POTOSÍ'),
        ('TJ', 'TARIJA'),
        ('CH', 'CHUQUISACA'),
        ('BN', 'BENI'),
        ('PD', 'PANDO')
    ],
    'paises': [
        ('BOL', 'BOLIVIA'),
        ('ARG', 'ARGENTINA'),
        ('BRA', 'BRASIL'),
        ('CHL', 'CHILE'),
        ('PER', 'PERÚ')
    ],
    'estado_civil': [
        ('S', 'SOLTERO(A)'),
        ('C', 'CASADO(A)'),
        ('D', 'DIVORCIADO(A)'),
        ('V', 'VIUDO(A)'),
        ('U', 'UNIÓN LIBRE')
    ],
    'tipo_sangre': [
        ('A+', 'A+'),
        ('A-', 'A-'),
        ('B+', 'B+'),
        ('B-', 'B-'),
        ('AB+', 'AB+'),
        ('AB-', 'AB-'),
        ('O+', 'O+'),
        ('O-', 'O-')
    ],
    'gestora': [
        ('CSS', 'CAJA DE SALUD DE SEGUROS SOCIALES'),
        ('CPS', 'CAJA PETROLERA DE SALUD'),
        ('CNS', 'CAJA NACIONAL DE SALUD'),
        ('CSM', 'CAJA DE SALUD DE LA MUJER'),
        ('CSR', 'CAJA DE SALUD RURAL')
    ],
    'parentesco': [
        ('PAD', 'PADRE'),
        ('MAD', 'MADRE'),
        ('CON', 'CÓNYUGUE'),
        ('HIJ', 'HIJO(A)'),
        ('HER', 'HERMANO(A)'),
        ('OTR', 'OTRO')
    ],
    'nacionalidad': [
        ('BOL', 'BOLIVIANA'),
        ('ARG', 'ARGENTINA'),
        ('BRA', 'BRASILEÑA'),
        ('CHL', 'CHILENA'),
        ('PER', 'PERUANA'),
        ('OTR', 'OTRA')
    ]
}

for tabla, datos in parametros_basicos.items():
    cursor.execute(f"SELECT COUNT(*) FROM parametros_{tabla}")
    if cursor.fetchone()[0] == 0:
        for codigo, nombre in datos:
            cursor.execute(f"INSERT INTO parametros_{tabla} (codigo, nombre) VALUES (?, ?)", (codigo, nombre))
        print(f"✅ Datos insertados en: parametros_{tabla}")

conn.commit()
conn.close()
print("✅ Tablas de parámetros creadas e inicializadas")
2. Métodos para obtener parámetros en database.py:
Agrega estos métodos en la clase Database:

python
def get_parametros(self, tipo):
    """Obtener lista de parámetros por tipo"""
    conn = self.get_connection()
    cursor = conn.cursor()
    
    tablas_validas = ['genero', 'departamentos', 'paises', 'estado_civil', 
                     'tipo_sangre', 'gestora', 'parentesco', 'nacionalidad']
    
    if tipo not in tablas_validas:
        conn.close()
        return []
    
    cursor.execute(f"SELECT codigo, nombre FROM parametros_{tipo} WHERE activo = 1 ORDER BY nombre")
    resultados = cursor.fetchall()
    conn.close()
    
    return [dict(row) for row in resultados]

def get_datos_adicionales(self, funcionario_id):
    """Obtener datos adicionales del funcionario"""
    conn = self.get_connection()
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
    datos = cursor.fetchone()
    conn.close()
    return datos

def get_parientes(self, funcionario_id):
    """Obtener parientes del funcionario"""
    conn = self.get_connection()
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM parientes WHERE funcionario_id = ? ORDER BY parentesco", (funcionario_id,))
    parientes = cursor.fetchall()
    conn.close()
    return [dict(p) for p in parientes]

def guardar_datos_adicionales(self, funcionario_id, datos):
    """Guardar o actualizar datos adicionales"""
    conn = self.get_connection()
    cursor = conn.cursor()
    
    # Verificar si ya existen datos
    cursor.execute("SELECT id FROM datos_adicionales WHERE funcionario_id = ?", (funcionario_id,))
    existe = cursor.fetchone()
    
    if existe:
        # Actualizar
        campos = []
        valores = []
        for campo, valor in datos.items():
            if valor is not None:
                campos.append(f"{campo} = ?")
                valores.append(valor)
        
        valores.append(funcionario_id)
        query = f"UPDATE datos_adicionales SET {', '.join(campos)} WHERE funcionario_id = ?"
        cursor.execute(query, valores)
    else:
        # Insertar
        campos = ['funcionario_id'] + list(datos.keys())
        placeholders = ['?'] * len(campos)
        valores = [funcionario_id] + list(datos.values())
        
        query = f"INSERT INTO datos_adicionales ({', '.join(campos)}) VALUES ({', '.join(placeholders)})"
        cursor.execute(query, valores)
    
    conn.commit()
    conn.close()
    return True

def guardar_pariente(self, funcionario_id, datos_pariente):
    """Guardar un pariente"""
    conn = self.get_connection()
    cursor = conn.cursor()
    
    campos = ['funcionario_id'] + list(datos_pariente.keys())
    placeholders = ['?'] * len(campos)
    valores = [funcionario_id] + list(datos_pariente.values())
    
    query = f"INSERT INTO parientes ({', '.join(campos)}) VALUES ({', '.join(placeholders)})"
    cursor.execute(query, valores)
    
    pariente_id = cursor.lastrowid
    conn.commit()
    conn.close()
    return pariente_id

def eliminar_pariente(self, pariente_id):
    """Eliminar un pariente"""
    conn = self.get_connection()
    cursor = conn.cursor()
    cursor.execute("DELETE FROM parientes WHERE id = ?", (pariente_id,))
    conn.commit()
    conn.close()
    return True
3. Crear el template de datos personales:
Crea templates/funcionario/datos_personales.html:

html
{% extends "base.html" %}

{% block title %}Datos Personales - Completar Ficha TALENTO{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        border-left: 4px solid #0d6efd;
    }
    
    .form-section h5 {
        color: #0d6efd;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .campo-obligatorio::after {
        content: " *";
        color: #dc3545;
    }
    
    .pariente-item {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
    }
    
    .pariente-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user me-2"></i> Datos Personales
                </h1>
                <p class="text-muted">
                    Sección 1: Complete sus datos personales, adicionales y de parientes
                    {% if funcionario %}
                    <span class="badge bg-primary ms-2">CI: {{ funcionario['ci'] }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Indicador de progreso -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <div class="bg-primary text-white rounded-circle p-3">
                            <i class="fas fa-user fa-2x"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Datos Personales (Actividad 5)</h5>
                        <p class="text-muted mb-0">
                            Complete todos los campos obligatorios marcados con (*). 
                            Esta información es esencial para su registro en el sistema.
                        </p>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary fs-6">Paso 1/4</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="POST" action="{{ url_for('funcionario_datos_personales') }}" id="formDatosPersonales">
    <!-- SECCIÓN A: Datos Personales (no editables - vienen del admin) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-id-card me-2"></i> A. Datos Personales (Información Administrativa)</h5>
                <p class="text-muted mb-3"><em>Estos datos fueron registrados por el administrador y no son editables.</em></p>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Primer Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['primer_apellido'] }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Segundo Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['segundo_apellido'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tercer Apellido</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tercer_apellido'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Primer Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['primer_nombre'] }}" readonly>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Segundo Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['segundo_nombre'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tercer Nombre</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tercer_nombre'] or '' }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Tipo Identificación</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['tipo_identificacion'] }}" readonly>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Número Identificación</label>
                        <input type="text" class="form-control bg-light" value="{{ funcionario['ci'] }}" readonly>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN B: Datos Personales a Completar -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-user-edit me-2"></i> B. Datos Personales a Completar</h5>
                <p class="text-muted mb-3">Complete los siguientes campos según su tipo de identificación.</p>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="genero" class="form-label campo-obligatorio">Género</label>
                        <select class="form-select" id="genero" name="genero" required>
                            <option value="">Seleccionar...</option>
                            {% for genero in parametros.genero %}
                            <option value="{{ genero.codigo }}" {% if datos_adicionales and datos_adicionales.genero == genero.codigo %}selected{% endif %}>
                                {{ genero.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="expedido_en" class="form-label campo-obligatorio">Expedido en</label>
                        <select class="form-select" id="expedido_en" name="expedido_en" required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.expedido_en == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="fecha_nacimiento" class="form-label campo-obligatorio">Fecha de Nacimiento</label>
                        <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" 
                               value="{{ datos_adicionales.fecha_nacimiento if datos_adicionales else '' }}" 
                               max="{{ fecha_max_nacimiento }}" required>
                        <small class="text-muted">Debe ser mayor a 18 años</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="pais_nacimiento" class="form-label campo-obligatorio">País de Nacimiento</label>
                        <select class="form-select" id="pais_nacimiento" name="pais_nacimiento" required>
                            <option value="">Seleccionar...</option>
                            {% for pais in parametros.paises %}
                            <option value="{{ pais.codigo }}" {% if datos_adicionales and datos_adicionales.pais_nacimiento == pais.codigo %}selected{% endif %}>
                                {{ pais.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="depto_nacimiento" class="form-label campo-obligatorio">Departamento de Nacimiento</label>
                        <select class="form-select" id="depto_nacimiento" name="depto_nacimiento" 
                                {% if datos_adicionales and datos_adicionales.pais_nacimiento != 'BOL' %}disabled{% endif %} required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.depto_nacimiento == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="provincia_nacimiento" class="form-label">Provincia de Nacimiento</label>
                        <input type="text" class="form-control" id="provincia_nacimiento" name="provincia_nacimiento" 
                               value="{{ datos_adicionales.provincia_nacimiento if datos_adicionales else '' }}"
                               {% if datos_adicionales and datos_adicionales.pais_nacimiento != 'BOL' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="lugar_nacimiento" class="form-label">Lugar de Nacimiento</label>
                        <input type="text" class="form-control" id="lugar_nacimiento" name="lugar_nacimiento" 
                               value="{{ datos_adicionales.lugar_nacimiento if datos_adicionales else '' }}" 
                               maxlength="100">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_libreta_militar" class="form-label">N° Libreta Servicio Militar</label>
                        <input type="text" class="form-control" id="nro_libreta_militar" name="nro_libreta_militar" 
                               value="{{ datos_adicionales.nro_libreta_militar if datos_adicionales else '' }}" 
                               maxlength="15">
                        <small class="text-muted">Obligatorio para varones</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="gestora" class="form-label">Gestora (AFP)</label>
                        <select class="form-select" id="gestora" name="gestora">
                            <option value="">Seleccionar...</option>
                            {% for gestora in parametros.gestora %}
                            <option value="{{ gestora.codigo }}" {% if datos_adicionales and datos_adicionales.gestora == gestora.codigo %}selected{% endif %}>
                                {{ gestora.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_nua" class="form-label">N° NUA</label>
                        <input type="number" class="form-control" id="nro_nua" name="nro_nua" 
                               value="{{ datos_adicionales.nro_nua if datos_adicionales else '' }}"
                               {% if not datos_adicionales or not datos_adicionales.gestora %}disabled{% endif %}>
                        <small class="text-muted">Obligatorio si selecciona Gestora</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="tipo_sangre" class="form-label campo-obligatorio">Tipo de Sangre</label>
                        <select class="form-select" id="tipo_sangre" name="tipo_sangre" required>
                            <option value="">Seleccionar...</option>
                            {% for sangre in parametros.tipo_sangre %}
                            <option value="{{ sangre.codigo }}" {% if datos_adicionales and datos_adicionales.tipo_sangre == sangre.codigo %}selected{% endif %}>
                                {{ sangre.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN C: Datos Adicionales -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-home me-2"></i> C. Datos Adicionales</h5>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="fecha_caducidad_ci" class="form-label campo-obligatorio">Fecha Caducidad CI</label>
                        <input type="date" class="form-control" id="fecha_caducidad_ci" name="fecha_caducidad_ci" 
                               value="{{ datos_adicionales.fecha_caducidad_ci if datos_adicionales else '' }}" required>
                        <small class="text-muted">Debe ser mayor a hoy</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="estado_civil" class="form-label campo-obligatorio">Estado Civil</label>
                        <select class="form-select" id="estado_civil" name="estado_civil" required>
                            <option value="">Seleccionar...</option>
                            {% for ec in parametros.estado_civil %}
                            <option value="{{ ec.codigo }}" {% if datos_adicionales and datos_adicionales.estado_civil == ec.codigo %}selected{% endif %}>
                                {{ ec.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_hijos" class="form-label">N° de Hijos</label>
                        <input type="number" class="form-control" id="nro_hijos" name="nro_hijos" 
                               value="{{ datos_adicionales.nro_hijos if datos_adicionales else 0 }}" min="0" max="99">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_dependientes" class="form-label">N° Dependientes</label>
                        <input type="number" class="form-control" id="nro_dependientes" name="nro_dependientes" 
                               value="{{ datos_adicionales.nro_dependientes if datos_adicionales else 0 }}" min="0" max="99">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="direccion_domicilio" class="form-label campo-obligatorio">Dirección Domicilio</label>
                        <input type="text" class="form-control" id="direccion_domicilio" name="direccion_domicilio" 
                               value="{{ datos_adicionales.direccion_domicilio if datos_adicionales else '' }}" 
                               maxlength="300" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_domicilio" class="form-label campo-obligatorio">N° Domicilio</label>
                        <input type="text" class="form-control" id="nro_domicilio" name="nro_domicilio" 
                               value="{{ datos_adicionales.nro_domicilio if datos_adicionales else '' }}" 
                               maxlength="10" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="zona_domicilio" class="form-label campo-obligatorio">Zona Domicilio</label>
                        <input type="text" class="form-control" id="zona_domicilio" name="zona_domicilio" 
                               value="{{ datos_adicionales.zona_domicilio if datos_adicionales else '' }}" 
                               maxlength="50" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="ciudad_localidad" class="form-label campo-obligatorio">Ciudad / Localidad</label>
                        <select class="form-select" id="ciudad_localidad" name="ciudad_localidad" required>
                            <option value="">Seleccionar...</option>
                            {% for depto in parametros.departamentos %}
                            <option value="{{ depto.codigo }}" {% if datos_adicionales and datos_adicionales.ciudad_localidad == depto.codigo %}selected{% endif %}>
                                {{ depto.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="tipo_vivienda" class="form-label">Tipo Vivienda</label>
                        <select class="form-select" id="tipo_vivienda" name="tipo_vivienda">
                            <option value="">Seleccionar...</option>
                            <option value="CASA" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'CASA' %}selected{% endif %}>Casa</option>
                            <option value="DEPARTAMENTO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'DEPARTAMENTO' %}selected{% endif %}>Departamento</option>
                            <option value="EDIFICIO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'EDIFICIO' %}selected{% endif %}>Edificio</option>
                            <option value="OTRO" {% if datos_adicionales and datos_adicionales.tipo_vivienda == 'OTRO' %}selected{% endif %}>Otro</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nombre_tipo_vivienda" class="form-label">Nombre Tipo Vivienda</label>
                        <input type="text" class="form-control" id="nombre_tipo_vivienda" name="nombre_tipo_vivienda" 
                               value="{{ datos_adicionales.nombre_tipo_vivienda if datos_adicionales else '' }}" 
                               maxlength="75" 
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                        <small class="text-muted">Obligatorio si tipo es EDIFICIO</small>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="piso" class="form-label">Piso</label>
                        <input type="text" class="form-control" id="piso" name="piso" 
                               value="{{ datos_adicionales.piso if datos_adicionales else '' }}" 
                               maxlength="15"
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="depto" class="form-label">Depto</label>
                        <input type="text" class="form-control" id="depto" name="depto" 
                               value="{{ datos_adicionales.depto if datos_adicionales else '' }}" 
                               maxlength="10"
                               {% if not datos_adicionales or datos_adicionales.tipo_vivienda != 'EDIFICIO' %}disabled{% endif %}>
                    </div>
                    
                    <div class="col-md-1 mb-3">
                        <label for="casilla" class="form-label">Casilla</label>
                        <input type="text" class="form-control" id="casilla" name="casilla" 
                               value="{{ datos_adicionales.casilla if datos_adicionales else '' }}" 
                               maxlength="8">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="correo_electronico1" class="form-label campo-obligatorio">Correo Electrónico 1</label>
                        <input type="email" class="form-control" id="correo_electronico1" name="correo_electronico1" 
                               value="{{ datos_adicionales.correo_electronico1 if datos_adicionales else '' }}" 
                               maxlength="50" required>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="correo_electronico2" class="form-label">Correo Electrónico 2</label>
                        <input type="email" class="form-control" id="correo_electronico2" name="correo_electronico2" 
                               value="{{ datos_adicionales.correo_electronico2 if datos_adicionales else '' }}" 
                               maxlength="50">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_fijo1" class="form-label">Teléfono Fijo 1</label>
                        <input type="text" class="form-control" id="telefono_fijo1" name="telefono_fijo1" 
                               value="{{ datos_adicionales.telefono_fijo1 if datos_adicionales else '' }}" 
                               maxlength="35">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_fijo2" class="form-label">Teléfono Fijo 2</label>
                        <input type="text" class="form-control" id="telefono_fijo2" name="telefono_fijo2" 
                               value="{{ datos_adicionales.telefono_fijo2 if datos_adicionales else '' }}" 
                               maxlength="35">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="telefono_celular1" class="form-label campo-obligatorio">Teléfono Celular 1</label>
                        <input type="text" class="form-control" id="telefono_celular1" name="telefono_celular1" 
                               value="{{ datos_adicionales.telefono_celular1 if datos_adicionales else '' }}" 
                               maxlength="10" required>
                        <small class="text-muted">10 dígitos máximo</small>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="telefono_celular2" class="form-label">Teléfono Celular 2</label>
                        <input type="text" class="form-control" id="telefono_celular2" name="telefono_celular2" 
                               value="{{ datos_adicionales.telefono_celular2 if datos_adicionales else '' }}" 
                               maxlength="10">
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="nro_carrera_administrativa" class="form-label">N° Carrera Administrativa</label>
                        <input type="text" class="form-control" id="nro_carrera_administrativa" name="nro_carrera_administrativa" 
                               value="{{ datos_adicionales.nro_carrera_administrativa if datos_adicionales else '' }}" 
                               maxlength="12">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="licencia_conducir" class="form-label">Licencia Conducir</label>
                        <select class="form-select" id="licencia_conducir" name="licencia_conducir">
                            <option value="">Seleccionar...</option>
                            <option value="SI" {% if datos_adicionales and datos_adicionales.licencia_conducir == 'SI' %}selected{% endif %}>Sí</option>
                            <option value="NO" {% if datos_adicionales and datos_adicionales.licencia_conducir == 'NO' %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <label for="categoria_licencia" class="form-label">Categoría Licencia</label>
                        <select class="form-select" id="categoria_licencia" name="categoria_licencia" 
                                {% if not datos_adicionales or datos_adicionales.licencia_conducir != 'SI' %}disabled{% endif %}>
                            <option value="">Seleccionar...</option>
                            <option value="A">A - Motocicletas</option>
                            <option value="B">B - Vehículos Livianos</option>
                            <option value="C">C - Vehículos Pesados</option>
                            <option value="D">D - Transporte Público</option>
                            <option value="E">E - Maquinaria Pesada</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="emergencia_contacto" class="form-label campo-obligatorio">En caso de emergencia comunicarse con</label>
                        <input type="text" class="form-control" id="emergencia_contacto" name="emergencia_contacto" 
                               value="{{ datos_adicionales.emergencia_contacto if datos_adicionales else '' }}" 
                               maxlength="150" required>
                        <small class="text-muted">Nombre - Teléfono</small>
                    </div>
                </div>
                
                <!-- Declaración Jurada de Bienes -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-white">
                                <h6 class="mb-0"><i class="fas fa-file-contract me-2"></i> Declaración Jurada de Bienes</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="nro_declaracion_jurada" class="form-label campo-obligatorio">N° Declaración Jurada</label>
                                        <input type="text" class="form-control" id="nro_declaracion_jurada" name="nro_declaracion_jurada" 
                                               value="{{ datos_adicionales.nro_declaracion_jurada if datos_adicionales else '' }}" 
                                               maxlength="20" required>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label for="fecha_declaracion_jurada" class="form-label campo-obligatorio">Fecha Declaración Jurada</label>
                                        <input type="date" class="form-control" id="fecha_declaracion_jurada" name="fecha_declaracion_jurada" 
                                               value="{{ datos_adicionales.fecha_declaracion_jurada if datos_adicionales else '' }}" 
                                               max="{{ hoy }}" required>
                                        <small class="text-muted">Debe ser menor o igual a hoy</small>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <small>
                                        <i class="fas fa-info-circle me-1"></i>
                                        La declaración jurada de bienes debe ser presentada antes o al momento de la posesión del cargo.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN D: Parientes -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-section">
                <h5><i class="fas fa-users me-2"></i> D. Parientes</h5>
                <p class="text-muted mb-3">Agregue sus parientes directos.</p>
                
                <!-- Lista de parientes existentes -->
                <div id="listaParientes">
                    {% for pariente in parientes %}
                    <div class="pariente-item" id="pariente-{{ pariente.id }}">
                        <div class="pariente-header">
                            <h6 class="mb-0">{{ pariente.parentesco_nombre }} - {{ pariente.nombres }} {{ pariente.primer_apellido }}</h6>
                            <button type="button" class="btn btn-sm btn-outline-danger btn-eliminar-pariente" 
                                    data-id="{{ pariente.id }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <small><strong>Teléfono:</strong> {{ pariente.telefono or 'No registrado' }}</small>
                            </div>
                            <div class="col-md-3">
                                <small><strong>Nacionalidad:</strong> {{ pariente.nacionalidad_nombre }}</small>
                            </div>
                            <div class="col-md-3">
                                <small><strong>Identificación:</strong> {{ pariente.tipo_identificacion }} {{ pariente.numero_identificacion }}</small>
                            </div>
                        </div>
                        <input type="hidden" name="parientes_existentes[]" value="{{ pariente.id }}">
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Formulario para nuevo pariente -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-user-plus me-2"></i> Agregar Nuevo Pariente</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="parentesco" class="form-label campo-obligatorio">Parentesco</label>
                                <select class="form-select" id="parentesco" name="parentesco">
                                    <option value="">Seleccionar...</option>
                                    {% for parent in parametros.parentesco %}
                                    <option value="{{ parent.codigo }}">{{ parent.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="primer_apellido_pariente" class="form-label campo-obligatorio">Primer Apellido</label>
                                <input type="text" class="form-control" id="primer_apellido_pariente" name="primer_apellido_pariente" maxlength="30">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="segundo_apellido_pariente" class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" id="segundo_apellido_pariente" name="segundo_apellido_pariente" maxlength="30">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="nombres_pariente" class="form-label campo-obligatorio">Nombres</label>
                                <input type="text" class="form-control" id="nombres_pariente" name="nombres_pariente" maxlength="30">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="nacionalidad_pariente" class="form-label campo-obligatorio">Nacionalidad</label>
                                <select class="form-select" id="nacionalidad_pariente" name="nacionalidad_pariente">
                                    <option value="">Seleccionar...</option>
                                    {% for nac in parametros.nacionalidad %}
                                    <option value="{{ nac.codigo }}">{{ nac.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="telefono_pariente" class="form-label">Teléfono</label>
                                <input type="text" class="form-control" id="telefono_pariente" name="telefono_pariente" maxlength="35">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="genero_pariente" class="form-label campo-obligatorio">Género</label>
                                <select class="form-select" id="genero_pariente" name="genero_pariente">
                                    <option value="">Seleccionar...</option>
                                    {% for genero in parametros.genero %}
                                    <option value="{{ genero.codigo }}">{{ genero.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="fecha_nacimiento_pariente" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" class="form-control" id="fecha_nacimiento_pariente" name="fecha_nacimiento_pariente" max="{{ hoy }}">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="tipo_identificacion_pariente" class="form-label campo-obligatorio">Tipo Identificación</label>
                                <select class="form-select" id="tipo_identificacion_pariente" name="tipo_identificacion_pariente">
                                    <option value="">Seleccionar...</option>
                                    <option value="CI">CI</option>
                                    <option value="PASAPORTE">Pasaporte</option>
                                    <option value="OTRO">Otro</option>
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="numero_identificacion_pariente" class="form-label campo-obligatorio">Número Identificación</label>
                                <input type="text" class="form-control" id="numero_identificacion_pariente" name="numero_identificacion_pariente" maxlength="15">
                            </div>
                            
                            <div class="col-md-3 mb-3 align-self-end">
                                <button type="button" class="btn btn-primary" id="btnAgregarPariente">
                                    <i class="fas fa-plus me-1"></i> Agregar Pariente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de parientes a agregar (oculta) -->
                <div id="parientesNuevos" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Botones de acción -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('funcionario_completar_ficha') }}" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i> Cancelar
                        </a>
                        
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="btnGuardarBorrador">
                                <i class="fas fa-save me-1"></i> Guardar Borrador
                            </button>
                            
                            <button type="submit" class="btn btn-success" id="btnGuardarContinuar">
                                <i class="fas fa-save me-1"></i> Guardar y Continuar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Variables globales
const hoy = '{{ hoy }}';

// Calcular fecha máxima para nacimiento (18 años atrás)
document.addEventListener('DOMContentLoaded', function() {
    const fechaMaxNacimiento = new Date();
    fechaMaxNacimiento.setFullYear(fechaMaxNacimiento.getFullYear() - 18);
    document.getElementById('fecha_nacimiento').max = fechaMaxNacimiento.toISOString().split('T')[0];
    
    // Fecha caducidad CI debe ser mayor a hoy
    const fechaHoy = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_caducidad_ci').min = fechaHoy;
    
    // Configurar validaciones condicionales
    configurarValidaciones();
    
    // Configurar eventos para parientes
    configurarParientes();
});

function configurarValidaciones() {
    // País de nacimiento afecta departamento y provincia
    const paisNacimiento = document.getElementById('pais_nacimiento');
    const deptoNacimiento = document.getElementById('depto_nacimiento');
    const provinciaNacimiento = document.getElementById('provincia_nacimiento');
    
    paisNacimiento.addEventListener('change', function() {
        if (this.value === 'BOL') {
            deptoNacimiento.disabled = false;
            deptoNacimiento.required = true;
            provinciaNacimiento.disabled = false;
        } else {
            deptoNacimiento.disabled = true;
            deptoNacimiento.required = false;
            deptoNacimiento.value = '';
            provinciaNacimiento.disabled = true;
            provinciaNacimiento.value = '';
        }
    });
    
    // Gestora afecta NUA
    const gestora = document.getElementById('gestora');
    const nroNua = document.getElementById('nro_nua');
    
    gestora.addEventListener('change', function() {
        nroNua.disabled = !this.value;
        if (!this.value) nroNua.value = '';
    });
    
    // Tipo vivienda afecta campos relacionados
    const tipoVivienda = document.getElementById('tipo_vivienda');
    const nombreTipoVivienda = document.getElementById('nombre_tipo_vivienda');
    const piso = document.getElementById('piso');
    const deptoVivienda = document.getElementById('depto');
    
    tipoVivienda.addEventListener('change', function() {
        const esEdificio = this.value === 'EDIFICIO';
        nombreTipoVivienda.disabled = !esEdificio;
        piso.disabled = !esEdificio;
        deptoVivienda.disabled = !esEdificio;
        
        if (!esEdificio) {
            nombreTipoVivienda.value = '';
            piso.value = '';
            deptoVivienda.value = '';
        }
    });
    
    // Licencia conducir afecta categoría
    const licenciaConducir = document.getElementById('licencia_conducir');
    const categoriaLicencia = document.getElementById('categoria_licencia');
    
    licenciaConducir.addEventListener('change', function() {
        categoriaLicencia.disabled = this.value !== 'SI';
        if (this.value !== 'SI') categoriaLicencia.value = '';
    });
    
    // Género afecta libreta militar
    const genero = document.getElementById('genero');
    const libretaMilitar = document.getElementById('nro_libreta_militar');
    
    genero.addEventListener('change', function() {
        if (this.value === 'M') {
            libretaMilitar.setAttribute('data-obligatorio', 'true');
        } else {
            libretaMilitar.removeAttribute('data-obligatorio');
        }
    });
}

function configurarParientes() {
    const btnAgregarPariente = document.getElementById('btnAgregarPariente');
    const listaParientes = document.getElementById('listaParientes');
    const parientesNuevos = document.getElementById('parientesNuevos');
    
    btnAgregarPariente.addEventListener('click', function() {
        // Validar campos obligatorios
        const camposObligatorios = [
            'parentesco', 'primer_apellido_pariente', 'nombres_pariente',
            'nacionalidad_pariente', 'genero_pariente', 'tipo_identificacion_pariente',
            'numero_identificacion_pariente'
        ];
        
        let valido = true;
        camposObligatorios.forEach(campoId => {
            const campo = document.getElementById(campoId);
            if (!campo.value.trim()) {
                campo.classList.add('is-invalid');
                valido = false;
            } else {
                campo.classList.remove('is-invalid');
            }
        });
        
        if (!valido) {
            alert('Por favor complete todos los campos obligatorios del pariente');
            return;
        }
        
        // Crear objeto con datos del pariente
        const pariente = {
            parentesco: document.getElementById('parentesco').value,
            primer_apellido: document.getElementById('primer_apellido_pariente').value,
            segundo_apellido: document.getElementById('segundo_apellido_pariente').value,
            nombres: document.getElementById('nombres_pariente').value,
            nacionalidad: document.getElementById('nacionalidad_pariente').value,
            telefono: document.getElementById('telefono_pariente').value,
            genero: document.getElementById('genero_pariente').value,
            fecha_nacimiento: document.getElementById('fecha_nacimiento_pariente').value,
            tipo_identificacion: document.getElementById('tipo_identificacion_pariente').value,
            numero_identificacion: document.getElementById('numero_identificacion_pariente').value
        };
        
        // Agregar a lista oculta
        const index = document.querySelectorAll('[name^="parientes_nuevos"]').length;
        let inputsOcultos = '';
        
        for (const [key, value] of Object.entries(pariente)) {
            inputsOcultos += `<input type="hidden" name="parientes_nuevos[${index}][${key}]" value="${value}">`;
        }
        
        parientesNuevos.insertAdjacentHTML('beforeend', inputsOcultos);
        
        // Mostrar en lista visible
        const parentescoText = document.querySelector(`#parentesco option[value="${pariente.parentesco}"]`).textContent;
        const nacionalidadText = document.querySelector(`#nacionalidad_pariente option[value="${pariente.nacionalidad}"]`).textContent;
        const generoText = document.querySelector(`#genero_pariente option[value="${pariente.genero}"]`).textContent;
        
        const parienteHTML = `
            <div class="pariente-item" id="pariente-nuevo-${index}">
                <div class="pariente-header">
                    <h6 class="mb-0">${parentescoText} - ${pariente.nombres} ${pariente.primer_apellido}</h6>
                    <button type="button" class="btn btn-sm btn-outline-danger btn-eliminar-pariente-nuevo" 
                            data-index="${index}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <small><strong>Teléfono:</strong> ${pariente.telefono || 'No registrado'}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Nacionalidad:</strong> ${nacionalidadText}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Género:</strong> ${generoText}</small>
                    </div>
                    <div class="col-md-3">
                        <small><strong>Identificación:</strong> ${pariente.tipo_identificacion} ${pariente.numero_identificacion}</small>
                    </div>
                </div>
            </div>
        `;
        
        listaParientes.insertAdjacentHTML('beforeend', parienteHTML);
        
        // Limpiar formulario
        camposObligatorios.forEach(campoId => {
            document.getElementById(campoId).value = '';
        });
        document.getElementById('segundo_apellido_pariente').value = '';
        document.getElementById('telefono_pariente').value = '';
        document.getElementById('fecha_nacimiento_pariente').value = '';
        
        // Configurar evento eliminar para nuevo pariente
        document.querySelector(`#pariente-nuevo-${index} .btn-eliminar-pariente-nuevo`)
            .addEventListener('click', eliminarParienteNuevo);
    });
    
    // Configurar eventos eliminar para parientes existentes
    document.querySelectorAll('.btn-eliminar-pariente').forEach(btn => {
        btn.addEventListener('click', function() {
            const parienteId = this.getAttribute('data-id');
            if (confirm('¿Está seguro de eliminar este pariente?')) {
                // Marcar para eliminación
                const inputEliminar = document.createElement('input');
                inputEliminar.type = 'hidden';
                inputEliminar.name = 'parientes_eliminar[]';
                inputEliminar.value = parienteId;
                parientesNuevos.appendChild(inputEliminar);
                
                // Ocultar en la vista
                document.getElementById(`pariente-${parienteId}`).style.display = 'none';
            }
        });
    });
    
    // Función para eliminar pariente nuevo
    function eliminarParienteNuevo() {
        const index = this.getAttribute('data-index');
        if (confirm('¿Está seguro de eliminar este pariente?')) {
            // Eliminar inputs ocultos
            document.querySelectorAll(`[name^="parientes_nuevos[${index}]"]`).forEach(input => {
                input.remove();
            });
            
            // Eliminar de la vista
            document.getElementById(`pariente-nuevo-${index}`).remove();
        }
    }
}

// Validación antes de enviar
document.getElementById('formDatosPersonales').addEventListener('submit', function(e) {
    // Validar género masculino -> libreta militar obligatoria
    const genero = document.getElementById('genero').value;
    const libretaMilitar = document.getElementById('nro_libreta_militar').value;
    
    if (genero === 'M' && !libretaMilitar.trim()) {
        e.preventDefault();
        alert('El número de libreta de servicio militar es obligatorio para funcionarios varones');
        document.getElementById('nro_libreta_militar').focus();
        return;
    }
    
    // Validar si se agregó al menos un pariente
    const tieneParientes = document.querySelectorAll('.pariente-item').length > 0;
    if (!tieneParientes) {
        if (!confirm('No ha agregado ningún pariente. ¿Desea continuar sin agregar parientes?')) {
            e.preventDefault();
            return;
        }
    }
    
    // Mostrar mensaje de confirmación
    if (!confirm('¿Está seguro de guardar sus datos personales?')) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
4. Actualizar la ruta funcionario_datos_personales en app.py:
python
from datetime import datetime, timedelta

@app.route('/funcionario/datos-personales', methods=['GET', 'POST'])
@auth.login_required
@auth.role_required(['funcionario'])
def funcionario_datos_personales():
    """Funcionario completa sus datos personales (Actividad 5)"""
    funcionario = db.get_funcionario_by_ci(session.get('ci', ''))
    
    if not funcionario:
        flash('Funcionario no encontrado', 'danger')
        return redirect(url_for('dashboard_funcionario'))
    
    # Obtener parámetros para los dropdowns
    parametros = {
        'genero': db.get_parametros('genero'),
        'departamentos': db.get_parametros('departamentos'),
        'paises': db.get_parametros('paises'),
        'estado_civil': db.get_parametros('estado_civil'),
        'tipo_sangre': db.get_parametros('tipo_sangre'),
        'gestora': db.get_parametros('gestora'),
        'parentesco': db.get_parametros('parentesco'),
        'nacionalidad': db.get_parametros('nacionalidad')
    }
    
    # Obtener datos adicionales existentes
    datos_adicionales = db.get_datos_adicionales(funcionario['id'])
    
    # Obtener parientes existentes
    parientes = db.get_parientes(funcionario['id'])
    
    # Enriquecer parientes con nombres de parámetros
    for pariente in parientes:
        # Buscar nombre del parentesco
        for parent in parametros['parentesco']:
            if parent['codigo'] == pariente['parentesco']:
                pariente['parentesco_nombre'] = parent['nombre']
                break
        
        # Buscar nombre de nacionalidad
        for nac in parametros['nacionalidad']:
            if nac['codigo'] == pariente['nacionalidad']:
                pariente['nacionalidad_nombre'] = nac['nombre']
                break
    
    if request.method == 'POST':
        try:
            # 1. Guardar datos adicionales
            datos = {
                'genero': request.form.get('genero'),
                'expedido_en': request.form.get('expedido_en'),
                'fecha_nacimiento': request.form.get('fecha_nacimiento'),
                'pais_nacimiento': request.form.get('pais_nacimiento'),
                'depto_nacimiento': request.form.get('depto_nacimiento'),
                'provincia_nacimiento': request.form.get('provincia_nacimiento'),
                'lugar_nacimiento': request.form.get('lugar_nacimiento'),
                'nro_libreta_militar': request.form.get('nro_libreta_militar'),
                'gestora': request.form.get('gestora'),
                'nro_nua': request.form.get('nro_nua'),
                'tipo_sangre': request.form.get('tipo_sangre'),
                'fecha_caducidad_ci': request.form.get('fecha_caducidad_ci'),
                'estado_civil': request.form.get('estado_civil'),
                'nro_hijos': request.form.get('nro_hijos'),
                'nro_dependientes': request.form.get('nro_dependientes'),
                'direccion_domicilio': request.form.get('direccion_domicilio'),
                'nro_domicilio': request.form.get('nro_domicilio'),
                'zona_domicilio': request.form.get('zona_domicilio'),
                'ciudad_localidad': request.form.get('ciudad_localidad'),
                'tipo_vivienda': request.form.get('tipo_vivienda'),
                'nombre_tipo_vivienda': request.form.get('nombre_tipo_vivienda'),
                'piso': request.form.get('piso'),
                'depto': request.form.get('depto'),
                'casilla': request.form.get('casilla'),
                'correo_electronico1': request.form.get('correo_electronico1'),
                'correo_electronico2': request.form.get('correo_electronico2'),
                'telefono_fijo1': request.form.get('telefono_fijo1'),
                'telefono_fijo2': request.form.get('telefono_fijo2'),
                'telefono_celular1': request.form.get('telefono_celular1'),
                'telefono_celular2': request.form.get('telefono_celular2'),
                'nro_carrera_administrativa': request.form.get('nro_carrera_administrativa'),
                'licencia_conducir': request.form.get('licencia_conducir'),
                'categoria_licencia': request.form.get('categoria_licencia'),
                'emergencia_contacto': request.form.get('emergencia_contacto'),
                'nro_declaracion_jurada': request.form.get('nro_declaracion_jurada'),
                'fecha_declaracion_jurada': request.form.get('fecha_declaracion_jurada')
            }
            
            # Validaciones especiales
            if datos['genero'] == 'M' and not datos['nro_libreta_militar']:
                flash('El número de libreta de servicio militar es obligatorio para varones', 'danger')
                return render_template('funcionario/datos_personales.html',
                                     funcionario=funcionario,
                                     parametros=parametros,
                                     datos_adicionales=datos_adicionales,
                                     parientes=parientes,
                                     hoy=datetime.now().strftime('%Y-%m-%d'),
                                     fecha_max_nacimiento=(datetime.now() - timedelta(days=365*18)).strftime('%Y-%m-%d'))
            
            # Guardar datos adicionales
            db.guardar_datos_adicionales(funcionario['id'], datos)
            
            # 2. Procesar parientes nuevos
            parientes_nuevos = []
            i = 0
            while f'parientes_nuevos[{i}][parentesco]' in request.form:
                pariente = {
                    'parentesco': request.form.get(f'parientes_nuevos[{i}][parentesco]'),
                    'primer_apellido': request.form.get(f'parientes_nuevos[{i}][primer_apellido]'),
                    'segundo_apellido': request.form.get(f'parientes_nuevos[{i}][segundo_apellido]'),
                    'nombres': request.form.get(f'parientes_nuevos[{i}][nombres]'),
                    'nacionalidad': request.form.get(f'parientes_nuevos[{i}][nacionalidad]'),
                    'telefono': request.form.get(f'parientes_nuevos[{i}][telefono]'),
                    'genero': request.form.get(f'parientes_nuevos[{i}][genero]'),
                    'fecha_nacimiento': request.form.get(f'parientes_nuevos[{i}][fecha_nacimiento]'),
                    'tipo_identificacion': request.form.get(f'parientes_nuevos[{i}][tipo_identificacion]'),
                    'numero_identificacion': request.form.get(f'parientes_nuevos[{i}][numero_identificacion]')
                }
                parientes_nuevos.append(pariente)
                i += 1
            
            # Guardar parientes nuevos
            for pariente in parientes_nuevos:
                db.guardar_pariente(funcionario['id'], pariente)
            
            # 3. Procesar parientes a eliminar
            parientes_eliminar = request.form.getlist('parientes_eliminar[]')
            for pariente_id in parientes_eliminar:
                db.eliminar_pariente(pariente_id)
            
            flash('✅ Datos personales guardados correctamente', 'success')
            
            # Actualizar estado del funcionario si es la primera vez
            conn = db.get_connection()
            cursor = conn.cursor()
            cursor.execute("UPDATE funcionarios SET estado = 'en_proceso' WHERE id = ?", (funcionario['id'],))
            conn.commit()
            conn.close()
            
            return redirect(url_for('funcionario_completar_ficha'))
            
        except Exception as e:
            flash(f'❌ Error al guardar datos: {str(e)}', 'danger')
    
    # Para GET, calcular fechas límite
    hoy = datetime.now().strftime('%Y-%m-%d')
    fecha_max_nacimiento = (datetime.now() - timedelta(days=365*18)).strftime('%Y-%m-%d')
    
    return render_template('funcionario/datos_personales.html',
                         funcionario=funcionario,
                         parametros=parametros,
                         datos_adicionales=datos_adicionales,
                         parientes=parientes,
                         hoy=hoy,
                         fecha_max_nacimiento=fecha_max_nacimiento)
5. Crear carpeta para templates de funcionario:
text
templates/
└── funcionario/
    ├── datos_personales.html (ya creado)
    ├── formacion_academica.html (vacío por ahora)
    ├── seguro_social.html (vacío por ahora)
    ├── experiencia_laboral.html (vacío por ahora)
    └── completar_ficha.html (ya creado)
📋 RESUMEN DE LO IMPLEMENTADO:
✅ Tablas de parámetros (género, departamentos, países, etc.)

✅ Tablas para datos de funcionario (datos_adicionales, parientes, etc.)

✅ Métodos en Database para gestionar estos datos

✅ Template completo de datos personales con todas las validaciones

✅ Lógica de guardado con validaciones condicionales

✅ Sistema de parientes (agregar, eliminar)

🎯 PRÓXIMOS PASOS (en orden):
Probar el formulario de datos personales - Registrar un funcionario como admin y luego login como ese funcionario para completar datos

Implementar Formación Académica (Actividad 6)

Bachillerato

Formación superior

Cursos

Idiomas

Otros conocimientos

Implementar Seguro Social (Actividad 7)

Más simple, solo caja de salud

Implementar Experiencia Laboral (Actividad 8)

Experiencia previa

Capacitaciones impartidas

Implementar Revisión y Aprobación (Actividades 9-12)

¿Quieres que probemos primero el formulario de datos personales? Registra un funcionario como admin, luego login con ese funcionario y prueba completar todos los campos. Luego seguimos con Formación Académica.