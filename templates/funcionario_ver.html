{% extends "base.html" %}

{% block title %}Ver Funcionario - {{ funcionario.primer_nombre }} {{ funcionario.primer_apellido }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-user me-2"></i> 
                    {{ funcionario['primer_nombre'] }} {{ funcionario['primer_apellido'] }}
                </h1>
                <p class="text-muted">CI: {{ funcionario['ci'] }} | 
                    Estado: 
                    {% if funcionario['estado'] == 'pendiente' %}
                        <span class="badge bg-warning">Pendiente</span>
                    {% elif funcionario['estado'] == 'activo' %}
                        <span class="badge bg-success">Activo</span>
                    {% elif funcionario['estado'] == 'baja' %}
                        <span class="badge bg-danger">Baja</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ funcionario['estado'] }}</span>
                    {% endif %}
                </p>
            </div>
            <div>
                <a href="{{ url_for('funcionarios_lista') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </a>
                <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Editar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <!-- Pestañas de información -->
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="infoTabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#datos-personales" data-bs-toggle="tab">
                            <i class="fas fa-user me-1"></i> Datos Personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#datos-resolucion" data-bs-toggle="tab">
                            <i class="fas fa-file-contract me-1"></i> Resolución
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#asignacion-item" data-bs-toggle="tab">
                            <i class="fas fa-briefcase me-1"></i> Asignación
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#credenciales" data-bs-toggle="tab">
                            <i class="fas fa-key me-1"></i> Credenciales
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Pestaña 1: Datos Personales -->
                    <div class="tab-pane fade show active" id="datos-personales">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información Personal</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">CI/Número Identificación:</th>
                                        <td>{{ funcionario['ci'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Tipo Identificación:</th>
                                        <td>{{ funcionario['tipo_identificacion'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Nombre Completo:</th>
                                        <td>
                                            {{ funcionario['primer_apellido'] }} 
                                            {{ funcionario['segundo_apellido'] or '' }} 
                                            {{ funcionario['tercer_apellido'] or '' }}
                                            {{ funcionario['primer_nombre'] }}
                                            {{ funcionario['segundo_nombre'] or '' }}
                                            {{ funcionario['tercer_nombre'] or '' }}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Información del Sistema</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Estado:</th>
                                        <td>
                                            {% if funcionario['estado'] == 'pendiente' %}
                                                <span class="badge bg-warning">Pendiente</span>
                                            {% elif funcionario['estado'] == 'activo' %}
                                                <span class="badge bg-success">Activo</span>
                                            {% elif funcionario['estado'] == 'baja' %}
                                                <span class="badge bg-danger">Baja</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Registro:</th>
                                        <td>{{ funcionario['fecha_registro'] }}</td>
                                    </tr>
                                    <tr>
                                        <th>Última Actualización:</th>
                                        <td>{{ funcionario['fecha_actualizacion'] or 'Sin actualizar' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 2: Datos de Resolución -->
                    <div class="tab-pane fade" id="datos-resolucion">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Resolución:</th>
                                        <td>{{ funcionario['nro_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Resolución:</th>
                                        <td>{{ funcionario['fecha_resolucion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Posesión:</th>
                                        <td>{{ funcionario['fecha_posesion'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Memorándum:</th>
                                        <td>{{ funcionario['nro_memorandum_designacion'] or 'No registrado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Memorándum:</th>
                                        <td>{{ funcionario['fecha_memorandum'] or 'No registrado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 3: Asignación de Ítem -->
                    <div class="tab-pane fade" id="asignacion-item">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">N° Ítem:</th>
                                        <td>{{ funcionario['nro_item'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Administración:</th>
                                        <td>{{ funcionario['administracion'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Jerarquía:</th>
                                        <td>{{ funcionario['jerarquia'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Depende de:</th>
                                        <td>{{ funcionario['depende_de'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th width="40%">Unidad Organizacional:</th>
                                        <td>{{ funcionario['unidad_organizacional'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Cargo:</th>
                                        <td>{{ funcionario['cargo'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Puesto:</th>
                                        <td>{{ funcionario['puesto'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Dirección Oficina:</th>
                                        <td>{{ funcionario['direccion_oficina'] or 'No asignado' }}</td>
                                    </tr>
                                    <tr>
                                        <th>Piso/Interno:</th>
                                        <td>{{ funcionario['piso_interno'] or 'No asignado' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pestaña 4: Credenciales -->
                    <div class="tab-pane fade" id="credenciales">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-muted mb-3">Credenciales del Sistema</h6>
                                        <table class="table table-sm">
                                            <tr>
                                                <th width="40%">Usuario Aplicación:</th>
                                                <td>
                                                    {% if funcionario['usuario_aplicacion'] %}
                                                        <code>{{ funcionario['usuario_aplicacion'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Clave Temporal:</th>
                                                <td>
                                                    {% if funcionario['clave_generada'] %}
                                                        <code>{{ funcionario['clave_generada'] }}</code>
                                                        <small class="text-muted d-block">(CI del funcionario)</small>
                                                    {% else %}
                                                        <span class="text-muted">No generada</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Correo Institucional:</th>
                                                <td>
                                                    {% if funcionario['correo_interno'] %}
                                                        <code>{{ funcionario['correo_interno'] }}</code>
                                                    {% else %}
                                                        <span class="text-muted">No generado</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Estado Usuario:</th>
                                                <td>
                                                    {% if funcionario['estado'] == 'baja' %}
                                                        <span class="badge bg-danger">Usuario Inactivo</span>
                                                    {% else %}
                                                        <span class="badge bg-success">Usuario Activo</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-cogs me-2"></i> Acciones Disponibles</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_editar', ci=funcionario['ci']) }}" 
                           class="btn btn-primary w-100">
                            <i class="fas fa-edit me-1"></i> Editar Datos
                        </a>
                    </div>
                    {% if funcionario['estado'] == 'baja' %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_activar', ci=funcionario['ci']) }}" 
                           class="btn btn-success w-100"
                           onclick="return confirm('¿Está seguro de reactivar este funcionario?')">
                            <i class="fas fa-user-check me-1"></i> Reactivar
                        </a>
                    </div>
                    {% else %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionario_baja', ci=funcionario['ci']) }}" 
                           class="btn btn-danger w-100">
                            <i class="fas fa-user-minus me-1"></i> Dar de Baja
                        </a>
                    </div>
                    {% endif %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('funcionarios_lista') }}" 
                           class="btn btn-secondary w-100">
                            <i class="fas fa-list me-1"></i> Volver a Lista
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-info w-100" onclick="window.print()">
                            <i class="fas fa-print me-1"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}